<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - 대안 관리</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(200, 169, 104, 0.1);
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .alternatives-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .alternative-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .alternative-item:hover {
            border-color: var(--accent-light);
            background: var(--bg-primary);
        }

        .alternative-info {
            flex: 1;
        }

        .alternative-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .alternative-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .alternative-meta {
            font-size: 0.85rem;
            color: var(--accent-primary);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .alternative-actions {
            display: flex;
            gap: 0.5rem;
        }

        .drag-handle {
            background: var(--accent-light);
            color: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            margin-right: 1rem;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .criteria-summary {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .criteria-badge {
            background: var(--accent-light);
            color: var(--accent-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .comparison-preview {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px dashed var(--success);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .comparison-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .matrix-cell {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            text-align: center;
            border: 1px solid var(--success);
            opacity: 0.7;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .quick-add {
            display: flex;
            gap: 1rem;
            align-items: end;
            margin-bottom: 1rem;
        }

        .quick-add .form-group {
            margin-bottom: 0;
            flex: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .alternative-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .alternative-actions {
                justify-content: center;
            }

            .quick-add {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">대시보드</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">프로젝트</a>
                <a href="./results-analysis.html" class="header-nav-item" data-page="analysis">분석</a>
                <a href="#" class="header-nav-item" data-page="reports">보고서</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">김</div>
                <div>
                    <div class="user-name">김철수</div>
                    <div class="user-role" id="userRole">로딩 중...</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">로그아웃</button>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">프로젝트 관리</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">📋</span>
                    <span>내 프로젝트</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">➕</span>
                    <span>새 프로젝트</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">🗑️</span>
                    <span>휴지통</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">모델 구축</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item" data-menu="criteria">
                    <span class="sidebar-icon">⚖️</span>
                    <span>기준 설정</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item active" data-menu="alternatives">
                    <span class="sidebar-icon">🔄</span>
                    <span>대안 관리</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item" data-menu="comparison">
                    <span class="sidebar-icon">⚡</span>
                    <span>쌍대비교</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">👥</span>
                    <span>평가자 관리</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">분석 및 결과</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item" data-menu="results">
                    <span class="sidebar-icon">📈</span>
                    <span>결과 분석</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">📊</span>
                    <span>진행률 모니터링</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">📄</span>
                    <span>보고서 생성</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">🔍</span>
                    <span>민감도 분석</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">설정</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">⚙️</span>
                    <span>개인 설정</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">💳</span>
                    <span>요금제 관리</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">📚</span>
                    <span>사용 가이드</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- 사이드바 토글 버튼 -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">◀</span>
    </button>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django 백엔드:</strong> <span id="backend-status">연결 확인중...</span>
            </div>
            <div>
                <strong>현재 프로젝트:</strong> <span id="current-project">프로젝트를 선택해주세요</span>
            </div>
            <div>
                <strong>단계:</strong> <span style="color: var(--accent-primary);">3단계 - 대안 입력</span>
            </div>
        </div>

        <!-- AHP 진행 상황 -->
        <div class="section">
            <h2 class="section-title">📊 AHP 진행 상황</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="ahp-progress" style="width: 50%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>프로젝트 생성</span>
                <span>기준 설정</span>
                <span style="color: var(--accent-primary); font-weight: 600;">대안 입력</span>
                <span>쌍대비교</span>
                <span>결과 분석</span>
            </div>
        </div>

        <!-- 설정된 기준 요약 -->
        <div class="section">
            <h2 class="section-title">⚖️ 설정된 기준 요약</h2>
            <div class="criteria-summary">
                <div id="criteria-loading" class="loading" style="display: none;">
                    기준 정보를 불러오는 중...
                </div>
                <div id="criteria-summary-content">
                    <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">📋 평가 기준</h3>
                    <div class="criteria-grid" id="criteria-grid">
                        <!-- 기준들이 여기에 동적으로 표시됩니다 -->
                    </div>
                    <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                        각 대안은 위 기준들을 바탕으로 평가됩니다.
                    </p>
                </div>
            </div>
        </div>

        <!-- 대안 관리 가이드 -->
        <div class="section">
            <h2 class="section-title">📋 대안 설정 가이드</h2>
            <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">💡 좋은 대안 설정을 위한 팁</h3>
                <ul style="color: var(--text-primary); line-height: 1.6; margin-left: 1.5rem;">
                    <li><strong>현실적:</strong> 실제로 선택 가능한 현실적인 대안들</li>
                    <li><strong>구별성:</strong> 서로 명확히 구별되는 독립적인 대안들</li>
                    <li><strong>비교 가능:</strong> 설정된 기준으로 평가 가능한 대안들</li>
                    <li><strong>완전성:</strong> 고려해야 할 모든 주요 대안 포함</li>
                    <li><strong>적정 수준:</strong> 보통 3-7개 대안이 적당합니다</li>
                </ul>
            </div>
        </div>

        <!-- 빠른 대안 추가 -->
        <div class="section">
            <h2 class="section-title">⚡ 빠른 대안 추가</h2>
            <div class="quick-add">
                <div class="form-group">
                    <label for="quick-alternative-name" class="form-label">대안 이름</label>
                    <input type="text" id="quick-alternative-name" class="form-input" 
                           placeholder="예: 대안 A">
                </div>
                <button onclick="quickAddAlternative()" class="btn btn-small">
                    ➕ 추가
                </button>
            </div>
        </div>

        <!-- 새 대안 추가 -->
        <div class="section">
            <h2 class="section-title">➕ 새 대안 추가</h2>
            <div id="add-error" class="error" style="display:none;"></div>
            <div id="add-success" class="success" style="display:none;"></div>
            
            <form id="add-alternative-form">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; align-items: start;">
                    <div class="form-group">
                        <label for="alternative-name" class="form-label">대안 이름 *</label>
                        <input type="text" id="alternative-name" class="form-input" required 
                               placeholder="예: 제품 A">
                    </div>

                    <div class="form-group">
                        <label for="alternative-description" class="form-label">대안 설명</label>
                        <textarea id="alternative-description" class="form-textarea" rows="3" 
                                  placeholder="이 대안의 특징과 장점을 설명해주세요..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn" id="add-btn">
                    ➕ 대안 추가
                </button>
            </form>
        </div>

        <!-- 대안 목록 -->
        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="section-title" style="margin-bottom: 0;">📝 입력된 대안들</h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary btn-small" onclick="loadAlternatives()">
                        🔄 새로고침
                    </button>
                    <button class="btn btn-small" onclick="proceedToComparison()" id="proceed-btn" style="display: none;">
                        다음 단계 → 쌍대비교
                    </button>
                </div>
            </div>
            
            <div id="alternatives-loading" class="loading">
                대안 목록을 불러오는 중...
            </div>
            
            <div id="alternatives-error" class="error" style="display:none;"></div>
            
            <div id="alternatives-container" style="display:none;">
                <div class="alternatives-list" id="alternatives-list">
                    <!-- 대안들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>

        <!-- 쌍대비교 미리보기 -->
        <div class="section" id="comparison-preview" style="display: none;">
            <h2 class="section-title">🔍 쌍대비교 미리보기</h2>
            <div class="comparison-preview">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--success); margin-bottom: 1rem;">📊 비교 매트릭스 예시</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        각 기준에 대해 다음과 같은 쌍대비교를 수행합니다:
                    </p>
                </div>
                <div id="comparison-matrix" class="comparison-matrix">
                    <!-- 비교 매트릭스가 여기에 표시됩니다 -->
                </div>
                <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                    다음 단계에서 실제 쌍대비교를 수행하게 됩니다.
                </p>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // 전역 변수
        let currentAlternatives = [];
        let currentCriteria = [];
        let currentProject = null;
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 대안 관리 페이지 로드됨');
            
            // 레이아웃 초기화
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'alternatives',
                    pageId: 'projects',
                    title: '대안 관리'
                });
            }
            
            checkBackendStatus();
            loadProject();
            loadCriteria();
            loadAlternatives();

            // 폼 이벤트 리스너
            document.getElementById('add-alternative-form').addEventListener('submit', handleAddAlternative);
        });

        // 백엔드 상태 확인
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">✅ 정상 연결</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">⚠️ 응답 오류</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">❌ 연결 실패</span>';
                console.error('백엔드 연결 오류:', error);
            }
        }

        // 현재 프로젝트 정보 로드
        function loadProject() {
            // 세션 스토리지에서 프로젝트 정보 가져오기
            const savedProject = sessionStorage.getItem('currentProject');
            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                    return;
                } catch (e) {
                    console.error('프로젝트 정보 파싱 오류:', e);
                }
            }
            
            // 기본값으로 데모 프로젝트 설정
            currentProject = {
                id: 'demo-project',
                title: '샘플 의사결정 프로젝트'
            };
            document.getElementById('current-project').textContent = currentProject.title;
        }

        // 기준 정보 로드
        async function loadCriteria() {
            const loadingDiv = document.getElementById('criteria-loading');
            const gridDiv = document.getElementById('criteria-grid');

            try {
                loadingDiv.style.display = 'block';
                
                // 먼저 세션 스토리지에서 기준 정보 확인
                const savedCriteria = sessionStorage.getItem('currentCriteria');
                if (savedCriteria) {
                    try {
                        currentCriteria = JSON.parse(savedCriteria);
                        if (currentCriteria.length > 0) {
                            renderCriteriaSummary();
                            return;
                        }
                    } catch (e) {
                        console.error('기준 정보 파싱 오류:', e);
                    }
                }
                
                // API에서 기준 정보 가져오기
                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentCriteria = Array.isArray(data) ? data : (data.criteria || []);
                    
                    if (currentCriteria.length === 0) {
                        // 데모 기준 사용
                        currentCriteria = [
                            { id: 'demo-1', name: '품질' },
                            { id: 'demo-2', name: '비용' },
                            { id: 'demo-3', name: '신뢰성' },
                            { id: 'demo-4', name: '사용성' }
                        ];
                    }
                    
                    renderCriteriaSummary();
                } else {
                    throw new Error('기준 정보를 불러올 수 없습니다.');
                }

            } catch (error) {
                console.error('기준 로드 오류:', error);
                // 기본 데모 기준 사용
                currentCriteria = [
                    { id: 'demo-1', name: '품질' },
                    { id: 'demo-2', name: '비용' },
                    { id: 'demo-3', name: '신뢰성' },
                    { id: 'demo-4', name: '사용성' }
                ];
                renderCriteriaSummary();
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // 기준 요약 렌더링
        function renderCriteriaSummary() {
            const gridDiv = document.getElementById('criteria-grid');
            
            if (currentCriteria.length > 0) {
                gridDiv.innerHTML = currentCriteria.map(criteria => `
                    <div class="criteria-badge">${criteria.name}</div>
                `).join('');
            } else {
                gridDiv.innerHTML = '<p style="color: var(--text-secondary);">설정된 기준이 없습니다.</p>';
            }
        }

        // 빠른 대안 추가
        function quickAddAlternative() {
            const name = document.getElementById('quick-alternative-name').value.trim();
            if (!name) {
                alert('대안 이름을 입력해주세요.');
                return;
            }

            // 메인 폼에 값 설정
            document.getElementById('alternative-name').value = name;
            document.getElementById('quick-alternative-name').value = '';
            
            // 메인 폼 제출
            document.getElementById('add-alternative-form').dispatchEvent(new Event('submit'));
        }

        // 대안 추가 처리
        async function handleAddAlternative(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('add-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '추가 중...';
            submitBtn.disabled = true;

            // 에러/성공 메시지 초기화
            document.getElementById('add-error').style.display = 'none';
            document.getElementById('add-success').style.display = 'none';

            try {
                const alternativeData = {
                    name: document.getElementById('alternative-name').value,
                    description: document.getElementById('alternative-description').value || '',
                    project_id: currentProject?.id || 'default',
                    created_date: new Date().toISOString()
                };

                const response = await fetch(`${API_BASE_URL}/api/service/alternatives/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(alternativeData)
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // 성공 메시지 표시
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `✅ 대안 "${alternativeData.name}"이 성공적으로 추가되었습니다!`;
                    successDiv.style.display = 'block';
                    
                    // 폼 초기화
                    document.getElementById('add-alternative-form').reset();
                    
                    // 대안 목록 새로고침
                    setTimeout(() => {
                        loadAlternatives();
                        successDiv.style.display = 'none';
                    }, 2000);

                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '대안 추가에 실패했습니다.');
                }

            } catch (error) {
                console.error('대안 추가 오류:', error);
                const errorDiv = document.getElementById('add-error');
                errorDiv.textContent = `❌ 오류: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // 대안 목록 로드
        async function loadAlternatives() {
            const loadingDiv = document.getElementById('alternatives-loading');
            const errorDiv = document.getElementById('alternatives-error');
            const containerDiv = document.getElementById('alternatives-container');

            // UI 초기화
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            containerDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/api/service/alternatives/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentAlternatives = Array.isArray(data) ? data : (data.alternatives || []);
                    renderAlternatives();
                    updateComparisonPreview();
                } else {
                    throw new Error('대안 목록을 불러올 수 없습니다.');
                }

            } catch (error) {
                console.error('대안 로드 오류:', error);
                errorDiv.textContent = `❌ ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // 대안 목록 렌더링
        function renderAlternatives() {
            const container = document.getElementById('alternatives-container');
            const listElement = document.getElementById('alternatives-list');
            
            if (currentAlternatives.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🔄</div>
                        <h3>아직 입력된 대안이 없습니다</h3>
                        <p>위에서 새 대안을 추가해보세요!</p>
                    </div>
                `;
            } else {
                listElement.innerHTML = currentAlternatives.map((alternative, index) => `
                    <div class="alternative-item" data-id="${alternative.id || index}">
                        <div class="drag-handle">≡</div>
                        <div class="alternative-info">
                            <div class="alternative-name">${alternative.name}</div>
                            <div class="alternative-description">${alternative.description || '설명 없음'}</div>
                            <div class="alternative-meta">대안 ${index + 1}</div>
                        </div>
                        <div class="alternative-actions">
                            <button class="btn btn-secondary btn-small" onclick="editAlternative('${alternative.id || index}')">
                                ✏️ 수정
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteAlternative('${alternative.id || index}')">
                                🗑️ 삭제
                            </button>
                        </div>
                    </div>
                `).join('');

                // 다음 단계 버튼 표시 (3개 이상의 대안이 있을 때)
                if (currentAlternatives.length >= 3) {
                    document.getElementById('proceed-btn').style.display = 'block';
                }
            }
            
            container.style.display = 'block';
        }

        // 쌍대비교 미리보기 업데이트
        function updateComparisonPreview() {
            if (currentAlternatives.length >= 3 && currentCriteria.length >= 3) {
                const matrixDiv = document.getElementById('comparison-matrix');
                
                // 간단한 비교 매트릭스 미리보기 생성
                const sampleComparisons = [];
                for (let i = 0; i < Math.min(6, currentAlternatives.length * currentCriteria.length); i++) {
                    const altA = currentAlternatives[Math.floor(Math.random() * currentAlternatives.length)];
                    const altB = currentAlternatives[Math.floor(Math.random() * currentAlternatives.length)];
                    const criteria = currentCriteria[Math.floor(Math.random() * currentCriteria.length)];
                    
                    if (altA !== altB) {
                        sampleComparisons.push(`${criteria.name}: ${altA.name} vs ${altB.name}`);
                    }
                }
                
                matrixDiv.innerHTML = sampleComparisons.map(comp => `
                    <div class="matrix-cell">${comp}</div>
                `).join('');
                
                document.getElementById('comparison-preview').style.display = 'block';
            } else {
                document.getElementById('comparison-preview').style.display = 'none';
            }
        }

        // 대안 수정
        function editAlternative(alternativeId) {
            const alternative = currentAlternatives.find(a => (a.id || currentAlternatives.indexOf(a)) == alternativeId);
            if (alternative) {
                document.getElementById('alternative-name').value = alternative.name;
                document.getElementById('alternative-description').value = alternative.description || '';
                
                // 폼을 수정 모드로 변경 (실제 구현에서는 별도 모달이나 인라인 편집 사용)
                alert(`"${alternative.name}" 대안 수정 기능은 다음 버전에서 구현됩니다.`);
            }
        }

        // 대안 삭제
        async function deleteAlternative(alternativeId) {
            const alternative = currentAlternatives.find(a => (a.id || currentAlternatives.indexOf(a)) == alternativeId);
            if (!alternative) return;

            if (confirm(`"${alternative.name}" 대안을 삭제하시겠습니까?`)) {
                try {
                    // 실제 API 호출 (현재는 시뮬레이션)
                    console.log(`대안 삭제: ${alternativeId}`);
                    
                    // 로컬에서 제거 (실제로는 API 호출 후 목록 새로고침)
                    currentAlternatives = currentAlternatives.filter(a => (a.id || currentAlternatives.indexOf(a)) != alternativeId);
                    renderAlternatives();
                    updateComparisonPreview();
                    
                    // 성공 메시지
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `✅ "${alternative.name}" 대안이 삭제되었습니다.`;
                    successDiv.style.display = 'block';
                    setTimeout(() => successDiv.style.display = 'none', 3000);

                } catch (error) {
                    console.error('대안 삭제 오류:', error);
                    alert('대안 삭제 중 오류가 발생했습니다.');
                }
            }
        }

        // 다음 단계로 진행
        function proceedToComparison() {
            if (currentAlternatives.length < 3) {
                alert('AHP 분석을 위해 최소 3개 이상의 대안이 필요합니다.');
                return;
            }

            if (currentCriteria.length < 3) {
                alert('쌍대비교를 위해 최소 3개 이상의 기준이 설정되어야 합니다.');
                return;
            }

            const totalComparisons = currentCriteria.length * (currentAlternatives.length * (currentAlternatives.length - 1)) / 2;

            const confirmed = confirm(
                `현재 설정 상황:\n\n` +
                `• 기준: ${currentCriteria.length}개\n` +
                `• 대안: ${currentAlternatives.length}개\n` +
                `• 예상 비교 횟수: ${totalComparisons}회\n\n` +
                `다음 단계(쌍대비교)로 진행하시겠습니까?`
            );

            if (confirmed) {
                // 프로젝트, 기준, 대안 정보를 세션에 저장
                sessionStorage.setItem('currentProject', JSON.stringify(currentProject));
                sessionStorage.setItem('currentCriteria', JSON.stringify(currentCriteria));
                sessionStorage.setItem('currentAlternatives', JSON.stringify(currentAlternatives));
                
                // 쌍대비교 페이지로 이동
                window.location.href = '/ahp_app/pairwise-comparison.html';
            }
        }

        // 데모 대안 자동 추가 (개발/테스트용)
        function addDemoAlternatives() {
            const demoAlternatives = [
                {
                    id: 'demo-alt-1',
                    name: '대안 A',
                    description: '첫 번째 선택 가능한 대안으로, 비용 효율적인 솔루션'
                },
                {
                    id: 'demo-alt-2', 
                    name: '대안 B',
                    description: '두 번째 대안으로, 고품질 프리미엄 옵션'
                },
                {
                    id: 'demo-alt-3',
                    name: '대안 C',
                    description: '세 번째 대안으로, 균형 잡힌 중간 수준의 선택'
                },
                {
                    id: 'demo-alt-4',
                    name: '대안 D',
                    description: '네 번째 대안으로, 혁신적이고 미래지향적인 솔루션'
                }
            ];

            currentAlternatives = demoAlternatives;
            renderAlternatives();
            updateComparisonPreview();
        }

        // 개발용: Ctrl+D로 데모 데이터 추가
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                addDemoAlternatives();
            }
        });
    </script>
</body>
</html>