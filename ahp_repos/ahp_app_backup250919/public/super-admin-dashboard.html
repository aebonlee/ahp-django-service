<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - ÏäàÌçº Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 2rem;
            background-color: var(--bg-secondary);
            min-height: calc(100vh - var(--header-height));
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .admin-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-card-icon {
            font-size: 1.5rem;
        }

        .admin-card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .admin-card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .change-positive {
            color: #10b981;
        }

        .change-negative {
            color: #ef4444;
        }

        .management-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .admin-mode-toggle {
            padding: 0.5rem 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-mode-toggle:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .user-role {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            color: var(--text-primary);
        }

        /* ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶àÍ∏â ÏÉÅÌÉú ÌëúÏãú */
        .status-indicator {
            position: relative;
            display: inline-block;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-indicator.offline::after {
            background: #ef4444;
        }

        /* ÌîÑÎ¶¨ÎØ∏ÏóÑ Í∑∏ÎùºÎç∞Ïù¥ÏÖò */
        .premium-gradient {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, #8B5A2B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .management-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .management-card:hover {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .management-card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .management-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .management-card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-icon.user { background: #dbeafe; color: #2563eb; }
        .activity-icon.project { background: #dcfce7; color: #16a34a; }
        .activity-icon.system { background: #fef3c7; color: #d97706; }
        .activity-icon.alert { background: #fee2e2; color: #dc2626; }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(200, 169, 104, 0.4);
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .management-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ÏÉÅÎã® Ìó§Îçî -->
    <header class="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <span id="toggle-icon">‚óÄ</span>
            </button>
            <div class="header-logo">
                <span class="logo-icon">A</span>
                <span class="logo-text">AHP System</span>
                <span class="header-subtitle">ÏäàÌçº Í¥ÄÎ¶¨Ïûê</span>
            </div>
        </div>
        
        <div class="header-center">
            <nav class="header-nav">
                <a href="./super-admin-dashboard.html" class="nav-item active" data-page="admin">Í¥ÄÎ¶¨Ïûê</a>
                <a href="./personal-service-enhanced.html" class="nav-item" data-page="personal">Í∞úÏù∏ÏÑúÎπÑÏä§</a>
                <a href="#" class="nav-item" data-page="system" onclick="loadContent('system-settings', this); return false;">ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ</a>
                <a href="#" class="nav-item" data-page="analytics" onclick="loadContent('audit-log', this); return false;">Î∂ÑÏÑù</a>
            </nav>
        </div>
        
        <div class="header-right">
            <!-- Í∞úÏù∏ ÏÑúÎπÑÏä§ Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº (ÏäàÌçº Í¥ÄÎ¶¨ÏûêÏóêÍ≤åÎßå ÌëúÏãú) -->
            <button id="personalServiceToggle" class="admin-mode-toggle" onclick="switchToPersonalService()" style="background: var(--accent-secondary); margin-right: 1rem;">
                üë§ Í∞úÏù∏ ÏÑúÎπÑÏä§
            </button>
            
            <div class="header-notifications">
                <button class="notification-btn">
                    <span>üîî</span>
                    <span class="notification-badge">3</span>
                </button>
            </div>
            <div class="header-user">
                <div class="user-avatar status-indicator" id="userAvatar">üë§</div>
                <div class="user-info">
                    <div class="user-name" id="userName">ÏäàÌçº Í¥ÄÎ¶¨Ïûê</div>
                    <div class="user-role" id="userRole">
                        <span id="userRoleText" class="premium-gradient">System Admin</span>
                        <span id="adminBadge" class="admin-badge">üõ°Ô∏è ÏäàÌçº Í¥ÄÎ¶¨Ïûê</span>
                    </div>
                </div>
                <button class="user-menu-btn" onclick="handleLogout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
    </header>

    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- Í¥ÄÎ¶¨Ïûê Î©îÎâ¥ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">ÏãúÏä§ÌÖú Í¥ÄÎ¶¨</div>
                <div class="sidebar-item active" data-content="dashboard" style="cursor: pointer;" onclick="handleMenuClick('dashboard', this)">
                    <span class="sidebar-icon">üè†</span>
                    <span class="sidebar-text">ÎåÄÏãúÎ≥¥Îìú</span>
                </div>
                <div class="sidebar-item" data-content="user-management" style="cursor: pointer;" onclick="handleMenuClick('user-management', this)">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-text">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</span>
                </div>
                <div class="sidebar-item" data-content="project-overview" style="cursor: pointer;" onclick="handleMenuClick('project-overview', this)">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©</span>
                </div>
                <div class="sidebar-item" data-content="system-settings" style="cursor: pointer;" onclick="handleMenuClick('system-settings', this)">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span class="sidebar-text">ÏãúÏä§ÌÖú ÏÑ§Ï†ï</span>
                </div>
                <div class="sidebar-item" data-content="audit-log" style="cursor: pointer;" onclick="handleMenuClick('audit-log', this)">
                    <span class="sidebar-icon">üìã</span>
                    <span class="sidebar-text">Í∞êÏÇ¨ Î°úÍ∑∏</span>
                </div>
            </div>

            <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</div>
                <div class="sidebar-item" data-content="backup-restore" style="cursor: pointer;" onclick="handleMenuClick('backup-restore', this)">
                    <span class="sidebar-icon">üíæ</span>
                    <span class="sidebar-text">Î∞±ÏóÖ Î∞è Î≥µÏõê</span>
                </div>
                <div class="sidebar-item" data-content="database-management" style="cursor: pointer;" onclick="handleMenuClick('database-management', this)">
                    <span class="sidebar-icon">üóÑÔ∏è</span>
                    <span class="sidebar-text">Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨</span>
                </div>
                <div class="sidebar-item" data-content="data-migration" style="cursor: pointer;" onclick="handleMenuClick('data-migration', this)">
                    <span class="sidebar-icon">üì§</span>
                    <span class="sidebar-text">Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò</span>
                </div>
            </div>

            <!-- Î≥¥Ïïà Í¥ÄÎ¶¨ -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Î≥¥Ïïà Í¥ÄÎ¶¨</div>
                <div class="sidebar-item" data-content="security-settings" style="cursor: pointer;" onclick="handleMenuClick('security-settings', this)">
                    <span class="sidebar-icon">üîí</span>
                    <span class="sidebar-text">Î≥¥Ïïà ÏÑ§Ï†ï</span>
                </div>
                <div class="sidebar-item" data-content="access-control" style="cursor: pointer;" onclick="handleMenuClick('access-control', this)">
                    <span class="sidebar-icon">üõ°Ô∏è</span>
                    <span class="sidebar-text">Ï†ëÍ∑º Ï†úÏñ¥</span>
                </div>
                <div class="sidebar-item" data-content="security-log" style="cursor: pointer;" onclick="handleMenuClick('security-log', this)">
                    <span class="sidebar-icon">üö®</span>
                    <span class="sidebar-text">Î≥¥Ïïà Î°úÍ∑∏</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
    <main class="main-content">
        <!-- ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ -->
        <div class="dashboard-grid">
            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">üë•</span>
                        Ï¥ù ÏÇ¨Ïö©Ïûê
                    </div>
                </div>
                <div class="admin-card-value" id="totalUsers">Î°úÎî©...</div>
                <div class="admin-card-change change-positive" id="userChange">
                    Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">üìä</span>
                        ÌôúÏÑ± ÌîÑÎ°úÏ†ùÌä∏
                    </div>
                </div>
                <div class="admin-card-value" id="activeProjects">Î°úÎî©...</div>
                <div class="admin-card-change change-positive" id="projectChange">
                    Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">‚ö°</span>
                        ÏãúÏä§ÌÖú ÏÑ±Îä•
                    </div>
                </div>
                <div class="admin-card-value" id="systemPerformance">Î°úÎî©...</div>
                <div class="admin-card-change change-positive" id="performanceStatus">
                    ÏãúÏä§ÌÖú ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-card-title">
                        <span class="admin-card-icon">üíæ</span>
                        Ï†ÄÏû•ÏÜå ÏÇ¨Ïö©Î•†
                    </div>
                </div>
                <div class="admin-card-value" id="storageUsage">Î°úÎî©...</div>
                <div class="admin-card-change change-positive" id="storageStatus">
                    Ï†ÄÏû•ÏÜå ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...
                </div>
            </div>
        </div>

        <!-- Í¥ÄÎ¶¨ ÏÑπÏÖò -->
        <div class="management-section">
            <div class="section-header">
                <h2 class="section-title">ÌïµÏã¨ Í¥ÄÎ¶¨ Í∏∞Îä•</h2>
            </div>
            <div class="management-grid">
                <div class="management-card" onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')">
                    <div class="management-card-icon">üë•</div>
                    <div class="management-card-title">Django ÏäàÌçº Í¥ÄÎ¶¨Ïûê</div>
                    <div class="management-card-desc">
                        üî• Ïã§Ï†ú PostgreSQL ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨, Í≤∞Ï†ú Í¥ÄÎ¶¨, ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ - ÏôÑÏ†Ñ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
                    </div>
                </div>

                <div class="management-card" onclick="loadRealUserData()">
                    <div class="management-card-icon">üìä</div>
                    <div class="management-card-title">Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê ÌòÑÌô©</div>
                    <div class="management-card-desc">
                        üî• PostgreSQL Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞, Í∞ÄÏûÖ ÌòÑÌô©, ÌôúÎèô ÌÜµÍ≥Ñ
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('system-settings', null)">
                    <div class="management-card-icon">üìà</div>
                    <div class="management-card-title">ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ</div>
                    <div class="management-card-desc">
                        ÏÑúÎ≤Ñ ÏÑ±Îä•, Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§, API ÏÉÅÌÉú Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('backup-restore', null)">
                    <div class="management-card-icon">üíæ</div>
                    <div class="management-card-title">Î∞±ÏóÖ Í¥ÄÎ¶¨</div>
                    <div class="management-card-desc">
                        Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ, Î≥µÏõê Î∞è Ïû¨Ìï¥ Î≥µÍµ¨ Í¥ÄÎ¶¨
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('security-settings', null)">
                    <div class="management-card-icon">üîí</div>
                    <div class="management-card-title">Î≥¥Ïïà ÏÑ§Ï†ï</div>
                    <div class="management-card-desc">
                        ÏãúÏä§ÌÖú Î≥¥Ïïà Ï†ïÏ±Ö, Ïù∏Ï¶ù Î∞è ÏïîÌò∏Ìôî ÏÑ§Ï†ï
                    </div>
                </div>

                <div class="management-card" onclick="loadContent('audit-log', null)">
                    <div class="management-card-icon">üìã</div>
                    <div class="management-card-title">Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
                    <div class="management-card-desc">
                        ÏÇ¨Ïö©Ïûê ÌôúÎèô, ÏãúÏä§ÌÖú ÏÇ¨Ïö©Î•† Î∞è ÏÑ±Îä• Î∂ÑÏÑù
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏµúÍ∑º ÌôúÎèô -->
        <div class="recent-activity">
            <div class="section-header">
                <h2 class="section-title">ÏµúÍ∑º ÏãúÏä§ÌÖú ÌôúÎèô</h2>
            </div>
            <ul class="activity-list" id="activityList">
                <li class="activity-item">
                    <div class="activity-icon system">üì°</div>
                    <div class="activity-content">
                        <div class="activity-title">ÏµúÍ∑º ÌôúÎèô Îç∞Ïù¥ÌÑ∞Î•º Î°úÎî©ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                        <div class="activity-time">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</div>
                    </div>
                </li>
            </ul>
        </div>
    </main>

    <!-- Îπ†Î•∏ ÏûëÏóÖ Î≤ÑÌäº -->
    <div class="quick-actions">
        <button class="fab" title="ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨" onclick="loadContent('user-management', null)">
            üë§
        </button>
        <button class="fab" title="ÏãúÏä§ÌÖú ÏÑ§Ï†ï" onclick="loadContent('system-settings', null)">
            ‚öôÔ∏è
        </button>
    </div>

    <script>
        // API ÏÑúÎπÑÏä§Ïùò ÏûêÎèô Ïù∏Ï¶ù ÌôïÏù∏ ÎπÑÌôúÏÑ±Ìôî ÌîåÎûòÍ∑∏
        window.SKIP_AUTO_AUTH_CHECK = true;
    </script>
    <script src="scripts/api-service.js"></script>
    <script src="scripts/layout.js"></script>
    <script>
        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî (async/await)
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üõ°Ô∏è ÏäàÌçº Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú Ï¥àÍ∏∞Ìôî ÏãúÏûë');
            
            // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
            showLoadingState();
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï∫êÏã± Ï¥àÍ∏∞Ìôî
            window.currentUser = null;
            window.sessionChecked = false;
            window.authenticationInProgress = false;
            
            // API ÏÑúÎπÑÏä§ Î°úÎìú ÎåÄÍ∏∞
            let apiLoadAttempts = 0;
            while (typeof window.ahpApi === 'undefined' && apiLoadAttempts < 10) {
                console.log('‚è≥ API ÏÑúÎπÑÏä§ Î°úÎìú ÎåÄÍ∏∞ Ï§ë...');
                await new Promise(resolve => setTimeout(resolve, 100));
                apiLoadAttempts++;
            }
            
            if (typeof window.ahpApi === 'undefined') {
                console.error('‚ùå API ÏÑúÎπÑÏä§ Î°úÎìú Ïã§Ìå®');
                showErrorState('API ÏÑúÎπÑÏä§Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Î∞è Í∂åÌïú ÌôïÏù∏
            try {
                const loginResult = await checkLoginStatus();
                if (!loginResult) {
                    console.error('‚ùå Î°úÍ∑∏Ïù∏ÎêòÏßÄ ÏïäÏùå');
                    showAuthErrorState('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.', './login.html');
                    return;
                }
                
                // Í¥ÄÎ¶¨Ïûê Í∂åÌïú Ïû¨ÌôïÏù∏
                if (!window.currentUser || (window.currentUser.role !== 'admin' && !window.currentUser.is_superuser)) {
                    console.error('‚ùå Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÏóÜÏùå');
                    showAuthErrorState('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.', './personal-service-enhanced.html');
                    return;
                }
                
                // Ïù∏Ï¶ù ÏÑ±Í≥µ - Î°úÎî© ÏÉÅÌÉú Ìï¥Ï†úÌïòÍ≥† Ï†ïÏÉÅ ÌéòÏù¥ÏßÄ ÌëúÏãú
                hideLoadingState();
                console.log('‚úÖ Ïù∏Ï¶ù ÏÑ±Í≥µ - Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú ÌëúÏãú');
                
            } catch (error) {
                console.error('‚ùå Ïù∏Ï¶ù ÌôïÏù∏ Ïã§Ìå®:', error);
                showAuthErrorState('Ïù∏Ï¶ù ÌôïÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', './login.html');
                return;
            }
            
            // ÏÑ∏ÏÖò Ï≤¥ÌÅ¨ ÏôÑÎ£å ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
            window.sessionChecked = true;
            console.log('‚úÖ Ïù∏Ï¶ù ÏôÑÎ£å - Ïù¥ÌõÑ Î©îÎâ¥ ÌÅ¥Î¶≠ÏóêÏÑú Ïû¨Ïù∏Ï¶ù ÏïàÌï®');
            
            // ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎî©
            await loadDashboardData();
            
            console.log('‚úÖ ÏäàÌçº Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú Î°úÎìú ÏôÑÎ£å - SPA Î™®Îìú ÌôúÏÑ±Ìôî');
            
            // ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            setupSidebarEventListeners();
        });

        // Î°úÎî© Î∞è ÏóêÎü¨ ÏÉÅÌÉú Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        function showLoadingState() {
            // Í∏∞Ï°¥ Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥Í∞Ä ÏûàÎã§Î©¥ Ï†úÍ±∞
            const existingOverlay = document.getElementById('loading-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥Î•º bodyÏóê Ï∂îÍ∞Ä (Í∏∞Ï°¥ ÏΩòÌÖêÏ∏†Îäî Ïú†ÏßÄ)
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(249, 250, 251, 0.98);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            `;
            
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="
                        width: 50px;
                        height: 50px;
                        border: 4px solid #e5e7eb;
                        border-top: 4px solid #C8A968;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin: 0 auto 1rem;
                    "></div>
                    <h2 style="color: #1f2937; margin-bottom: 0.5rem;">AHP ÏãúÏä§ÌÖú Î°úÎî© Ï§ë...</h2>
                    <p style="color: #6b7280;">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            document.body.appendChild(loadingOverlay);
            console.log('üîÑ Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú');
        }

        function showErrorState(message) {
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #f9fafb;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center; max-width: 500px; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <h2 style="color: #dc2626; margin-bottom: 1rem;">ÏãúÏä§ÌÖú Ïò§Î•ò</h2>
                        <p style="color: #6b7280; margin-bottom: 2rem;">${message}</p>
                        <button onclick="window.location.reload()" style="
                            background: #C8A968;
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 1rem;
                        ">ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®</button>
                    </div>
                </div>
            `;
        }

        function showAuthErrorState(message, redirectUrl) {
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #f9fafb;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center; max-width: 500px; padding: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üîê</div>
                        <h2 style="color: #dc2626; margin-bottom: 1rem;">Ï†ëÍ∑º Í∂åÌïú ÌïÑÏöî</h2>
                        <p style="color: #6b7280; margin-bottom: 2rem;">${message}</p>
                        <div>
                            <button onclick="window.location.href='${redirectUrl}'" style="
                                background: #C8A968;
                                color: white;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 1rem;
                                margin-right: 1rem;
                            ">Î°úÍ∑∏Ïù∏ÌïòÍ∏∞</button>
                            <button onclick="window.location.href='/ahp_app/'" style="
                                background: #6b7280;
                                color: white;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 1rem;
                            ">ÌôàÏúºÎ°ú</button>
                        </div>
                    </div>
                </div>
            `;
            
            // 3Ï¥à ÌõÑ ÏûêÎèô Î¶¨Îã§Ïù¥Î†âÌä∏
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 3000);
        }

        function hideLoadingState() {
            // Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ Ï†úÍ±∞
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
                console.log('‚úÖ Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ Ï†úÍ±∞ ÏôÑÎ£å');
            }
            
            // bodyÍ∞Ä Ïà®Í≤®Ï†∏ ÏûàÎã§Î©¥ ÌëúÏãú
            if (document.body.style.display === 'none') {
                document.body.style.display = '';
                console.log('‚úÖ ÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏† ÌëúÏãú');
            }
        }
        
        // ÏßÅÏ†ë Ïò®ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨ (fallback) - Í∞ÑÏÜåÌôî Î≤ÑÏ†Ñ
        // windowÏóê Îì±Î°ùÌïòÏó¨ HTML onclickÏóêÏÑú Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎèÑÎ°ù Ìï®
        window.handleMenuClick = async function(contentType, element) {
            console.log(`üñ±Ô∏è Î©îÎâ¥ ÌÅ¥Î¶≠: ${contentType}`);
            
            // Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Ï§ëÏßÄ
            if (typeof event !== 'undefined' && event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) {
                console.error('‚ùå main-content ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            // ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±
            if (element) {
                // Î™®Îì† Î©îÎâ¥ÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                // ÌÅ¥Î¶≠Îêú Î©îÎâ¥Ïóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                element.classList.add('active');
            }
            
            // Í∞ÑÎã®Ìïú ÏΩòÌÖêÏ∏† ÏßÅÏ†ë ÌëúÏãú (loadContent Ïö∞Ìöå)
            let content = '';
            switch(contentType) {
                case 'user-management':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏûÖÎãàÎã§.</p>
                                <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                        style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    Django Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Ïó¥Í∏∞
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'project-overview':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">üìä ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô© ÌéòÏù¥ÏßÄÏûÖÎãàÎã§.</p>
                                <p style="margin-top: 1rem;">ÌòÑÏû¨ ÏßÑÌñâ Ï§ëÏù∏ ÌîÑÎ°úÏ†ùÌä∏: 5Í∞ú</p>
                                <p>ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏: 12Í∞ú</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'system-settings':
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">‚öôÔ∏è ÏãúÏä§ÌÖú ÏÑ§Ï†ï</h1>
                            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <p>ÏãúÏä§ÌÖú ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÏûÖÎãàÎã§.</p>
                                <div style="margin-top: 1rem;">
                                    <p><strong>ÏÑúÎ≤Ñ ÏÉÅÌÉú:</strong> Ï†ïÏÉÅ ÏûëÎèô Ï§ë</p>
                                    <p><strong>Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§:</strong> PostgreSQL Ïó∞Í≤∞Îê®</p>
                                    <p><strong>API ÏÉÅÌÉú:</strong> ÌôúÏÑ±</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'dashboard':
                    // ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    window.location.reload();
                    return;
                    
                default:
                    content = `
                        <div style="padding: 2rem;">
                            <h1 style="color: #C8A968; margin-bottom: 2rem;">${contentType}</h1>
                            <div style="background: white; padding: 4rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üöß</div>
                                <p style="color: #666;">Ïù¥ ÌéòÏù¥ÏßÄÎäî ÌòÑÏû¨ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                                <button onclick="handleMenuClick('dashboard', null)" 
                                        style="margin-top: 2rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                                </button>
                            </div>
                        </div>
                    `;
            }
            
            // ÏΩòÌÖêÏ∏† ÏßÅÏ†ë ÏÇΩÏûÖ
            mainContent.innerHTML = content;
            console.log(`‚úÖ ${contentType} ÏΩòÌÖêÏ∏† ÌëúÏãú ÏôÑÎ£å`);
        }
        
        // ÏÇ¨Ïù¥ÎìúÎ∞î Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupSidebarEventListeners() {
            console.log('üîß ÏÇ¨Ïù¥ÎìúÎ∞î Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏãúÏûë...');
            
            const sidebarItems = document.querySelectorAll('.sidebar-item[data-content]');
            console.log(`üîç Î∞úÍ≤¨Îêú ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ ÏöîÏÜå: ${sidebarItems.length}Í∞ú`);
            
            if (sidebarItems.length === 0) {
                console.error('‚ùå ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            sidebarItems.forEach((item, index) => {
                const contentType = item.getAttribute('data-content');
                console.log(`üìù Î©îÎâ¥ ${index + 1}: ${contentType}`);
                
                item.addEventListener('click', async function(event) {
                    console.log(`üñ±Ô∏è Î©îÎâ¥ ÌÅ¥Î¶≠Îê®: ${contentType} (ÏöîÏÜå:`, this, ')');
                    
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ (Îçî ÏÉÅÏÑ∏Ìïú ÎîîÎ≤ÑÍπÖ)
                    console.log('üîç ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥:', window.currentUser);
                    if (!window.currentUser) {
                        console.error('‚ùå Î°úÍ∑∏Ïù∏ÎêòÏßÄ ÏïäÏùå - Î©îÎâ¥ ÌÅ¥Î¶≠ Ï∞®Îã®');
                        
                        // Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ïû¨ÌôïÏù∏ ÏãúÎèÑ
                        try {
                            console.log('üîÑ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ïû¨ÌôïÏù∏ ÏãúÎèÑ...');
                            const userCheckResponse = await window.ahpApi.getCurrentUser();
                            if (userCheckResponse && userCheckResponse.success && userCheckResponse.user) {
                                console.log('‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ïû¨ÌôïÏù∏ ÏÑ±Í≥µ:', userCheckResponse.user);
                                window.currentUser = userCheckResponse.user;
                            } else {
                                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                                window.location.href = './login.html';
                                return;
                            }
                        } catch (error) {
                            console.error('‚ùå ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ïû¨ÌôïÏù∏ Ïã§Ìå®:', error);
                            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                            window.location.href = './login.html';
                            return;
                        }
                    }
                    
                    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏ (Îçî Ïú†Ïó∞Ìïú Ï≤¥ÌÅ¨)
                    const hasAdminAccess = window.currentUser.role === 'admin' || 
                                         window.currentUser.is_superuser || 
                                         window.currentUser.role === 'superuser';
                    
                    if (!hasAdminAccess) {
                        console.error('‚ùå Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÏóÜÏùå - Î©îÎâ¥ ÌÅ¥Î¶≠ Ï∞®Îã®');
                        console.log('üë§ ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ïó≠Ìï†:', window.currentUser.role, 'is_superuser:', window.currentUser.is_superuser);
                        alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                        window.location.href = './personal-service-enhanced.html';
                        return;
                    }
                    
                    // ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±
                    this.style.backgroundColor = '#e3f2fd';
                    setTimeout(() => {
                        this.style.backgroundColor = '';
                    }, 200);
                    
                    // Î™®Îì† Î©îÎâ¥ÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                    sidebarItems.forEach(el => el.classList.remove('active'));
                    
                    // ÌÅ¥Î¶≠Îêú Î©îÎâ¥Ïóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                    this.classList.add('active');
                    console.log(`‚úÖ Active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞ÄÎê®: ${contentType}`);
                    
                    // ÏΩòÌÖêÏ∏† Î°úÎìú
                    try {
                        console.log(`üöÄ loadContent Ìò∏Ï∂ú: ${contentType}`);
                        await loadContent(contentType, this);
                    } catch (error) {
                        console.error('‚ùå loadContent Ìò∏Ï∂ú Ïò§Î•ò:', error);
                    }
                });
                
                // Ìò∏Î≤Ñ Ìö®Í≥º Ï∂îÍ∞Ä
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f5f5f5';
                });
                
                item.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
            
            console.log(`‚úÖ ${sidebarItems.length}Í∞ú ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏôÑÎ£å`);
            
            // ÌÖåÏä§Ìä∏Ïö© Í∏ÄÎ°úÎ≤å Ìï®Ïàò Ï∂îÍ∞Ä
            window.testSidebarMenu = function(contentType) {
                console.log(`üß™ ÌÖåÏä§Ìä∏: ${contentType} Î©îÎâ¥ ÌÅ¥Î¶≠ ÏãúÎÆ¨Î†àÏù¥ÏÖò`);
                const item = document.querySelector(`[data-content="${contentType}"]`);
                if (item) {
                    item.click();
                } else {
                    console.error(`‚ùå ${contentType} Î©îÎâ¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§`);
                }
            };
            
            // Í∞ïÏ†úÎ°ú Î©îÎâ¥ ÏûëÎèô ÌÖåÏä§Ìä∏ Ìï®Ïàò
            window.forceMenuClick = function(contentType) {
                console.log(`üöÄ Í∞ïÏ†ú Î©îÎâ¥ Ïã§Ìñâ: ${contentType}`);
                try {
                    loadContent(contentType);
                } catch (error) {
                    console.error('Í∞ïÏ†ú Î©îÎâ¥ Ïã§Ìñâ Ïã§Ìå®:', error);
                }
            };
            
            // ÎîîÎ≤ÑÍπÖÏö©: Î™®Îì† Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÌôïÏù∏
            window.checkMenuListeners = function() {
                const items = document.querySelectorAll('.sidebar-item[data-content]');
                console.log(`üîç Ï¥ù Î©îÎâ¥ ÏïÑÏù¥ÌÖú: ${items.length}Í∞ú`);
                items.forEach((item, index) => {
                    const listeners = getEventListeners ? getEventListeners(item) : 'DevTools ÌïÑÏöî';
                    console.log(`Î©îÎâ¥ ${index + 1} (${item.getAttribute('data-content')}):`, listeners);
                });
            };
        }

        // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏ (Django API Í∏∞Î∞ò)
        async function checkAdminPermission() {
            try {
                const response = await window.ahpApi.getCurrentUser();
                if (response.success && response.user) {
                    return response.user.role === 'admin' || response.user.is_superuser;
                }
                return false;
            } catch (error) {
                console.error('Í∂åÌïú ÌôïÏù∏ Ïò§Î•ò:', error);
                return false;
            }
        }

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ (ÏóÑÍ≤©Ìïú Î≥¥Ïïà Ï≤¥ÌÅ¨)
        async function checkLoginStatus() {
            console.log('üîç Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ ÏãúÏûë');
            
            // Ï∫êÏãúÎêú Ï†ïÎ≥¥Í∞Ä ÏûàÏñ¥ÎèÑ Ï≤´ Î°úÎìúÏãúÏóî Î∞òÎìúÏãú ÏÑúÎ≤Ñ ÌôïÏù∏
            if (!window.sessionChecked) {
                console.log('‚ö†Ô∏è Ï≤´ Î°úÎìú - ÏÑúÎ≤Ñ Ïù∏Ï¶ù ÌïÑÏàò ÌôïÏù∏');
                window.currentUser = null; // Ï∫êÏãú Ï¥àÍ∏∞Ìôî
            } else if (window.currentUser) {
                console.log('‚úÖ ÏÑ∏ÏÖò Ïù¥ÎØ∏ ÌôïÏù∏Îê®');
                return true;
            }
            
            // ÏµúÎåÄ Ïû¨ÏãúÎèÑ ÌöüÏàò ÏÑ§Ï†ï
            let retryCount = 0;
            const maxRetries = 1;
            
            while (retryCount < maxRetries) {
                try {
                    // API ÏÑúÎπÑÏä§ Ï°¥Ïû¨ Ïó¨Î∂Ä ÌôïÏù∏
                    if (typeof window.ahpApi === 'undefined') {
                        console.error('‚ùå API ÏÑúÎπÑÏä§Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                        await new Promise(resolve => setTimeout(resolve, 1000)); // 1Ï¥à ÎåÄÍ∏∞ ÌõÑ Ïû¨ÏãúÎèÑ
                        if (typeof window.ahpApi === 'undefined') {
                            console.warn('API ÏÑúÎπÑÏä§ Î°úÎìú Ïã§Ìå® - ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ® ÌïÑÏöîÌï† Ïàò ÏûàÏùå');
                            return false;
                        }
                    }
                    
                    const response = await window.ahpApi.getCurrentUser();
                    
                    if (!response || !response.success || !response.user) {
                        console.error('‚ùå Ïù∏Ï¶ù Ïã§Ìå® - ÏÑ∏ÏÖò ÏóÜÏùå');
                        // Ï¶âÏãú Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ (Ïû¨ÏãúÎèÑ ÏóÜÏùå)
                        return false;
                    }
                    
                    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
                    if (response.user.role !== 'admin' && !response.user.is_superuser) {
                        console.warn('‚ùå Í¥ÄÎ¶¨Ïûê Í∂åÌïú Î∂ÄÏ°±');
                        alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                        window.location.href = 'personal-service-enhanced.html';
                        return false;
                    }
                    
                    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï∫êÏã±
                    window.currentUser = response.user;
                    
                    // ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
                    updateUserInfo(response.user);
                    
                    console.log('‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞è Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                    
                    // ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ ÌëúÏãú (Í∏∞Ï°¥ Ìò∏ÌôòÏÑ±)
                    const userNameElement = document.querySelector('.header-user .user-name');
                    if (userNameElement && response.user.name) {
                        userNameElement.textContent = response.user.name;
                    }
                    
                    console.log('‚úÖ Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ ÏôÑÎ£å:', response.user.email || response.user.username);
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå Ïù∏Ï¶ù ÌôïÏù∏ Ïò§Î•ò:', error);
                    // ÏóêÎü¨ Î∞úÏÉù Ïãú Ï¶âÏãú Ï∞®Îã® (Î≥¥Ïïà Ïö∞ÏÑ†)
                    return false;
                }
            }
            
            return false;
        }

        // ÏÇ¨Ïù¥ÎìúÎ∞î ÌÜ†Í∏Ä
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
        }

        // ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎî©
        async function loadDashboardData() {
            try {
                // Î≥ëÎ†¨Î°ú Îç∞Ïù¥ÌÑ∞ Î°úÎî©
                await Promise.all([
                    loadSystemStats(),
                    loadRecentActivity()
                ]);
            } catch (error) {
                console.error('ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïò§Î•ò:', error);
            }
        }

        // ÏãúÏä§ÌÖú ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎî© (Í∞ïÌôîÎêú retry Î°úÏßÅ)
        async function loadSystemStats() {
            const maxRetries = 3;
            let currentTry = 0;
            
            while (currentTry < maxRetries) {
                try {
                    console.log(`üîÑ Django API Ìò∏Ï∂ú ÏãúÎèÑ ${currentTry + 1}/${maxRetries}`);
                    
                    const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/dashboard/stats/?_t=${Date.now()}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        cache: 'no-cache'
                    });

                    if (response.ok) {
                        const stats = await response.json();
                        console.log('‚úÖ Django PostgreSQL Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ:', stats);
                        updateSystemStats(stats);
                        return; // ÏÑ±Í≥µÏãú Ï¢ÖÎ£å
                    } else if (response.status === 403) {
                        console.warn(`‚ö†Ô∏è 403 Forbidden - Render ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë... (ÏãúÎèÑ ${currentTry + 1})`);
                        if (currentTry < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, 2000 * (currentTry + 1))); // Ï†êÏßÑÏ†Å ÏßÄÏó∞
                        }
                    } else {
                        console.error('API Ïò§Î•ò:', response.status, response.statusText);
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error(`ÏãúÎèÑ ${currentTry + 1} Ïã§Ìå®:`, error);
                    if (currentTry < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000 * (currentTry + 1)));
                    }
                }
                currentTry++;
            }
            
            // Î™®Îì† ÏãúÎèÑ Ïã§Ìå®Ïãú fallback Îç∞Ïù¥ÌÑ∞
            console.warn('üîÑ Î™®Îì† API ÏãúÎèÑ Ïã§Ìå® - Render ÏóÖÎç∞Ïù¥Ìä∏ ÎåÄÍ∏∞ Ï§ë');
            updateSystemStats({
                total_users: 'Render ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...',
                active_projects: 'Django Ïû¨ÏãúÏûë Ï§ë...', 
                system_performance: 'Î∞±ÏóîÎìú Î°úÎî© Ï§ë...',
                storage_usage: 'Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ Ï§ë...'
            });
        }

        // ÏãúÏä§ÌÖú ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSystemStats(stats) {
            console.log('üìä Ïã§Ï†ú Django Î∞±ÏóîÎìú Îç∞Ïù¥ÌÑ∞:', stats);
            
            // Ïã§Ï†ú PostgreSQL Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
            document.getElementById('totalUsers').textContent = stats.total_users || '0';
            document.getElementById('activeProjects').textContent = stats.active_projects || '0';
            document.getElementById('systemPerformance').textContent = stats.system_performance ? `${stats.system_performance}%` : 'Ï†ïÏÉÅ';
            document.getElementById('storageUsage').textContent = stats.storage_usage ? `${stats.storage_usage}%` : 'Ï†ïÏÉÅ';

            // Django Í≥ÑÏÇ∞Îêú Ïã§Ï†ú Ï¶ùÍ∞ÄÏú® ÌëúÏãú
            document.getElementById('userChange').textContent = stats.user_growth ? `‚Üë +${stats.user_growth}% (Ïù¥Î≤à Îã¨)` : 'Ïã§ÏãúÍ∞Ñ PostgreSQL Îç∞Ïù¥ÌÑ∞';
            document.getElementById('projectChange').textContent = stats.project_growth ? `‚Üë +${stats.project_growth}% (Ïù¥Î≤à Ï£º)` : 'Ïã§ÏãúÍ∞Ñ Django ÌÜµÍ≥Ñ';
            document.getElementById('performanceStatus').textContent = stats.performance_status || 'ÏãúÏä§ÌÖú Ï†ïÏÉÅ ÏûëÎèô';
            document.getElementById('storageStatus').textContent = stats.storage_status || 'Ïó¨Ïú† Í≥µÍ∞Ñ Ï∂©Î∂Ñ';
            
            // Django Î∞±ÏóîÎìú ÏÑ±Í≥µ ÌëúÏãú
            const statusEl = document.querySelector('.admin-card-value');
            if (statusEl) {
                statusEl.style.color = '#10b981'; // ÎÖπÏÉâÏúºÎ°ú ÏÑ±Í≥µ ÌëúÏãú
            }
        }

        // ÏµúÍ∑º ÌôúÎèô Îç∞Ïù¥ÌÑ∞ Î°úÎî©
        async function loadRecentActivity() {
            try {
                const response = await fetch(`https://ahp-django-backend.onrender.com/super-admin/api/audit/logs/?limit=5&_t=${Date.now()}`, {
                    credentials: 'include',
                    cache: 'no-cache'
                });

                if (response.ok) {
                    const activities = await response.json();
                    updateRecentActivity(activities.results || activities);
                } else {
                    updateRecentActivity([]);
                }
            } catch (error) {
                console.error('ÏµúÍ∑º ÌôúÎèô Î°úÎî© Ïã§Ìå®:', error);
                updateRecentActivity([]);
            }
        }

        // ÏµúÍ∑º ÌôúÎèô ÏóÖÎç∞Ïù¥Ìä∏
        function updateRecentActivity(activities) {
            const activityList = document.getElementById('activityList');
            
            if (!activities || activities.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon system">üìä</div>
                        <div class="activity-content">
                            <div class="activity-title">ÏïÑÏßÅ ÌôúÎèô Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
                            <div class="activity-time">ÏÑúÎπÑÏä§ ÏÇ¨Ïö©Ïù¥ ÏãúÏûëÎêòÎ©¥ ÌôúÎèô ÎÇ¥Ïó≠Ïù¥ ÌëúÏãúÎê©ÎãàÎã§</div>
                        </div>
                    </li>
                `;
                return;
            }

            const activityHtml = activities.map(activity => {
                const iconMap = {
                    'user_created': { icon: 'üë§', class: 'user' },
                    'project_created': { icon: 'üìä', class: 'project' },
                    'system_backup': { icon: 'üíæ', class: 'system' },
                    'login_success': { icon: 'üîì', class: 'user' },
                    'admin_action': { icon: '‚öôÔ∏è', class: 'system' },
                    'security_alert': { icon: 'üö®', class: 'alert' }
                };

                const iconData = iconMap[activity.action_type] || { icon: 'üìã', class: 'system' };

                return `
                    <li class="activity-item">
                        <div class="activity-icon ${iconData.class}">${iconData.icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description || activity.action}</div>
                            <div class="activity-time">${formatTimeAgo(activity.timestamp || activity.created_at)}</div>
                        </div>
                    </li>
                `;
            }).join('');

            activityList.innerHTML = activityHtml;
        }

        // ÏãúÍ∞Ñ Ï∞®Ïù¥ Í≥ÑÏÇ∞ 
        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'ÏãúÍ∞Ñ Î∂àÎ™Ö';
            
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Î∞©Í∏à Ï†Ñ';
            if (diffMins < 60) return `${diffMins}Î∂Ñ Ï†Ñ`;
            if (diffHours < 24) return `${diffHours}ÏãúÍ∞Ñ Ï†Ñ`;
            return `${diffDays}Ïùº Ï†Ñ`;
        }

        // Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Î°úÎî© - Django PostgreSQL ÏßÅÏ†ë Ïó∞Îèô
        async function loadRealUserData() {
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/users/list/', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const userData = await response.json();
                    showUserDataModal(userData);
                } else {
                    alert('ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®. Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïò§Î•ò:', error);
                alert('ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Î™®Îã¨ ÌëúÏãú
        function showUserDataModal(data) {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 0; left: 0; 
                    width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.8); 
                    display: flex; 
                    justify-content: center; 
                    align-items: center;
                    z-index: 10000;
                " onclick="this.remove()">
                    <div style="
                        background: white; 
                        padding: 2rem; 
                        border-radius: 12px; 
                        max-width: 800px; 
                        max-height: 80vh; 
                        overflow-y: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    " onclick="event.stopPropagation()">
                        <h2>üî• Ïã§ÏãúÍ∞Ñ PostgreSQL ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞</h2>
                        <div style="margin-bottom: 1rem;">
                            <strong>Ï¥ù ÏÇ¨Ïö©Ïûê:</strong> ${data.total || 0}Î™Ö<br>
                            <strong>ÌôúÏÑ± ÏÇ¨Ïö©Ïûê:</strong> ${data.stats?.active_users || 0}Î™Ö<br>
                            <strong>Í¥ÄÎ¶¨Ïûê:</strong> ${data.stats?.staff_users || 0}Î™Ö<br>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.users ? data.users.map(user => `
                                <div style="
                                    border: 1px solid #eee; 
                                    padding: 1rem; 
                                    margin: 0.5rem 0; 
                                    border-radius: 8px;
                                    background: #f9f9f9;
                                ">
                                    <strong>${user.email}</strong> (${user.username})<br>
                                    <small>
                                        ÌÉÄÏûÖ: ${user.user_type} | 
                                        Íµ¨ÎèÖ: ${user.subscription_tier} | 
                                        Í∞ÄÏûÖÏùº: ${new Date(user.date_joined).toLocaleDateString('ko-KR')}
                                        ${user.last_login ? ` | ÏµúÏ¢ÖÎ°úÍ∑∏Ïù∏: ${new Date(user.last_login).toLocaleDateString('ko-KR')}` : ''}
                                    </small>
                                </div>
                            `).join('') : 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå'}
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                style="
                                    background: #C8A968; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                    margin-right: 1rem;
                                ">Django Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê</button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="
                                    background: #6b7280; 
                                    color: white; 
                                    border: none; 
                                    padding: 0.7rem 1.5rem; 
                                    border-radius: 6px; 
                                    cursor: pointer;
                                ">Îã´Í∏∞</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // SPA ÏΩòÌÖêÏ∏† Î°úÎî© Ìï®Ïàò (ÏÑ∏ÏÖò Ï≤¥ÌÅ¨ Í∞ïÌôî)
        async function loadContent(contentType, clickedElement = null) {
            console.log(`üîÑ ÏΩòÌÖêÏ∏† Î°úÎî© ÏãúÏûë: ${contentType}`);
            console.log(`üìç ÌÅ¥Î¶≠Îêú ÏöîÏÜå:`, clickedElement);
            
            // Ïù¥Î≤§Ìä∏ Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄ
            if (typeof event !== 'undefined' && event) {
                event.preventDefault();
                event.stopPropagation();
                console.log('üõ°Ô∏è Ïù¥Î≤§Ìä∏ Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄÎê®');
            }
            
            // Ï§ëÎ≥µ Ïã§Ìñâ Î∞©ÏßÄ
            if (window.loadContentInProgress) {
                console.log('‚è∏Ô∏è Ïù¥ÎØ∏ ÏΩòÌÖêÏ∏† Î°úÎî© Ï§ë - Í±¥ÎÑàÎúÄ');
                return;
            }
            window.loadContentInProgress = true;
            console.log('üöÄ ÏΩòÌÖêÏ∏† Î°úÎî© ÌîåÎûòÍ∑∏ ÏÑ§Ï†ïÎê®');
            
            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ (Îß§Î≤à Ï≤¥ÌÅ¨)
            if (!window.currentUser) {
                console.error('‚ùå Î°úÍ∑∏Ïù∏ÎêòÏßÄ ÏïäÏùå - Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô');
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                window.location.href = 'login.html';
                window.loadContentInProgress = false;
                return;
            }
            
            // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
            if (window.currentUser.role !== 'admin' && !window.currentUser.is_superuser) {
                console.error('‚ùå Í∂åÌïú ÏóÜÏùå - Í¥ÄÎ¶¨ÏûêÎßå Ï†ëÍ∑º Í∞ÄÎä•');
                alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                window.location.href = 'personal-service-enhanced.html';
                window.loadContentInProgress = false;
                return;
            }
            
            // Ìó§ÎçîÏôÄ ÏÇ¨Ïù¥ÎìúÎ∞î Í∞ÄÏãúÏÑ± Î≥¥Ïû•
            const header = document.querySelector('.header');
            const sidebar = document.querySelector('.sidebar');
            if (header) {
                header.style.display = 'flex';
                header.style.position = 'fixed';
                header.style.top = '0';
                header.style.left = '0';
                header.style.right = '0';
                header.style.zIndex = '1000';
                console.log('üîù Ìó§Îçî ÌëúÏãú Î≥¥Ïû•Îê®');
            }
            if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.style.position = 'fixed';
                sidebar.style.left = '0';
                sidebar.style.top = 'var(--header-height)';
                sidebar.style.zIndex = '999';
                console.log('üìã ÏÇ¨Ïù¥ÎìúÎ∞î ÌëúÏãú Î≥¥Ïû•Îê®');
            }

            const mainContent = document.querySelector('.main-content');
            console.log('üéØ Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ Ï∞æÍ∏∞:', mainContent);
            
            if (!mainContent) {
                console.error('‚ùå Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠(.main-content)ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
                window.loadContentInProgress = false;
                return;
            }
            
            // Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏúÑÏπò Î≥¥Ïû• (Ìó§Îçî/ÏÇ¨Ïù¥ÎìúÎ∞î Í≥†Î†§)
            mainContent.style.marginLeft = 'var(--sidebar-width)';
            mainContent.style.marginTop = 'var(--header-height)';
            mainContent.style.position = 'relative';
            console.log('üìç Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏúÑÏπò Ï°∞Ï†ïÎê®');
            
            // Î°úÎî© ÌëúÏãú
            console.log('‚è≥ Î°úÎî© ÌôîÎ©¥ ÌëúÏãú Ï§ë...');
            mainContent.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 50vh;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîÑ</div>
                        <div>ÏΩòÌÖêÏ∏†Î•º Î°úÎìúÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                        <div style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">ÌÉÄÏûÖ: ${contentType}</div>
                    </div>
                </div>
            `;

            try {
                console.log(`üìù ÏΩòÌÖêÏ∏† ÌÉÄÏûÖÎ≥Ñ ÏÉùÏÑ± ÏãúÏûë: ${contentType}`);
                
                // Í∞Å ÏΩòÌÖêÏ∏† ÌÉÄÏûÖÏóê Îî∞Î•∏ ÎÇ¥Ïö© ÏÉùÏÑ±
                let content = '';
                
                switch(contentType) {
                    case 'dashboard':
                        console.log('üè† ÎåÄÏãúÎ≥¥Îìú ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateDashboardContent();
                        break;
                    case 'user-management':
                        console.log('üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateUserManagementContent();
                        break;
                    case 'project-overview':
                        console.log('üìä ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô© ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateProjectOverviewContent();
                        break;
                    case 'system-settings':
                        console.log('‚öôÔ∏è ÏãúÏä§ÌÖú ÏÑ§Ï†ï ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateSystemSettingsContent();
                        break;
                    case 'audit-log':
                        console.log('üìã Í∞êÏÇ¨ Î°úÍ∑∏ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateAuditLogContent();
                        break;
                    case 'backup-restore':
                        console.log('üíæ Î∞±ÏóÖ Î∞è Î≥µÏõê ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateBackupRestoreContent();
                        break;
                    case 'database-management':
                        console.log('üóÑÔ∏è Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateDatabaseManagementContent();
                        break;
                    case 'data-migration':
                        console.log('üì§ Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateDataMigrationContent();
                        break;
                    case 'security-settings':
                        console.log('üîí Î≥¥Ïïà ÏÑ§Ï†ï ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateSecuritySettingsContent();
                        break;
                    case 'access-control':
                        console.log('üõ°Ô∏è Ï†ëÍ∑º Ï†úÏñ¥ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateAccessControlContent();
                        break;
                    case 'security-log':
                        console.log('üö® Î≥¥Ïïà Î°úÍ∑∏ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ï§ë...');
                        content = await generateSecurityLogContent();
                        break;
                    default:
                        console.log('‚ùì Ïïå Ïàò ÏóÜÎäî ÏΩòÌÖêÏ∏† ÌÉÄÏûÖ - Í∏∞Î≥∏ ÎåÄÏãúÎ≥¥ÎìúÎ°ú fallback');
                        content = await generateDashboardContent();
                }
                
                console.log(`üìÑ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± ÏôÑÎ£å, HTML Í∏∏Ïù¥: ${content.length} Î¨∏Ïûê`);
                console.log(`üé® ÏΩòÌÖêÏ∏† ÎØ∏Î¶¨Î≥¥Í∏∞: ${content.substring(0, 200)}...`);
                
                if (!content || content.trim().length === 0) {
                    console.error('‚ùå Îπà ÏΩòÌÖêÏ∏†Í∞Ä ÏÉùÏÑ±Îê®!');
                    content = `
                        <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px; margin: 1rem;">
                            <h2 style="color: #dc2626; margin-bottom: 1rem;">‚ö†Ô∏è ÏΩòÌÖêÏ∏† Î°úÎî© Ïò§Î•ò</h2>
                            <p style="color: #666; margin-bottom: 2rem;">${contentType} ÏΩòÌÖêÏ∏†Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>
                            <button onclick="window.location.reload()" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®</button>
                        </div>
                    `;
                }
                
                console.log('üñºÔ∏è Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠Ïóê HTML ÏÇΩÏûÖ Ï§ë...');
                mainContent.innerHTML = content;
                
                console.log('‚úÖ ÏΩòÌÖêÏ∏† ÏÇΩÏûÖ ÏôÑÎ£å');
                console.log('üìç ÌòÑÏû¨ Î©îÏù∏ ÏΩòÌÖêÏ∏† innerHTML:', mainContent.innerHTML.substring(0, 100) + '...');
                
                // ÎåÄÏãúÎ≥¥ÎìúÏù∏ Í≤ΩÏö∞ Îç∞Ïù¥ÌÑ∞ Î°úÎî©
                if (contentType === 'dashboard') {
                    console.log('üìä ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÏãúÏûë...');
                    await loadDashboardData();
                    console.log('üìä ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÏôÑÎ£å');
                }
                
                console.log(`‚úÖ ÏΩòÌÖêÏ∏† Î°úÎî© ÏôÑÎ£å: ${contentType}`);
                
            } catch (error) {
                console.error('‚ùå ÏΩòÌÖêÏ∏† Î°úÎî© Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
                console.error('‚ùå Ïò§Î•ò ÏÉÅÏÑ∏ Ï†ïÎ≥¥:', error.stack);
                
                const errorContent = `
                    <div style="text-align: center; color: #ef4444; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                        <div>ÏΩòÌÖêÏ∏† Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</div>
                        <div style="font-size: 0.9rem; color: #666; margin: 1rem 0;">Ïò§Î•ò: ${error.message}</div>
                        <button onclick="loadContent('dashboard', null)" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                `;
                
                console.log('üîÑ Ïò§Î•ò ÏΩòÌÖêÏ∏† ÌëúÏãú Ï§ë...');
                mainContent.innerHTML = errorContent;
                
            } finally {
                // Î°úÎî© ÏÉÅÌÉú Ìï¥Ï†ú
                console.log('üèÅ ÏΩòÌÖêÏ∏† Î°úÎî© ÌîåÎûòÍ∑∏ Ìï¥Ï†ú');
                window.loadContentInProgress = false;
            }
        }

        // ÎåÄÏãúÎ≥¥Îìú ÏΩòÌÖêÏ∏† ÏÉùÏÑ±
        async function generateDashboardContent() {
            return `
                ${generatePageHeader('ÎåÄÏãúÎ≥¥Îìú', 'üè†', ['AHP ÏãúÏä§ÌÖú', 'ÏäàÌçº Í¥ÄÎ¶¨Ïûê', 'ÎåÄÏãúÎ≥¥Îìú'])}
                
                <!-- ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ -->
                <div class="dashboard-grid">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">üë•</span>
                                Ï¥ù ÏÇ¨Ïö©Ïûê
                            </div>
                        </div>
                        <div class="admin-card-value" id="totalUsers">Î°úÎî©...</div>
                        <div class="admin-card-change change-positive" id="userChange">
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">üìä</span>
                                ÌôúÏÑ± ÌîÑÎ°úÏ†ùÌä∏
                            </div>
                        </div>
                        <div class="admin-card-value" id="activeProjects">Î°úÎî©...</div>
                        <div class="admin-card-change change-positive" id="projectChange">
                            Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">‚ö°</span>
                                ÏãúÏä§ÌÖú ÏÑ±Îä•
                            </div>
                        </div>
                        <div class="admin-card-value" id="systemPerformance">Î°úÎî©...</div>
                        <div class="admin-card-change change-positive" id="performanceStatus">
                            ÏãúÏä§ÌÖú ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-title">
                                <span class="admin-card-icon">üíæ</span>
                                Ï†ÄÏû•ÏÜå ÏÇ¨Ïö©Î•†
                            </div>
                        </div>
                        <div class="admin-card-value" id="storageUsage">Î°úÎî©...</div>
                        <div class="admin-card-change change-positive" id="storageStatus">
                            Ï†ÄÏû•ÏÜå ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...
                        </div>
                    </div>
                </div>

                <!-- Í¥ÄÎ¶¨ ÏÑπÏÖò -->
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÌïµÏã¨ Í¥ÄÎ¶¨ Í∏∞Îä•</h2>
                    </div>
                    <div class="management-grid">
                        <div class="management-card" onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')">
                            <div class="management-card-icon">üë•</div>
                            <div class="management-card-title">Django ÏäàÌçº Í¥ÄÎ¶¨Ïûê</div>
                            <div class="management-card-desc">
                                üî• Ïã§Ï†ú PostgreSQL ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨, Í≤∞Ï†ú Í¥ÄÎ¶¨, ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ - ÏôÑÏ†Ñ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
                            </div>
                        </div>

                        <div class="management-card" onclick="loadRealUserData()">
                            <div class="management-card-icon">üìä</div>
                            <div class="management-card-title">Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê ÌòÑÌô©</div>
                            <div class="management-card-desc">
                                üî• PostgreSQL Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞, Í∞ÄÏûÖ ÌòÑÌô©, ÌôúÎèô ÌÜµÍ≥Ñ
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('system-settings', null)">
                            <div class="management-card-icon">üìà</div>
                            <div class="management-card-title">ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ</div>
                            <div class="management-card-desc">
                                ÏÑúÎ≤Ñ ÏÑ±Îä•, Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§, API ÏÉÅÌÉú Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('backup-restore', null)">
                            <div class="management-card-icon">üíæ</div>
                            <div class="management-card-title">Î∞±ÏóÖ Í¥ÄÎ¶¨</div>
                            <div class="management-card-desc">
                                Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ, Î≥µÏõê Î∞è Ïû¨Ìï¥ Î≥µÍµ¨ Í¥ÄÎ¶¨
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('security-settings', null)">
                            <div class="management-card-icon">üîí</div>
                            <div class="management-card-title">Î≥¥Ïïà ÏÑ§Ï†ï</div>
                            <div class="management-card-desc">
                                ÏãúÏä§ÌÖú Î≥¥Ïïà Ï†ïÏ±Ö, Ïù∏Ï¶ù Î∞è ÏïîÌò∏Ìôî ÏÑ§Ï†ï
                            </div>
                        </div>

                        <div class="management-card" onclick="loadContent('audit-log', null)">
                            <div class="management-card-icon">üìã</div>
                            <div class="management-card-title">Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
                            <div class="management-card-desc">
                                ÏÇ¨Ïö©Ïûê ÌôúÎèô, ÏãúÏä§ÌÖú ÏÇ¨Ïö©Î•† Î∞è ÏÑ±Îä• Î∂ÑÏÑù
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÏµúÍ∑º ÌôúÎèô -->
                <div class="recent-activity">
                    <div class="section-header">
                        <h2 class="section-title">ÏµúÍ∑º ÏãúÏä§ÌÖú ÌôúÎèô</h2>
                    </div>
                    <ul class="activity-list" id="activityList">
                        <li class="activity-item">
                            <div class="activity-icon system">üì°</div>
                            <div class="activity-content">
                                <div class="activity-title">ÏµúÍ∑º ÌôúÎèô Îç∞Ïù¥ÌÑ∞Î•º Î°úÎî©ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                                <div class="activity-time">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</div>
                            </div>
                        </li>
                    </ul>
                </div>
            `;
        }

        // Í≥µÌÜµ ÌéòÏù¥ÏßÄ Ìó§Îçî ÏÉùÏÑ±
        function generatePageHeader(title, icon, breadcrumb = []) {
            const breadcrumbHtml = breadcrumb.length > 0 
                ? `<div class="breadcrumb" style="margin-bottom: 1rem; color: #666;">
                     ${breadcrumb.map(item => `<span>${item}</span>`).join(' > ')}
                   </div>`
                : '';
                
            return `
                <div class="page-header" style="background: white; padding: 1.5rem 2rem; margin: -2rem -2rem 2rem -2rem; border-bottom: 1px solid #e5e7eb;">
                    ${breadcrumbHtml}
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <h1 style="font-size: 1.75rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 2rem;">${icon}</span>
                            ${title}
                        </h1>
                        <div class="page-actions">
                            <!-- ÌéòÏù¥ÏßÄÎ≥Ñ Ïï°ÏÖò Î≤ÑÌäº ÏòÅÏó≠ -->
                        </div>
                    </div>
                </div>
            `;
        }

        // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ÏΩòÌÖêÏ∏† ÏÉùÏÑ±
        async function generateUserManagementContent() {
            return `
                ${generatePageHeader('ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨', 'üë•', ['ÎåÄÏãúÎ≥¥Îìú', 'ÏãúÏä§ÌÖú Í¥ÄÎ¶¨', 'ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÏÇ¨Ïö©Ïûê ÌòÑÌô©</h2>
                        <button class="btn btn-primary" onclick="loadRealUserData()">Ïã§ÏãúÍ∞Ñ ÏÇ¨Ïö©Ïûê Ï°∞Ìöå</button>
                    </div>
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #2563eb; margin-bottom: 0.5rem;" id="userStatsTotal">-</div>
                                <div style="color: #666;">Ï¥ù ÏÇ¨Ïö©Ïûê</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #10b981; margin-bottom: 0.5rem;" id="userStatsActive">-</div>
                                <div style="color: #666;">ÌôúÏÑ± ÏÇ¨Ïö©Ïûê</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 2rem; color: #f59e0b; margin-bottom: 0.5rem;" id="userStatsAdmin">-</div>
                                <div style="color: #666;">Í¥ÄÎ¶¨Ïûê</div>
                            </div>
                        </div>
                        <div style="text-align: center; color: #666; margin: 2rem 0;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üîß</div>
                            <p>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨Îäî Django Í¥ÄÎ¶¨Ïûê Ìå®ÎÑêÏóêÏÑú ÏàòÌñâÎê©ÎãàÎã§</p>
                            <button onclick="window.open('https://ahp-django-backend.onrender.com/admin/', '_blank')" 
                                    style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #C8A968; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Django Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Ïó¥Í∏∞
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Îã§Î•∏ ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Ìï®ÏàòÎì§ (ÌéòÏù¥ÏßÄ Ìó§Îçî Ï†ÅÏö©)
        async function generateProjectOverviewContent() {
            return `
                ${generatePageHeader('ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©', 'üìä', ['ÎåÄÏãúÎ≥¥Îìú', 'ÏãúÏä§ÌÖú Í¥ÄÎ¶¨', 'ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÌôúÏÑ± ÌîÑÎ°úÏ†ùÌä∏ ÌÜµÍ≥Ñ</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üöß</div>
                        <h3>ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô© Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">ÌîÑÎ°úÏ†ùÌä∏ ÌÜµÍ≥Ñ Î∞è Í¥ÄÎ¶¨ Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSystemSettingsContent() {
            return `
                ${generatePageHeader('ÏãúÏä§ÌÖú ÏÑ§Ï†ï', '‚öôÔ∏è', ['ÎåÄÏãúÎ≥¥Îìú', 'ÏãúÏä§ÌÖú Í¥ÄÎ¶¨', 'ÏãúÏä§ÌÖú ÏÑ§Ï†ï'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÏÑúÎ≤Ñ Î™®ÎãàÌÑ∞ÎßÅ</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚öôÔ∏è</div>
                        <h3>ÏãúÏä§ÌÖú ÏÑ§Ï†ï Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">ÏãúÏä§ÌÖú ÏÑ§Ï†ï Î∞è Î™®ÎãàÌÑ∞ÎßÅ Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateAuditLogContent() {
            return `
                ${generatePageHeader('Í∞êÏÇ¨ Î°úÍ∑∏', 'üìã', ['ÎåÄÏãúÎ≥¥Îìú', 'ÏãúÏä§ÌÖú Í¥ÄÎ¶¨', 'Í∞êÏÇ¨ Î°úÍ∑∏'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÏãúÏä§ÌÖú ÌôúÎèô Í∏∞Î°ù</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìã</div>
                        <h3>Í∞êÏÇ¨ Î°úÍ∑∏ Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">ÏãúÏä§ÌÖú Í∞êÏÇ¨ Î°úÍ∑∏ Î∞è ÌôúÎèô Ï∂îÏ†Å Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateBackupRestoreContent() {
            return `
                ${generatePageHeader('Î∞±ÏóÖ Î∞è Î≥µÏõê', 'üíæ', ['ÎåÄÏãúÎ≥¥Îìú', 'Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨', 'Î∞±ÏóÖ Î∞è Î≥µÏõê'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ Í¥ÄÎ¶¨</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üíæ</div>
                        <h3>Î∞±ÏóÖ Î∞è Î≥µÏõê Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ Î∞è Î≥µÏõê Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateDatabaseManagementContent() {
            return `
                ${generatePageHeader('Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨', 'üóÑÔ∏è', ['ÎåÄÏãúÎ≥¥Îìú', 'Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨', 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">PostgreSQL Í¥ÄÎ¶¨</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üóÑÔ∏è</div>
                        <h3>Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">PostgreSQL Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨ Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateDataMigrationContent() {
            return `
                ${generatePageHeader('Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò', 'üì§', ['ÎåÄÏãúÎ≥¥Îìú', 'Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨', 'Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">Îç∞Ïù¥ÌÑ∞ Ïù¥Ï†Ñ Î∞è Ï†ÑÏÜ°</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üì§</div>
                        <h3>Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò</h3>
                        <p style="color: #666; margin: 1rem 0;">Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Î∞è Ï†ÑÏÜ° Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSecuritySettingsContent() {
            return `
                ${generatePageHeader('Î≥¥Ïïà ÏÑ§Ï†ï', 'üîí', ['ÎåÄÏãúÎ≥¥Îìú', 'Î≥¥Ïïà Í¥ÄÎ¶¨', 'Î≥¥Ïïà ÏÑ§Ï†ï'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÏãúÏä§ÌÖú Î≥¥Ïïà Ï†ïÏ±Ö</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîí</div>
                        <h3>Î≥¥Ïïà ÏÑ§Ï†ï Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">ÏãúÏä§ÌÖú Î≥¥Ïïà ÏÑ§Ï†ï Î∞è Ï†ïÏ±Ö Í¥ÄÎ¶¨ Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateAccessControlContent() {
            return `
                ${generatePageHeader('Ï†ëÍ∑º Ï†úÏñ¥', 'üõ°Ô∏è', ['ÎåÄÏãúÎ≥¥Îìú', 'Î≥¥Ïïà Í¥ÄÎ¶¨', 'Ï†ëÍ∑º Ï†úÏñ¥'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">ÏÇ¨Ïö©Ïûê Í∂åÌïú Í¥ÄÎ¶¨</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üõ°Ô∏è</div>
                        <h3>Ï†ëÍ∑º Ï†úÏñ¥ Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">ÏÇ¨Ïö©Ïûê Í∂åÌïú Î∞è Ï†ëÍ∑º Ï†úÏñ¥ Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        async function generateSecurityLogContent() {
            return `
                ${generatePageHeader('Î≥¥Ïïà Î°úÍ∑∏', 'üö®', ['ÎåÄÏãúÎ≥¥Îìú', 'Î≥¥Ïïà Í¥ÄÎ¶¨', 'Î≥¥Ïïà Î°úÍ∑∏'])}
                
                <div class="management-section">
                    <div class="section-header">
                        <h2 class="section-title">Î≥¥Ïïà Ïù¥Î≤§Ìä∏ Ï∂îÏ†Å</h2>
                    </div>
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üö®</div>
                        <h3>Î≥¥Ïïà Î°úÍ∑∏ Í¥ÄÎ¶¨</h3>
                        <p style="color: #666; margin: 1rem 0;">Î≥¥Ïïà Ïù¥Î≤§Ìä∏ Î°úÍ∑∏ Î∞è ÏïåÎ¶º Í∏∞Îä•ÏùÑ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
                        <button onclick="loadContent('dashboard', null)" style="padding: 0.5rem 1rem; background: #C8A968; color: white; border: none; border-radius: 4px;">
                            ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        // Í∞úÏù∏ ÏÑúÎπÑÏä§ Î™®ÎìúÎ°ú Ï†ÑÌôò
        function switchToPersonalService() {
            if (!window.currentUser || !window.currentUser.is_superuser) {
                alert('ÏäàÌçº Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                return;
            }
            
            if (confirm('Í∞úÏù∏ ÏÑúÎπÑÏä§ Î™®ÎìúÎ°ú Ï†ÑÌôòÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                console.log('üë§ Í∞úÏù∏ ÏÑúÎπÑÏä§ Î™®ÎìúÎ°ú Ï†ÑÌôò Ï§ë...');
                window.location.href = './personal-service-enhanced.html';
            }
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (ÏäàÌçº Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú Ï†ÑÏö©)
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userRoleText = document.getElementById('userRoleText');
            const adminBadge = document.getElementById('adminBadge');
            const userAvatar = document.getElementById('userAvatar');

            if (userName) {
                userName.textContent = user.name || user.username || 'Í¥ÄÎ¶¨Ïûê';
            }

            if (userRoleText) {
                let roleText = 'System Admin';
                if (user.is_superuser) {
                    roleText = 'Super Admin';
                } else if (user.is_staff) {
                    roleText = 'Staff Admin';
                } else if (user.role === 'admin') {
                    roleText = 'Admin';
                }
                userRoleText.textContent = roleText;
            }

            // Í¥ÄÎ¶¨Ïûê Î∞∞ÏßÄ ÌëúÏãú
            if (adminBadge) {
                if (user.is_superuser) {
                    adminBadge.textContent = 'üõ°Ô∏è ÏäàÌçº Í¥ÄÎ¶¨Ïûê';
                    adminBadge.style.display = 'inline-block';
                } else if (user.is_staff || user.role === 'admin') {
                    adminBadge.textContent = 'üõ°Ô∏è Í¥ÄÎ¶¨Ïûê';
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }

            if (userAvatar) {
                const name = user.name || user.username || 'Í¥ÄÎ¶¨Ïûê';
                userAvatar.textContent = name.charAt(0).toUpperCase();
                
                // ÏäàÌçº Í¥ÄÎ¶¨ÏûêÎäî Î†àÎìú Î∞∞Í≤Ω, ÏùºÎ∞ò Í¥ÄÎ¶¨ÏûêÎäî Í≥®Îìú Î∞∞Í≤Ω
                if (user.is_superuser) {
                    userAvatar.style.background = 'linear-gradient(135deg, #dc2626, #b91c1c)';
                } else if (user.is_staff || user.role === 'admin') {
                    userAvatar.style.background = 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))';
                } else {
                    userAvatar.style.background = '#6b7280';
                }
            }

            // Í∞úÏù∏ ÏÑúÎπÑÏä§ ÌÜ†Í∏Ä Î≤ÑÌäº ÌëúÏãú Ïó¨Î∂Ä Í≤∞Ï†ï (ÏäàÌçº Í¥ÄÎ¶¨ÏûêÎßå)
            const personalServiceToggle = document.getElementById('personalServiceToggle');
            if (personalServiceToggle && user.is_superuser) {
                personalServiceToggle.style.display = 'block';
                console.log('‚úÖ ÏäàÌçº Í¥ÄÎ¶¨Ïûê - Í∞úÏù∏ ÏÑúÎπÑÏä§ ÌÜ†Í∏Ä Î≤ÑÌäº ÌëúÏãú');
            } else if (personalServiceToggle) {
                personalServiceToggle.style.display = 'none';
                console.log('‚ùå ÏùºÎ∞ò Í¥ÄÎ¶¨Ïûê - Í∞úÏù∏ ÏÑúÎπÑÏä§ ÌÜ†Í∏Ä Î≤ÑÌäº Ïà®ÍπÄ');
            }
        }

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ ÌõÑ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìò∏Ï∂ú
        async function initializeUserInterface() {
            try {
                const user = window.currentUser;
                if (user) {
                    updateUserInfo(user);
                    console.log('üé® ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                }
            } catch (error) {
                console.error('‚ùå ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
            }
        }

        // Î°úÍ∑∏ÏïÑÏõÉ (Django API Í∏∞Î∞ò)
        async function handleLogout() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                try {
                    // Ï∫êÏãúÎêú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†úÍ±∞
                    window.currentUser = null;
                    window.sessionChecked = false;
                    
                    await window.ahpApi.logout();
                    window.location.href = 'login.html?message=logout';
                } catch (error) {
                    console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:', error);
                    // Ïò§Î•òÍ∞Ä Î∞úÏÉùÌï¥ÎèÑ Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                    window.location.href = 'login.html';
                }
            }
        }
    </script>
</body>
</html>