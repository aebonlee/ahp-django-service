<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - 개인 서비스 대시보드 (Enhanced)</title>
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-elevated: #f3f4f6;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --header-height: 60px;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* 상단 헤더 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: white;
            border-bottom: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .logo:hover {
            color: var(--accent-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .header-nav {
            display: flex;
            gap: 1rem;
        }

        .header-nav-item {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .header-nav-item:hover {
            background: var(--bg-secondary);
            color: var(--accent-primary);
        }

        .header-nav-item.active {
            background: var(--accent-light);
            color: var(--accent-primary);
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-mode-toggle {
            display: none; /* 기본적으로 숨김 */
            padding: 0.5rem 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-mode-toggle:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .admin-mode-toggle.show {
            display: block;
        }

        .admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .user-role {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        /* 엔터프라이즈 급 브랜딩 */
        .enterprise-header {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .enterprise-content {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow-lg);
        }

        /* 엔터프라이즈급 알림 및 상태 표시 */
        .status-indicator {
            position: relative;
            display: inline-block;
        }

        .status-indicator::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-indicator.offline::after {
            background: #ef4444;
        }

        /* 프리미엄 그라데이션 */
        .premium-gradient {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, #8B5A2B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 20px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--accent-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* 왼쪽 사이드바 */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: white;
            border-right: 1px solid var(--border-light);
            overflow-y: auto;
            z-index: 999;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-200px);
        }

        .sidebar-toggle {
            position: fixed;
            top: calc(var(--header-height) + 1rem);
            left: calc(var(--sidebar-width) + 1rem);
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            z-index: 998;
            transition: all 0.3s;
        }

        .sidebar.collapsed + .sidebar-toggle {
            left: 3rem;
        }

        .sidebar-toggle:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-md);
        }

        .sidebar-section {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .sidebar-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            padding: 0 0.5rem;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .sidebar-item:hover {
            background: var(--bg-secondary);
            color: var(--accent-primary);
        }

        .sidebar-item.active {
            background: var(--accent-light);
            color: var(--accent-primary);
            font-weight: 500;
        }

        .sidebar-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .sidebar-badge {
            margin-left: auto;
            padding: 0.125rem 0.5rem;
            background: var(--accent-primary);
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sidebar-badge.new {
            background: linear-gradient(135deg, #10b981, #059669);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* 메인 콘텐츠 영역 */
        .main-content {
            margin-top: var(--header-height);
            margin-left: var(--sidebar-width);
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 60px;
        }

        /* 대시보드 그리드 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-primary);
            margin: 0.5rem 0;
        }

        .stats-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* 빠른 액션 버튼 */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            background: white;
            border: 2px solid var(--accent-light);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--text-primary);
        }

        .action-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .action-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar-toggle {
                left: 1rem;
            }
            
            .header-nav {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <div class="header-left">
            <a href="#" class="logo" onclick="showDashboard(); return false;">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="#" class="header-nav-item active">대시보드</a>
                <a href="#" class="header-nav-item">프로젝트</a>
                <a href="#" class="header-nav-item">분석</a>
                <a href="#" class="header-nav-item">보고서</a>
            </nav>
        </div>
        <div class="header-right">
            <!-- 슈퍼 관리자 모드 전환 버튼 (권한에 따라 표시) -->
            <button id="adminModeToggle" class="admin-mode-toggle" onclick="switchToAdminMode()">
                🛡️ 관리자 모드
            </button>
            
            <!-- 개인 서비스 모드 전환 버튼 (슈퍼 관리자에게만 표시) -->
            <button id="personalServiceToggle" class="admin-mode-toggle" onclick="switchToPersonalService()" style="display: none; background: var(--accent-secondary);">
                👤 개인 서비스
            </button>
            
            <div class="user-info">
                <div class="user-avatar status-indicator" id="userAvatar">김</div>
                <div>
                    <div class="user-name" id="userName">-</div>
                    <div class="user-role" id="userRole">
                        <span id="userRoleText" class="premium-gradient">로딩 중...</span>
                        <span id="adminBadge" class="admin-badge" style="display: none;">🛡️ 관리자</span>
                    </div>
                </div>
            </div>
            
            <button onclick="handleLogout()" style="padding: 0.5rem 1rem; background: var(--bg-secondary); border: none; border-radius: 6px; cursor: pointer;">
                로그아웃
            </button>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">프로젝트 관리</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-content="my-projects" onclick="handleMenuClick('my-projects', this)">
                    <span class="sidebar-icon">📋</span>
                    <span>내 프로젝트</span>
                </a>
                <a href="#" class="sidebar-item" data-content="new-project" onclick="handleMenuClick('new-project', this)">
                    <span class="sidebar-icon">➕</span>
                    <span>새 프로젝트</span>
                </a>
                <a href="#" class="sidebar-item" data-content="trash" onclick="handleMenuClick('trash', this)">
                    <span class="sidebar-icon">🗑️</span>
                    <span>휴지통</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">모델 구축</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-content="model-building" onclick="handleMenuClick('model-building', this)">
                    <span class="sidebar-icon">🏗️</span>
                    <span>모델구축</span>
                </a>
                <a href="#" class="sidebar-item" data-content="demographic-survey" onclick="handleMenuClick('demographic-survey', this)">
                    <span class="sidebar-icon">📋</span>
                    <span>인구통계학적 설문조사</span>
                </a>
                <a href="#" class="sidebar-item" data-content="evaluator-management" onclick="handleMenuClick('evaluator-management', this)">
                    <span class="sidebar-icon">👥</span>
                    <span>평가자 관리</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">분석 및 결과</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-content="results-analysis" onclick="handleMenuClick('results-analysis', this)">
                    <span class="sidebar-icon">📈</span>
                    <span>결과 분석</span>
                </a>
                <a href="#" class="sidebar-item" data-content="progress-monitoring" onclick="handleMenuClick('progress-monitoring', this)">
                    <span class="sidebar-icon">📊</span>
                    <span>진행률 모니터링</span>
                </a>
                <a href="#" class="sidebar-item" data-content="report-generation" onclick="handleMenuClick('report-generation', this)">
                    <span class="sidebar-icon">📄</span>
                    <span>보고서 생성</span>
                </a>
                <a href="#" class="sidebar-item" data-content="sensitivity-analysis" onclick="handleMenuClick('sensitivity-analysis', this)">
                    <span class="sidebar-icon">🔍</span>
                    <span>민감도 분석</span>
                </a>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">협업 및 공유</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-content="collaboration-hub" onclick="handleMenuClick('collaboration-hub', this)">
                    <span class="sidebar-icon">🌐</span>
                    <span>협업 허브</span>
                    <span class="sidebar-badge new">New</span>
                </a>
                <a href="#" class="sidebar-item" data-content="team-comparison" onclick="handleMenuClick('team-comparison', this)">
                    <span class="sidebar-icon">🔄</span>
                    <span>팀 비교 분석</span>
                </a>
                <a href="#" class="sidebar-item" data-content="real-time-sync" onclick="handleMenuClick('real-time-sync', this)">
                    <span class="sidebar-icon">⚡</span>
                    <span>실시간 동기화</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">설정</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-content="personal-settings" onclick="handleMenuClick('personal-settings', this)">
                    <span class="sidebar-icon">⚙️</span>
                    <span>개인 설정</span>
                </a>
                <a href="#" class="sidebar-item" data-content="plan-management" onclick="handleMenuClick('plan-management', this)">
                    <span class="sidebar-icon">💳</span>
                    <span>요금제 관리</span>
                </a>
                <a href="#" class="sidebar-item" data-content="user-guide" onclick="handleMenuClick('user-guide', this)">
                    <span class="sidebar-icon">📚</span>
                    <span>사용 가이드</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- 사이드바 토글 버튼 -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">◀</span>
    </button>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <div style="margin-bottom: 2rem;">
            <h1 style="font-size: 2rem; font-weight: 600; margin-bottom: 0.5rem;">안녕하세요 👋</h1>
            <p style="color: var(--text-secondary);">전문적인 AHP 의사결정 분석으로 복잡한 문제를 체계적으로 해결해보세요</p>
        </div>

        <!-- 통계 카드 -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">활성 프로젝트</div>
                    <div class="card-icon">📊</div>
                </div>
                <div class="stats-value">3</div>
                <div class="stats-label">진행중인 프로젝트</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 60%;"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">평가 진행률</div>
                    <div class="card-icon">📈</div>
                </div>
                <div class="stats-value">78%</div>
                <div class="stats-label">전체 평균 진행률</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 78%;"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">평가자 수</div>
                    <div class="card-icon">👥</div>
                </div>
                <div class="stats-value">45</div>
                <div class="stats-label">활성 평가자</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 45%;"></div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">완료된 분석</div>
                    <div class="card-icon">✅</div>
                </div>
                <div class="stats-value">12</div>
                <div class="stats-label">이번 달 완료</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>
        </div>

        <!-- 빠른 액션 -->
        <h2 style="margin-top: 3rem; margin-bottom: 1rem; font-size: 1.5rem;">빠른 액션</h2>
        <div class="quick-actions">
            <a href="./project-management.html" class="action-btn">
                <div class="action-icon">🆕</div>
                <div class="action-title">새 프로젝트 생성</div>
                <div class="action-desc">AHP 분석을 시작하세요</div>
            </a>
            <a href="./criteria-management.html" class="action-btn">
                <div class="action-icon">⚖️</div>
                <div class="action-title">기준 설정</div>
                <div class="action-desc">평가 기준을 정의하세요</div>
            </a>
            <a href="./pairwise-comparison.html" class="action-btn">
                <div class="action-icon">⚡</div>
                <div class="action-title">쌍대비교 수행</div>
                <div class="action-desc">비교 평가를 진행하세요</div>
            </a>
            <a href="./results-analysis.html" class="action-btn">
                <div class="action-icon">📈</div>
                <div class="action-title">결과 확인</div>
                <div class="action-desc">분석 결과를 확인하세요</div>
            </a>
        </div>

        <!-- 최근 프로젝트 -->
        <h2 style="margin-top: 3rem; margin-bottom: 1rem; font-size: 1.5rem;">최근 프로젝트</h2>
        <div style="background: white; border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border-light);">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border-light);">
                        <th style="text-align: left; padding: 0.75rem; font-weight: 600;">프로젝트명</th>
                        <th style="text-align: left; padding: 0.75rem; font-weight: 600;">상태</th>
                        <th style="text-align: left; padding: 0.75rem; font-weight: 600;">진행률</th>
                        <th style="text-align: left; padding: 0.75rem; font-weight: 600;">마지막 수정</th>
                        <th style="text-align: left; padding: 0.75rem; font-weight: 600;">작업</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid var(--border-light);">
                        <td style="padding: 0.75rem;">신제품 출시 전략</td>
                        <td style="padding: 0.75rem;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">진행중</span></td>
                        <td style="padding: 0.75rem;">65%</td>
                        <td style="padding: 0.75rem;">2025-01-10</td>
                        <td style="padding: 0.75rem;"><a href="#" style="color: var(--accent-primary); text-decoration: none;">계속하기 →</a></td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-light);">
                        <td style="padding: 0.75rem;">공급업체 선정</td>
                        <td style="padding: 0.75rem;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">완료</span></td>
                        <td style="padding: 0.75rem;">100%</td>
                        <td style="padding: 0.75rem;">2025-01-08</td>
                        <td style="padding: 0.75rem;"><a href="#" style="color: var(--accent-primary); text-decoration: none;">결과보기 →</a></td>
                    </tr>
                    <tr>
                        <td style="padding: 0.75rem;">투자 포트폴리오 평가</td>
                        <td style="padding: 0.75rem;"><span style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">준비중</span></td>
                        <td style="padding: 0.75rem;">15%</td>
                        <td style="padding: 0.75rem;">2025-01-12</td>
                        <td style="padding: 0.75rem;"><a href="#" style="color: var(--accent-primary); text-decoration: none;">편집하기 →</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script src="./scripts/api-service.js" onload="console.log('✅ API 서비스 스크립트 로드됨')" onerror="handleAPIScriptError()"></script>
    <script>
        // 자동 인증 확인 비활성화 (페이지 자체에서 처리)
        window.SKIP_AUTO_AUTH_CHECK = true;
        
        // API 스크립트 로드 오류 처리
        function handleAPIScriptError() {
            console.error('❌ API 서비스 스크립트 로드 실패');
            
            // 즉시 재시도
            let retryCount = 0;
            const maxRetries = 3;
            
            function retryLoad() {
                if (retryCount >= maxRetries) {
                    console.error('❌ API 서비스 로드 최대 재시도 횟수 초과');
                    // 사용자에게 알림
                    alert('네트워크 연결을 확인하고 페이지를 새로고침해주세요.');
                    return;
                }
                
                retryCount++;
                console.log(`🔄 API 서비스 재로드 시도 ${retryCount}/${maxRetries}...`);
                
                const script = document.createElement('script');
                script.src = './scripts/api-service.js';
                script.type = 'text/javascript';
                script.async = false;
                
                script.onload = () => {
                    console.log('✅ API 서비스 재로드 성공');
                };
                
                script.onerror = () => {
                    console.error(`❌ API 서비스 재로드 실패 (${retryCount}/${maxRetries})`);
                    setTimeout(retryLoad, 1000 * retryCount); // 지수적 백오프
                };
                
                document.head.appendChild(script);
            }
            
            setTimeout(retryLoad, 500);
        }
        
        // =========================
        // 전역 메뉴 핸들러 함수들 (우선 정의)
        // =========================
        
        // 대시보드 홈으로 이동 (로고 클릭 시)
        function showDashboard() {
            console.log('🏠 대시보드 홈으로 이동');
            
            // 현재 활성 메뉴 해제
            const activeMenus = document.querySelectorAll('.sidebar-nav-link.active, .header-nav-item.active');
            activeMenus.forEach(menu => menu.classList.remove('active'));
            
            // 대시보드 메뉴 활성화
            const dashboardMenu = document.querySelector('[onclick*="dashboard"]') || 
                                document.querySelector('.sidebar-nav-link');
            if (dashboardMenu) {
                dashboardMenu.classList.add('active');
            }
            
            // 대시보드 콘텐츠 로드
            handleMenuClick('dashboard');
        }
        
        // 메뉴 클릭 핸들러 - 간소화 버전
        function handleMenuClick(contentType, element) {
            console.log(`🖱️ 메뉴 클릭: ${contentType}`);
            
            // 현재 메뉴 세션에 저장
            sessionStorage.setItem('currentMenu', contentType);
            
            // 이벤트 기본 동작 방지
            if (typeof event !== 'undefined' && event && event.preventDefault) {
                event.preventDefault();
            }
            
            // 메뉴 활성화 상태 업데이트
            try {
                if (element) {
                    document.querySelectorAll('.sidebar-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    element.classList.add('active');
                }
            } catch (e) {
                console.warn('메뉴 활성화 상태 업데이트 오류:', e);
            }
            
            // 메인 콘텐츠 영역 찾기
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) {
                console.error('❌ .main-content 요소를 찾을 수 없음');
                return false;
            }
            
            // 타이틀 가져오기
            const titleMap = {
                'my-projects': '내 프로젝트',
                'new-project': '새 프로젝트',
                'criteria-management': '기준 설정',
                'alternatives-management': '대안 관리',
                'pairwise-comparison': '쌍대비교',
                'evaluator-management': '평가자 관리',
                'results-analysis': '결과 분석',
                'progress-monitoring': '진행률 모니터링',
                'collaboration-hub': '협업 허브',
                'team-comparison': '팀 비교 분석',
                'real-time-sync': '실시간 동기화',
                'trash': '휴지통',
                'report-generation': '보고서 생성',
                'sensitivity-analysis': '민감도 분석',
                'personal-settings': '개인 설정',
                'plan-management': '요금제 관리',
                'user-guide': '사용자 가이드',
                'dashboard': '대시보드',
                'model-building': '모델구축',
                'demographic-survey': '인구통계학적 설문조사'
            };
            const title = titleMap[contentType] || contentType;
            
            // 즉시 콘텐츠 로드
            try {
                loadPersonalContent(contentType);
                console.log(`✅ 콘텐츠 로딩 성공: ${contentType}`);
                return true;
            } catch (error) {
                console.error(`❌ 콘텐츠 로딩 실패: ${contentType}`, error);
                
                // 오류 페이지 표시
                mainContent.innerHTML = `
                    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px; margin: 1rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">😓</div>
                        <h3 style="color: #ef4444; margin-bottom: 1rem;">페이지 로딩 실패</h3>
                        <p style="color: #666; margin-bottom: 2rem;">${title} 페이지를 불러올 수 없습니다.</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button onclick="handleMenuClick('${contentType}', null)" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">다시 시도</button>
                            <button onclick="location.reload()" style="background: #6b7280; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">새로고침</button>
                        </div>
                    </div>
                `;
                return false;
            }
        }
        
        // 메뉴 타이틀 매핑 함수
        function getMenuTitle(contentType) {
            const titles = {
                'my-projects': '내 프로젝트',
                'new-project': '새 프로젝트',
                'criteria-management': '기준 설정',
                'pairwise-comparison': '쌍대비교',
                'results-analysis': '결과 분석',
                'visualization-dashboard': '시각화',
                'evaluator-management': '평가자 관리',
                'progress-monitoring': '진행률 모니터링',
                'collaboration-hub': '협업 허브',
                'alternatives-management': '대안 관리',
                'trash': '휴지통',
                'report-generation': '보고서 생성',
                'sensitivity-analysis': '민감도 분석',
                'personal-settings': '개인 설정',
                'plan-management': '요금제 관리',
                'user-guide': '사용자 가이드',
                'team-comparison': '팀 비교 분석',
                'real-time-sync': '실시간 동기화',
                'dashboard': '대시보드',
                'model-building': '모델구축',
                'demographic-survey': '인구통계학적 설문조사'
            };
            return titles[contentType] || contentType;
        }
        
        // =========================
        // API 스크립트 로딩 실패 처리 (실제 서비스 전용)
        // =========================
        
        function handleAPIScriptError() {
            console.error('❌ API 스크립트 로딩 실패 - 시스템 점검 필요');
            
            // API 로딩 실패 시 사용자에게 알림 및 로그인 페이지로 리다이렉트
            const errorBanner = document.createElement('div');
            errorBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #ef4444;
                color: white;
                text-align: center;
                padding: 12px 16px;
                z-index: 9999;
                font-size: 1rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            `;
            errorBanner.innerHTML = `
                <span>⚠️ <strong>시스템 점검 중</strong> - 잠시 후 다시 접속해주세요</span>
            `;
            document.body.appendChild(errorBanner);
            
            // 시스템 점검 알림만 표시
        }
        // 사이드바 토글
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? '▶' : '◀';
        }

        // 로그아웃
        async function handleLogout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                try {
                    // 세션 스토리지 삭제
                    sessionStorage.removeItem('isLoggedIn');
                    sessionStorage.removeItem('userInfo');
                    sessionStorage.removeItem('currentMenu');
                    
                    if (typeof window.ahpApi !== 'undefined') {
                        await window.ahpApi.logout();
                    }
                } catch (error) {
                    console.error('로그아웃 오류:', error);
                }
                window.location.href = './index.html';
            }
        }

        // 슈퍼 관리자 모드로 전환
        function switchToAdminMode() {
            if (!window.currentUser || (!window.currentUser.is_superuser && !window.currentUser.is_staff && window.currentUser.role !== 'admin')) {
                alert('관리자 권한이 필요합니다.');
                return;
            }
            
            if (confirm('관리자 모드로 전환하시겠습니까?')) {
                console.log('🚀 관리자 모드로 전환 중...');
                window.location.href = './super-admin-dashboard.html';
            }
        }

        function switchToPersonalService() {
            if (!window.currentUser || !window.currentUser.is_superuser) {
                alert('슈퍼 관리자 권한이 필요합니다.');
                return;
            }
            
            if (confirm('개인 서비스 모드로 전환하시겠습니까?')) {
                console.log('👤 개인 서비스 모드로 전환 중...');
                window.location.href = './personal-service-enhanced.html';
            }
        }

        // 로그인 상태 확인 및 권한 체크 (Django API 전용)
        async function checkLoginStatus() {
            try {
                // 세션 스토리지에서 로그인 상태 확인
                const isLoggedIn = sessionStorage.getItem('isLoggedIn');
                const userInfo = sessionStorage.getItem('userInfo');
                
                if (isLoggedIn === 'true' && userInfo) {
                    console.log('✅ 세션에서 로그인 상태 확인됨');
                    const user = JSON.parse(userInfo);
                    updateUserInfo(user);
                    checkAdminPermissions(user);
                    return true;
                }
                
                if (typeof window.ahpApi === 'undefined') {
                    console.error('❌ API 서비스가 로드되지 않았습니다.');
                    showMessage('API 서비스 연결에 실패했습니다.', 'error');
                    return false;
                }

                const result = await window.ahpApi.getCurrentUser();
                if (!result.success || !result.user) {
                    console.log('🔐 인증이 필요합니다.');
                    showMessage('사용자 인증이 필요합니다.', 'warning');
                    return false;
                }

                const user = result.user;
                console.log('✅ 사용자 인증 완료:', user);

                // 세션 스토리지에 로그인 상태 저장
                sessionStorage.setItem('isLoggedIn', 'true');
                sessionStorage.setItem('userInfo', JSON.stringify(user));

                // 사용자 정보 업데이트
                updateUserInfo(user);

                // 관리자 권한 체크 및 모드 전환 버튼 표시
                checkAdminPermissions(user);

                return true;
            } catch (error) {
                console.error('❌ 로그인 상태 확인 오류:', error);
                
                // 네트워크 오류 또는 서버 오류 시 적절한 처리
                if (error.name === 'TypeError' || error.message.includes('fetch')) {
                    showMessage('네트워크 연결을 확인해주세요.', 'error');
                } else {
                    showMessage('인증 확인 중 오류가 발생했습니다.', 'error');
                }
                return false;
            }
        }

        // 사용자 정보 업데이트
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userRoleText = document.getElementById('userRoleText');
            const adminBadge = document.getElementById('adminBadge');
            const userAvatar = document.getElementById('userAvatar');

            if (userName) {
                userName.textContent = user.name || user.username || '사용자';
            }

            if (userRoleText) {
                let roleText = '개인 서비스';
                if (user.is_superuser) {
                    roleText = '슈퍼 관리자';
                } else if (user.is_staff) {
                    roleText = '관리자';
                } else if (user.user_type === 'evaluator') {
                    roleText = '평가자';
                }
                userRoleText.textContent = roleText;
            }

            // 관리자 배지 표시
            if (adminBadge) {
                if (user.is_superuser) {
                    adminBadge.textContent = '🛡️ 슈퍼 관리자';
                    adminBadge.style.display = 'inline-block';
                } else if (user.is_staff || user.role === 'admin') {
                    adminBadge.textContent = '🛡️ 관리자';
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }

            if (userAvatar) {
                const name = user.name || user.username || '사용자';
                userAvatar.textContent = name.charAt(0).toUpperCase();
                
                // 관리자는 골드 배경, 슈퍼 관리자는 레드 배경
                if (user.is_superuser) {
                    userAvatar.style.background = 'linear-gradient(135deg, #dc2626, #b91c1c)';
                } else if (user.is_staff || user.role === 'admin') {
                    userAvatar.style.background = 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))';
                } else {
                    userAvatar.style.background = '#6b7280';
                }
            }
        }

        // 관리자 권한 체크 및 모드 전환 버튼 표시
        function checkAdminPermissions(user) {
            const adminToggleBtn = document.getElementById('adminModeToggle');
            const personalServiceToggleBtn = document.getElementById('personalServiceToggle');
            
            // 슈퍼 관리자 또는 스태프 권한이 있는 경우 관리자 모드 전환 버튼 표시
            if (user.is_superuser || user.is_staff || user.role === 'admin') {
                console.log('✅ 관리자 권한 확인됨 - 모드 전환 버튼 표시');
                if (adminToggleBtn) {
                    adminToggleBtn.classList.add('show');
                }
                
                // 슈퍼 관리자인 경우 개인 서비스 토글도 표시 (현재 관리자 모드에 있을 때)
                if (user.is_superuser && personalServiceToggleBtn) {
                    // URL이 super-admin-dashboard가 아니면 개인 서비스 토글 숨김
                    if (window.location.pathname.includes('super-admin-dashboard')) {
                        personalServiceToggleBtn.style.display = 'block';
                    } else {
                        personalServiceToggleBtn.style.display = 'none';
                    }
                }
            } else {
                console.log('❌ 관리자 권한 없음 - 모드 전환 버튼 숨김');
                if (adminToggleBtn) {
                    adminToggleBtn.classList.remove('show');
                }
                if (personalServiceToggleBtn) {
                    personalServiceToggleBtn.style.display = 'none';
                }
            }
            
            // 현재 사용자 정보를 전역 변수에 저장
            window.currentUser = user;
        }

        // 사이드바 메뉴 활성화
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
                
                // 모든 항목에서 active 클래스 제거
                document.querySelectorAll('.sidebar-item').forEach(el => {
                    el.classList.remove('active');
                });
                
                // 클릭한 항목에 active 클래스 추가
                this.classList.add('active');
            });
        });

        // 현재 시간 업데이트 (옵션)
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR');
            // 시간 표시가 필요한 경우 여기에 구현
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🛡️ 개인 서비스 대시보드 초기화 시작');
            
            // URL 프래그먼트 정리 (GitHub Pages 환경 대응)
            if (window.location.hash) {
                console.log('🔧 URL 프래그먼트 제거:', window.location.hash);
                history.replaceState(null, null, window.location.pathname);
            }
            
            // 로딩 상태 표시
            showLoadingMessage('개인 서비스 대시보드를 로딩하고 있습니다...');
            
            // 사용자 정보 캐싱 초기화
            window.currentUser = null;
            window.sessionChecked = false;
            
            // API 서비스 로드 대기 - GitHub Pages 환경 대응
            let apiLoadAttempts = 0;
            while (typeof window.ahpApi === 'undefined' && apiLoadAttempts < 5) {
                console.log('⏳ API 서비스 로드 대기 중...');
                await new Promise(resolve => setTimeout(resolve, 200));
                apiLoadAttempts++;
            }
            
            // API 로드 실패 시 에러 처리
            if (typeof window.ahpApi === 'undefined') {
                console.error('❌ API 서비스 로드 실패');
                showMessage('시스템 점검 중입니다. 잠시 후 다시 접속해주세요.', 'error');
                return;
            }
            
            console.log('✅ API 서비스 로드 완료');
            
            // 슈퍼관리자 인증 상태 확인
            try {
                const loginSuccess = await checkLoginStatus();
                if (!loginSuccess) {
                    console.error('❌ 슈퍼관리자 인증되지 않음');
                    showMessage('슈퍼관리자 인증이 필요합니다.', 'warning');
                    return;
                }
                
                // 인증 성공 - 로딩 메시지 제거
                hideLoadingMessage();
                console.log('✅ 인증 성공 - 개인 서비스 대시보드 표시');
                
            } catch (error) {
                console.error('❌ 인증 확인 실패:', error);
                showMessage('인증 확인에 실패했습니다.', 'error');
                return;
            }
            
            // 세션 체크 완료 플래그 설정
            window.sessionChecked = true;
            console.log('✅ Enhanced Personal Service Dashboard 로드 완료');
            
            // 함수 존재 여부 확인
            console.log('🔍 함수 상태 체크:');
            console.log('- handleMenuClick:', typeof handleMenuClick);
            console.log('- loadPersonalContent:', typeof loadPersonalContent);
            console.log('- getMenuTitle:', typeof getMenuTitle);
            
            // 메뉴 이벤트 바인딩
            bindMenuEvents();
            
            // 기본 대시보드 콘텐츠 표시
            setTimeout(() => {
                // 저장된 메뉴가 있으면 복원, 없으면 대시보드
                const savedMenu = sessionStorage.getItem('currentMenu');
                if (savedMenu) {
                    console.log(`📂 저장된 메뉴 복원: ${savedMenu}`);
                    handleMenuClick(savedMenu);
                } else {
                    console.log('🏠 대시보드 로딩 시작');
                    handleMenuClick('dashboard');
                }
            }, 100);
            
            // 백엔드 상태 확인 (옵션)
            checkBackendStatus();
        });

        // 메뉴 이벤트 바인딩 함수
        function bindMenuEvents() {
            console.log('🔧 메뉴 이벤트 바인딩 시작');
            
            // 모든 사이드바 메뉴 항목에 이벤트 리스너 추가
            document.querySelectorAll('.sidebar-item').forEach(item => {
                // 기존 이벤트 리스너 제거 (중복 방지)
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                
                // 새로운 이벤트 리스너 추가
                newItem.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const contentType = this.getAttribute('data-content');
                    if (contentType) {
                        console.log(`📋 메뉴 클릭 감지: ${contentType}`);
                        handleMenuClick(contentType, this);
                    }
                });
            });
            
            console.log('✅ 메뉴 이벤트 바인딩 완료');
        }

        // 로딩 및 인증 에러 표시 함수들
        function showLoadingMessage(message) {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-overlay';
            loadingDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(249, 250, 251, 0.95);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center;">
                        <div style="
                            width: 40px;
                            height: 40px;
                            border: 3px solid #e5e7eb;
                            border-top: 3px solid #C8A968;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin: 0 auto 1rem;
                        "></div>
                        <p style="color: #6b7280;">${message}</p>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.body.appendChild(loadingDiv);
        }

        function hideLoadingMessage() {
            const loadingDiv = document.getElementById('loading-overlay');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        function showAuthError(message, redirectUrl) {
            hideLoadingMessage();
            showMessage(message, 'error');
        }

        // 백엔드 상태 확인
        async function checkBackendStatus() {
            try {
                const response = await fetch('https://ahp-django-backend.onrender.com/api/health/', {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    console.log('✅ Django 백엔드 정상 연결');
                } else {
                    console.warn('⚠️ Django 백엔드 응답 오류');
                }
            } catch (error) {
                console.error('❌ Django 백엔드 연결 실패:', error);
            }
        }


        // 개인 서비스 콘텐츠 로딩
        function loadPersonalContent(contentType) {
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) return;

            let content = '';
            const title = getMenuTitle(contentType);

            switch(contentType) {
                case 'my-projects':
                    content = generateMyProjectsContent();
                    // 프로젝트 로딩 후 실제 데이터 가져오기
                    setTimeout(() => loadProjectsFromAPI(), 100);
                    break;
                case 'new-project':
                    console.log('🎯 새 프로젝트 메뉴 클릭됨');
                    content = generateNewProjectContent();
                    // 폼 이벤트 리스너 추가 - 더 긴 지연으로 DOM 렌더링 완료 보장
                    setTimeout(() => {
                        console.log('⏰ setupNewProjectForm 호출 예정');
                        setupNewProjectForm();
                    }, 200);
                    break;
                case 'criteria-management':
                    content = generateCriteriaManagementContent();
                    // 기준 관리 초기화
                    setTimeout(() => setupCriteriaManagement(), 100);
                    break;
                case 'pairwise-comparison':
                    content = generatePairwiseComparisonContent();
                    // 쌍대비교 초기화
                    setTimeout(() => setupPairwiseComparison(), 100);
                    break;
                case 'results-analysis':
                    content = generateResultsAnalysisContent();
                    break;
                case 'visualization-dashboard':
                    content = generateVisualizationDashboardContent();
                    break;
                case 'evaluator-management':
                    // 평가자 관리 전에 인구통계학적 설문조사 먼저 확인
                    content = generateEvaluatorPreSurveyContent();
                    setTimeout(() => setupEvaluatorPreSurvey(), 100);
                    break;
                case 'progress-monitoring':
                    content = generateProgressMonitoringContent();
                    setTimeout(() => loadProgressData(), 100);
                    break;
                case 'collaboration-hub':
                    content = generateCollaborationHubContent();
                    setTimeout(() => setupCollaborationHub(), 100);
                    break;
                case 'alternatives-management':
                    content = generateAlternativesManagementContent();
                    setTimeout(() => setupAlternativesManagement(), 100);
                    break;
                case 'trash':
                    content = generateTrashContent();
                    break;
                case 'report-generation':
                    content = generateReportGenerationContent();
                    break;
                case 'sensitivity-analysis':
                    content = generateSensitivityAnalysisContent();
                    break;
                case 'personal-settings':
                    content = generatePersonalSettingsContent();
                    break;
                case 'plan-management':
                    content = generatePlanManagementContent();
                    break;
                case 'user-guide':
                    content = generateUserGuideContent();
                    setTimeout(() => setupUserGuide(), 100);
                    break;
                case 'team-comparison':
                    content = generateTeamComparisonContent();
                    break;
                case 'real-time-sync':
                    content = generateRealTimeSyncContent();
                    break;
                case 'dashboard':
                    content = generateDashboardContent();
                    setTimeout(() => loadDashboardData(), 100);
                    break;
                case 'model-building':
                    content = generateModelBuildingContent();
                    setTimeout(() => setupModelBuilding(), 100);
                    break;
                case 'demographic-survey':
                    content = generateEvaluatorDemographicSurveyContent();
                    setTimeout(() => setupEvaluatorDemographicSurvey(), 100);
                    break;
                default:
                    content = generateComingSoonContent(title, contentType);
            }

            mainContent.innerHTML = content;
        }

        // 프로젝트 API 연동 함수들
        async function loadProjectsFromAPI() {
            const projectsContainer = document.getElementById('projectsContainer');
            if (!projectsContainer) return;

            try {
                console.log('📊 1차 개발 스타일 프로젝트 로딩 중...');
                
                // 로딩 상태 표시
                projectsContainer.innerHTML = `
                    <div id="loadingState" style="text-align: center; padding: 4rem; color: #6b7280;">
                        <div style="display: inline-flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                            <div style="width: 32px; height: 32px; border: 3px solid #e5e7eb; border-top: 3px solid #C8A968; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        <p style="margin: 0; font-size: 1rem;">프로젝트를 불러오는 중입니다...</p>
                    </div>
                `;

                const result = await window.ahpApi.getProjects();
                
                const projects = Array.isArray(result.data) ? result.data : (result.data.results || []);
                if (result.success && projects.length > 0) {
                    displayProjects1stVersion(projects);
                    console.log(`✅ ${projects.length}개 프로젝트 로드 완료`);
                } else {
                    displayEmptyProjectsState();
                }
            } catch (error) {
                console.error('❌ 프로젝트 로딩 실패:', error);
                displayProjectsErrorState(error.message);
            }
        }

        // 1차 개발 버전 스타일의 프로젝트 표시 함수
        function displayProjects1stVersion(projects) {
            const projectsContainer = document.getElementById('projectsContainer');
            if (!projectsContainer) return;

            let projectsHTML = '';
            
            projects.forEach(project => {
                const statusBadge = getStatusBadge1stVersion(project.status || 'draft');
                const formattedDate = formatDate1stVersion(project.created_at || project.updated_at);
                const lastModified = formatDate1stVersion(project.updated_at || project.created_at);
                
                projectsHTML += `
                    <div class="project-card" onclick="selectProject('${project.id}', '${project.title}')">
                        <div style="display: flex; align-items: start; justify-content: space-between; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; space-x: 0.75rem; margin-bottom: 0.5rem;">
                                    <h3 style="margin: 0; font-size: 1.125rem; font-weight: 500; color: #1f2937;">${project.title || '제목 없음'}</h3>
                                    ${statusBadge}
                                </div>
                                
                                ${project.description ? `<p style="color: #6b7280; font-size: 0.875rem; margin: 0.75rem 0; line-height: 1.4; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${project.description}</p>` : ''}
                                
                                <div class="project-meta">
                                    <div class="meta-item">
                                        <span class="meta-label">기준</span>
                                        <span class="meta-value">${project.criteria_count || 0}개</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="meta-label">대안</span>
                                        <span class="meta-value">${project.alternatives_count || 0}개</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="meta-label">평가자</span>
                                        <span class="meta-value">${project.evaluator_count || 0}명</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="meta-label">진행률</span>
                                        <span class="meta-value">${project.completion_rate || 0}%</span>
                                    </div>
                                </div>
                                
                                <!-- 평가방식 표시 -->
                                <div style="margin-top: 1rem;">
                                    <span class="meta-label">평가방식</span>
                                    <div style="margin-top: 0.25rem;">
                                        ${getEvaluationMethodBadge(project.evaluation_method || 'pairwise')}
                                    </div>
                                </div>
                                
                                <div style="display: flex; align-items: center; justify-content: space-between; font-size: 0.75rem; color: #9ca3af; margin-top: 1rem;">
                                    <span>생성일: ${formattedDate}</span>
                                    <span>수정일: ${lastModified}</span>
                                </div>
                            </div>
                            
                            <div style="margin-left: 1rem; flex-shrink: 0;">
                                <button onclick="event.stopPropagation(); selectProject('${project.id}', '${project.title}')" style="background: #C8A968; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#B59A4D'" onmouseout="this.style.background='#C8A968'">
                                    선택
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            projectsContainer.innerHTML = projectsHTML;
        }

        // 빈 프로젝트 상태 표시
        function displayEmptyProjectsState() {
            const projectsContainer = document.getElementById('projectsContainer');
            if (!projectsContainer) return;

            projectsContainer.innerHTML = `
                <div style="text-align: center; padding: 6rem 2rem;">
                    <div style="color: #9ca3af; margin-bottom: 1rem;">
                        <svg style="width: 48px; height: 48px; margin: 0 auto;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <h3 style="font-size: 1.125rem; font-weight: 500; color: #1f2937; margin-bottom: 0.5rem;">프로젝트가 없습니다</h3>
                    <p style="color: #6b7280; margin-bottom: 2rem;">먼저 새 프로젝트를 생성해주세요.</p>
                    <button onclick="handleMenuClick('new-project', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#B59A4D'" onmouseout="this.style.background='#C8A968'">
                        새 프로젝트 생성하기
                    </button>
                </div>
            `;
        }

        // 프로젝트 로딩 오류 상태 표시
        function displayProjectsErrorState(errorMessage) {
            const projectsContainer = document.getElementById('projectsContainer');
            if (!projectsContainer) return;

            projectsContainer.innerHTML = `
                <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem;">
                    <div style="display: flex; align-items: center;">
                        <div style="color: #dc2626; margin-right: 0.75rem;">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="color: #dc2626; font-weight: 500; margin: 0 0 0.25rem 0;">프로젝트를 불러올 수 없습니다</h3>
                            <p style="color: #7f1d1d; margin: 0; font-size: 0.875rem;">${errorMessage || '알 수 없는 오류가 발생했습니다.'}</p>
                        </div>
                        <button onclick="loadProjectsFromAPI()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; margin-left: 1rem;" onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                            다시 시도
                        </button>
                    </div>
                </div>
            `;
        }

        // 1차 개발 버전 스타일의 상태 배지
        function getStatusBadge1stVersion(status) {
            const statusMap = {
                'draft': { label: '초안', class: 'status-draft' },
                'active': { label: '진행중', class: 'status-active' },
                'completed': { label: '완료', class: 'status-completed' }
            };

            const statusInfo = statusMap[status] || statusMap['draft'];
            return `<span class="project-status-badge ${statusInfo.class}">${statusInfo.label}</span>`;
        }

        // 1차 개발 버전 스타일의 날짜 포맷팅
        function formatDate1stVersion(dateString) {
            if (!dateString) return '날짜 없음';
            
            try {
                return new Date(dateString).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch {
                return '날짜 없음';
            }
        }

        // 평가방식 배지 생성 함수
        function getEvaluationMethodBadge(method) {
            const methodInfo = {
                'pairwise': {
                    icon: '⚖️',
                    name: '쌍대비교',
                    color: '#1e40af',
                    bgColor: '#dbeafe'
                },
                'direct': {
                    icon: '📝',
                    name: '직접입력',
                    color: '#059669',
                    bgColor: '#d1fae5'
                },
                'practical': {
                    icon: '📈',
                    name: '실무형',
                    color: '#7c2d12',
                    bgColor: '#fed7aa'
                }
            };
            
            const info = methodInfo[method] || methodInfo['pairwise'];
            
            return `
                <span style="display: inline-flex; align-items: center; background: ${info.bgColor}; color: ${info.color}; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500;">
                    <span style="margin-right: 0.25rem;">${info.icon}</span>
                    ${info.name}
                </span>
            `;
        }

        // 프로젝트 선택 함수
        function selectProject(projectId, projectTitle) {
            console.log(`📋 프로젝트 선택: ${projectTitle} (ID: ${projectId})`);
            
            // 여기서 프로젝트 세부 페이지로 이동하거나 추가 작업 수행
            // 예: 기준 설정 페이지로 이동
            alert(`선택된 프로젝트: ${projectTitle}\n\n기준 설정 페이지로 이동합니다.`);
            handleMenuClick('criteria-management', null);
        }

        // 1차 개발 버전 my-projects 페이지 구현 완료
        // - ProjectSelector.tsx 기반으로 HTML/JavaScript 변환
        // - 깔끔한 카드 스타일 및 상태 관리
        // - 로딩, 빈 상태, 오류 상태 처리

        // 평가방식 선택 함수
        function selectEvaluationMethod(method, element) {
            // 모든 평가방식 옵션 초기화
            const allOptions = document.querySelectorAll('[onclick*="selectEvaluationMethod"]');
            allOptions.forEach(option => {
                option.style.borderColor = '#e5e7eb';
                option.style.backgroundColor = '#ffffff';
                option.classList.remove('selected');
            });
            
            // 선택된 옵션 강조
            element.style.borderColor = '#C8A968';
            element.style.backgroundColor = '#fefdf8';
            element.classList.add('selected');
            
            // 라디오 버튼 체크
            const radioButton = element.querySelector('input[type="radio"]');
            if (radioButton) {
                radioButton.checked = true;
            }
            
            // 선택된 평가방식에 따른 추가 설명 표시
            showEvaluationMethodInfo(method);
            
            console.log(`✅ 평가방식 선택: ${method}`);
        }
        
        function showEvaluationMethodInfo(method) {
            // 기존 정보 섹션 제거
            const existingInfo = document.getElementById('evaluationMethodInfo');
            if (existingInfo) {
                existingInfo.remove();
            }
            
            const methodDescriptions = {
                'pairwise': {
                    title: '⚖️ 쌍대비교 평가방식',
                    description: '두 요소를 직접 비교하여 상대적 중요도를 평가합니다.',
                    features: [
                        '📊 9점 척도 사용 (1/9 ~ 9)',
                        '🔄 일관성 비율 자동 계산',
                        '👥 다수 평가자 의견 종합',
                        '📈 정확한 가중치 도출'
                    ],
                    suitable: '정성적 판단이 중요한 의사결정'
                },
                'direct': {
                    title: '📝 직접입력 평가방식',
                    description: '각 요소에 직접 점수나 가중치를 입력하여 평가합니다.',
                    features: [
                        '⚡ 빠른 평가 완료',
                        '📋 명확한 기준 적용',
                        '🔢 수치 데이터 활용',
                        '📊 즉시 결과 확인'
                    ],
                    suitable: '명확한 정량적 기준이 있는 경우'
                },
                'practical': {
                    title: '📈 실무형 평가방식',
                    description: '쌍대비교와 직접입력을 상황에 맞게 혼합하여 사용합니다.',
                    features: [
                        '🔄 유연한 평가 방식',
                        '⚖️ 정성적/정량적 혼합',
                        '💼 실무 환경 최적화',
                        '🎯 효율적인 의사결정'
                    ],
                    suitable: '복잡한 실무 의사결정 상황'
                }
            };
            
            const info = methodDescriptions[method];
            if (!info) return;
            
            // 정보 섹션 생성
            const infoHTML = `
                <div id="evaluationMethodInfo" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 1px solid #C8A968; border-radius: 12px; padding: 1.5rem; margin-top: 1rem; animation: fadeIn 0.3s ease-in;">
                    <h5 style="margin: 0 0 1rem 0; color: #1f2937; font-size: 1rem;">${info.title}</h5>
                    <p style="margin: 0 0 1rem 0; color: #4b5563; font-size: 0.9rem; line-height: 1.5;">${info.description}</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem;">
                        <div>
                            <h6 style="margin: 0 0 0.5rem 0; color: #374151; font-size: 0.85rem; font-weight: 600;">주요 특징</h6>
                            <ul style="margin: 0; padding-left: 1rem; color: #6b7280; font-size: 0.8rem; line-height: 1.4;">
                                ${info.features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h6 style="margin: 0 0 0.5rem 0; color: #374151; font-size: 0.85rem; font-weight: 600;">적합한 상황</h6>
                            <p style="margin: 0; color: #6b7280; font-size: 0.8rem; line-height: 1.4;">
                                💡 ${info.suitable}
                            </p>
                        </div>
                    </div>
                </div>
                
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(-10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                </style>
            `;
            
            // 평가방식 선택 섹션 다음에 정보 추가
            const evaluationSection = document.querySelector('[onclick*="selectEvaluationMethod"]').closest('div').parentNode;
            evaluationSection.insertAdjacentHTML('afterend', infoHTML);
        }

        // 새 프로젝트 폼 설정
        function setupNewProjectForm() {
            console.log('🔧 프로젝트 생성 폼 설정 시작');
            
            const form = document.getElementById('newProjectForm');
            if (!form) {
                console.error('❌ newProjectForm을 찾을 수 없음');
                return;
            }

            console.log('✅ 폼 요소 발견:', form);

            // 기존 이벤트 리스너 제거
            form.removeEventListener('submit', handleFormSubmit);
            
            // 새 이벤트 리스너 추가
            form.addEventListener('submit', handleFormSubmit);
            
            // 제출 버튼에도 직접 이벤트 리스너 추가
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                console.log('✅ 제출 버튼 발견, 이벤트 리스너 추가');
                submitBtn.removeEventListener('click', handleButtonClick);
                submitBtn.addEventListener('click', handleButtonClick);
            }
            
            console.log('✅ 프로젝트 생성 폼 설정 완료');
        }
        
        async function handleFormSubmit(e) {
            console.log('📝 폼 제출 이벤트 발생!');
            e.preventDefault();
            e.stopPropagation();
            await createNewProject();
        }
        
        async function handleButtonClick(e) {
            console.log('🖱️ 버튼 클릭 이벤트 발생!');
            e.preventDefault();
            e.stopPropagation();
            
            // 폼 유효성 검사
            const form = document.getElementById('newProjectForm');
            if (form && form.checkValidity()) {
                await createNewProject();
            } else if (form) {
                form.reportValidity();
            }
        }


        // 직접 테스트 함수
        async function testDirectProjectCreation() {
            console.log('🧪 직접 프로젝트 생성 테스트 시작');
            
            const testData = {
                title: '테스트 프로젝트 ' + new Date().toLocaleTimeString(),
                description: '자동 생성된 테스트 프로젝트 상세 설명입니다.',
                objective: '테스트 목적으로 생성된 프로젝트입니다.',
                visibility: 'private',
                consistency_ratio_threshold: 0.1,
                deadline: null,
                tags: ['test', 'general'],
                settings: {
                    category: 'general',
                    priority: 'medium',
                    evaluation_method: 'pairwise',
                    status: 'draft'
                }
            };
            
            showMessage('직접 테스트 실행 중...', 'info');
            
            try {
                // API 서비스 강제 로드
                await forceLoadApiService();
                
                // 슈퍼관리자 인증 확인
                const userResult = await window.ahpApi.getCurrentUser();
                if (!userResult.success) {
                    showMessage('❌ 테스트 실패: 슈퍼관리자 인증이 필요합니다.', 'error');
                    return;
                }
                console.log('✅ 테스트용 슈퍼관리자 인증 확인됨:', userResult.user.name);
                
                console.log('📡 테스트 데이터로 Django API 직접 호출:', testData);
                const result = await window.ahpApi.createProject(testData);
                console.log('📡 Django API 응답:', result);
                
                if (result.success) {
                    showMessage(`✅ 테스트 성공! 프로젝트가 PostgreSQL에 저장되었습니다.\n프로젝트: ${testData.title}\n\n🔄 프로젝트 목록을 업데이트합니다...`, 'success');
                    
                    // 즉시 프로젝트 목록 업데이트
                    await refreshProjectList();
                    
                    // 대시보드가 현재 표시되고 있다면 새로고침
                    const currentContent = document.querySelector('.main-content');
                    if (currentContent && currentContent.innerHTML.includes('📊 대시보드')) {
                        console.log('🔄 대시보드 데이터 새로고침');
                        await loadDashboardData();
                    }
                } else {
                    showMessage(`❌ 테스트 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('❌ Django PostgreSQL 테스트 실패:', error);
                showMessage(`❌ Django PostgreSQL 연동 테스트 실패: ${error.message}\n백엔드 서버 상태를 확인해주세요.`, 'error');
            }
        }

        // API 서비스 강제 로드 함수
        async function forceLoadApiService() {
            if (window.ahpApi) {
                console.log('✅ API 서비스 이미 로드됨');
                return true;
            }
            
            console.log('📡 API 서비스 강제 로드 시작...');
            
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = './scripts/api-service.js';
                script.type = 'text/javascript';
                
                script.onload = () => {
                    console.log('✅ API 서비스 로드 완료');
                    
                    // API 초기화 대기
                    const checkApi = () => {
                        if (window.ahpApi && window.ahpApi.createProject) {
                            console.log('✅ API 초기화 완료');
                            resolve(true);
                        } else {
                            setTimeout(checkApi, 100);
                        }
                    };
                    checkApi();
                };
                
                script.onerror = (error) => {
                    console.error('❌ API 서비스 로드 실패:', error);
                    reject(error);
                };
                
                document.head.appendChild(script);
            });
        }

        async function createNewProject() {
            console.log('🎯 프로젝트 생성 시작');
            const messageDiv = document.getElementById('createProjectMessage');
            
            try {
                // 폼 요소 값 가져오기
                const projectName = document.getElementById('projectName');
                const projectGoal = document.getElementById('projectGoal');
                const projectDescription = document.getElementById('projectDescription');
                const projectCategory = document.getElementById('projectCategory');
                const projectPriority = document.getElementById('projectPriority');
                
                // 필수 필드 확인
                if (!projectName || !projectName.value.trim()) {
                    showMessage('프로젝트 이름을 입력해주세요.', 'error');
                    return;
                }
                
                if (!projectGoal || !projectGoal.value.trim()) {
                    showMessage('프로젝트 목표를 입력해주세요.', 'error');
                    return;
                }
                
                // 선택된 평가방식 가져오기
                const selectedEvaluationMethod = document.querySelector('input[name="evaluationMethod"]:checked');
                const evaluationMethod = selectedEvaluationMethod ? selectedEvaluationMethod.value : 'pairwise';
                
                const formData = {
                    title: projectName.value.trim(),
                    description: projectDescription ? projectDescription.value.trim() : '',
                    objective: projectGoal.value.trim(),
                    visibility: 'private',
                    consistency_ratio_threshold: 0.1,
                    deadline: null,
                    tags: [projectCategory ? projectCategory.value : 'general'],
                    settings: {
                        category: projectCategory ? projectCategory.value : 'general',
                        priority: projectPriority ? projectPriority.value : 'medium',
                        evaluation_method: evaluationMethod,
                        status: 'draft'
                    }
                };

                // React 스타일 검증 기능 추가
                const errors = validateProjectForm(formData);
                if (Object.keys(errors).length > 0) {
                    displayFormErrors(errors);
                    return;
                }

                // 로딩 표시
                const submitBtn = document.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = '생성 중...';

                console.log('🚀 새 프로젝트 생성:', formData);
                
                // API 서비스 강제 로드 및 확인
                console.log('🔍 API 서비스 상태:', typeof window.ahpApi);
                
                if (typeof window.ahpApi === 'undefined' || !window.ahpApi.createProject) {
                    console.log('📡 API 서비스 로드 필요 - 강제 로드 시작');
                    showMessage('API 서비스를 로드하고 있습니다...', 'info');
                    
                    try {
                        await forceLoadApiService();
                        console.log('✅ API 서비스 로드 성공');
                    } catch (error) {
                        console.error('❌ API 서비스 로드 실패:', error);
                        showMessage('API 서비스를 로드할 수 없습니다. 페이지를 새로고침 후 다시 시도해주세요.', 'error');
                        return;
                    }
                }
                
                // 인증 상태 확인 (선택사항)
                console.log('🔐 사용자 인증 상태 확인');
                try {
                    const userResult = await window.ahpApi.getCurrentUser();
                    if (userResult.success) {
                        console.log('✅ 인증된 사용자:', userResult.user.name);
                    } else {
                        console.log('ℹ️ 익명 사용자로 프로젝트 생성');
                    }
                } catch (error) {
                    console.log('ℹ️ 인증 확인 실패, 익명 사용자로 진행:', error.message);
                }
                showMessage('프로젝트를 Django PostgreSQL에 저장하고 있습니다...', 'info');
                
                console.log('📡 Django 백엔드 API 호출 시작...');
                console.log('📄 전송 데이터:', JSON.stringify(formData, null, 2));
                
                let result;
                try {
                    result = await window.ahpApi.createProject(formData);
                    console.log('📡 Django API 응답:', result);
                } catch (apiError) {
                    console.error('❌ Django API 호출 실패:', apiError);
                    showMessage(`Django PostgreSQL 저장에 실패했습니다. 네트워크 연결과 백엔드 서버를 확인해주세요.\n오류: ${apiError.message}`, 'error');
                    return;
                }

                if (result.success) {
                    const evaluationMethodNames = {
                        'pairwise': '⚖️ 쌍대비교',
                        'direct': '📝 직접입력', 
                        'practical': '📈 실무형'
                    };
                    const methodName = evaluationMethodNames[evaluationMethod] || '⚖️ 쌍대비교';
                    
                    console.log('✅ PostgreSQL 데이터베이스에 프로젝트 저장 완료');
                    console.log('📋 생성된 프로젝트 ID:', result.data?.id || result.project?.id);
                    console.log('📋 전체 응답 데이터:', result);
                    
                    showMessage(`✅ 프로젝트가 PostgreSQL 데이터베이스에 성공적으로 저장되었습니다!\n📊 프로젝트: ${formData.title}\n${methodName} 방식으로 설정됨\n\n🚀 프로젝트 목록을 업데이트합니다...`, 'success');
                    
                    // 즉시 프로젝트 목록 업데이트
                    await refreshProjectList();
                    
                    // 사용자 선택: 프로젝트 목록 보기 또는 모델 구축으로 이동
                    const userChoice = confirm('프로젝트가 성공적으로 생성되었습니다!\n\n새로 생성된 프로젝트를 프로젝트 목록에서 확인하시겠습니까?\n\n"확인" - 프로젝트 목록 보기\n"취소" - 모델 구축 단계로 이동');
                    
                    if (userChoice) {
                        // 프로젝트 목록으로 이동
                        setTimeout(() => {
                            handleMenuClick('my-projects', null);
                        }, 1000);
                    } else {
                        // 2초 후 모델 구축으로 이동
                        setTimeout(() => {
                            handleMenuClick('model-building', null);
                        }, 2000);
                    }
                } else {
                    showMessage(result.message || '프로젝트 생성에 실패했습니다.', 'error');
                }

                // 버튼 상태 복원
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }

            } catch (error) {
                console.error('❌ 프로젝트 생성 오류:', error);
                showMessage(`프로젝트 생성 중 오류가 발생했습니다: ${error.message}`, 'error');
            } finally {
                // 버튼 상태 복원
                const submitBtn = document.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = '🚀 프로젝트 생성';
                }
            }
        }

        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('createProjectMessage');
            if (!messageDiv) return;

            const colors = {
                success: { bg: '#f0fdf4', border: '#bbf7d0', text: '#16a34a' },
                error: { bg: '#fef2f2', border: '#fecaca', text: '#dc2626' },
                info: { bg: '#f0f9ff', border: '#bae6fd', text: '#0284c7' }
            };

            const style = colors[type] || colors.info;

            messageDiv.innerHTML = `
                <div style="
                    background: ${style.bg}; 
                    border: 1px solid ${style.border}; 
                    color: ${style.text}; 
                    padding: 1rem; 
                    border-radius: 8px; 
                    margin-top: 1rem;
                    font-size: 0.9rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                ">
                    <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span>
                    ${message}
                </div>
            `;

            // 5초 후 메시지 제거
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // 기준 관리 함수들
        function setupCriteriaManagement() {
            loadCriteriaFromAPI();
            
            // 기준 추가 폼 이벤트 리스너
            const addCriteriaForm = document.getElementById('addCriteriaForm');
            if (addCriteriaForm) {
                addCriteriaForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await addNewCriteria();
                });
            }
        }

        async function loadCriteriaFromAPI() {
            try {
                console.log('⚖️ 기준 목록 로딩 시작');
                
                // 현재 선택된 프로젝트가 있는지 확인
                // 실제 환경에서는 현재 프로젝트 ID를 가져와야 함
                const currentProjectId = getCurrentProjectId();
                
                if (!currentProjectId) {
                    displayNoCriteriaProject();
                    return;
                }
                
                // API 호출
                const result = await window.ahpApi.getCriteria(currentProjectId);
                displayCriteria(result.data || []);
                
            } catch (error) {
                console.error('❌ 기준 로딩 오류:', error);
                displayCriteria([]);
            }
        }

        function getCurrentProjectId() {
            // URL 파라미터에서 현재 선택된 프로젝트 ID를 반환
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('projectId') || null;
        }

        function displayNoCriteriaProject() {
            const criteriaContainer = document.getElementById('criteriaContainer');
            if (!criteriaContainer) return;

            criteriaContainer.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #f9fafb; border-radius: 8px; border: 2px dashed #d1d5db;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📋</div>
                    <h3 style="margin-bottom: 1rem; color: #1f2937;">프로젝트를 먼저 선택하세요</h3>
                    <p style="margin-bottom: 2rem; color: #666;">기준을 설정하려면 먼저 프로젝트를 생성하거나 기존 프로젝트를 선택해야 합니다.</p>
                    <button onclick="handleMenuClick('my-projects', null)" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-right: 1rem;">내 프로젝트</button>
                    <button onclick="handleMenuClick('new-project', null)" style="background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">새 프로젝트</button>
                </div>
            `;
        }

        // React 스타일 폼 검증 기능
        function validateProjectForm(formData) {
            const errors = {};
            
            // 프로젝트명 검증
            if (!formData.title.trim()) {
                errors.title = '프로젝트명을 입력해주세요.';
            } else if (formData.title.length < 2) {
                errors.title = '프로젝트명은 2자 이상이어야 합니다.';
            } else if (formData.title.length > 100) {
                errors.title = '프로젝트명은 100자 이하여야 합니다.';
            }
            
            // 목표 검증 (objective)
            if (!formData.objective || !formData.objective.trim()) {
                errors.objective = '프로젝트 목표를 입력해주세요.';
            } else if (formData.objective.length < 10) {
                errors.objective = '목표는 10자 이상 입력해주세요.';
            }
            
            // 평가방식 검증 (settings 내부)
            if (!formData.settings || !formData.settings.evaluation_method) {
                errors.evaluation_method = '평가방식을 선택해주세요.';
            } else if (!['pairwise', 'direct', 'practical'].includes(formData.settings.evaluation_method)) {
                errors.evaluation_method = '올바른 평가방식을 선택해주세요.';
            }
            
            // 설명 검증
            if (!formData.description.trim()) {
                errors.description = '프로젝트 설명을 입력해주세요.';
            } else if (formData.description.length < 10) {
                errors.description = '설명은 10자 이상 입력해주세요.';
            }
            
            return errors;
        }
        
        function displayFormErrors(errors) {
            // 기존 에러 메시지 제거
            const errorElements = document.querySelectorAll('.field-error');
            errorElements.forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
            
            // 새 에러 메시지 표시
            Object.keys(errors).forEach(field => {
                const errorEl = document.getElementById(`${field}Error`) || 
                                document.getElementById(`project${field.charAt(0).toUpperCase() + field.slice(1)}Error`);
                if (errorEl) {
                    errorEl.textContent = errors[field];
                    errorEl.style.display = 'block';
                }
                
                // 필드 색상 변경
                const fieldEl = document.getElementById(`project${field.charAt(0).toUpperCase() + field.slice(1)}`) ||
                               document.getElementById(field);
                if (fieldEl) {
                    fieldEl.style.borderColor = '#ef4444';
                    fieldEl.style.boxShadow = '0 0 0 2px rgba(239, 68, 68, 0.1)';
                }
            });
        }
        
        function clearFieldError(fieldName) {
            const errorEl = document.getElementById(`${fieldName}Error`);
            if (errorEl) {
                errorEl.style.display = 'none';
                errorEl.textContent = '';
            }
            
            // 필드 색상 리셋
            const fieldEl = document.getElementById(fieldName);
            if (fieldEl) {
                fieldEl.style.borderColor = '#d1d5db';
                fieldEl.style.boxShadow = 'none';
            }
        }
        
        // 데모 기준 함수 제거 - 실제 데이터만 사용

        function displayCriteria(criteria) {
            const criteriaContainer = document.getElementById('criteriaContainer');
            if (!criteriaContainer) return;

            if (criteria.length === 0) {
                criteriaContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; background: #f9fafb; border-radius: 8px; border: 2px dashed #d1d5db;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚖️</div>
                        <h3 style="margin-bottom: 1rem; color: #1f2937;">아직 설정된 기준이 없습니다</h3>
                        <p style="margin-bottom: 2rem; color: #666;">AHP 분석을 시작하기 위한 평가 기준을 추가해보세요</p>
                        <button onclick="showAddCriteriaModal()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">첫 기준 추가</button>
                    </div>
                `;
                return;
            }

            let criteriaHTML = `
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8fafc; border-radius: 8px; font-weight: 600; border-bottom: 2px solid #e5e7eb;">
                        <span style="flex: 1;">기준명</span>
                        <span style="flex: 2;">설명</span>
                        <span style="flex: 1; text-align: center;">중요도</span>
                        <span style="flex: 1; text-align: center;">순서</span>
                        <span style="flex: 1; text-align: center;">관리</span>
                    </div>
            `;

            criteria.forEach((criterion, index) => {
                const weightBadge = getWeightBadge(criterion.weight);
                
                criteriaHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 8px; transition: all 0.2s;" onMouseOver="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" onMouseOut="this.style.boxShadow='none'">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">${criterion.name}</div>
                        </div>
                        <div style="flex: 2; padding-right: 1rem;">
                            <div style="color: #666; font-size: 0.9rem; line-height: 1.4;">${criterion.description}</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span style="background: ${weightBadge.bg}; color: ${weightBadge.text}; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">${weightBadge.label}</span>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="display: flex; justify-content: center; gap: 0.5rem;">
                                ${index > 0 ? `<button onclick="moveCriteria('${criterion.id}', 'up')" style="background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="위로">↑</button>` : '<div style="width: 24px;"></div>'}
                                ${index < criteria.length - 1 ? `<button onclick="moveCriteria('${criterion.id}', 'down')" style="background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="아래로">↓</button>` : '<div style="width: 24px;"></div>'}
                            </div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="display: flex; justify-content: center; gap: 0.5rem;">
                                <button onclick="editCriteria('${criterion.id}')" style="background: #6b7280; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; font-size: 0.8rem;" title="편집">✏️</button>
                                <button onclick="deleteCriteria('${criterion.id}')" style="background: #dc2626; color: white; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; font-size: 0.8rem;" title="삭제">🗑️</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            criteriaHTML += `
                </div>
                <div style="margin-top: 2rem; padding: 1.5rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.2rem;">ℹ️</span>
                        <h4 style="margin: 0; color: #1f2937;">다음 단계</h4>
                    </div>
                    <p style="color: #666; margin-bottom: 1rem;">기준 설정이 완료되면 다음 단계를 진행하세요:</p>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="handleMenuClick('alternatives-management', null)" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">1. 대안 설정</button>
                        <button onclick="handleMenuClick('pairwise-comparison', null)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">2. 쌍대비교</button>
                        <button onclick="handleMenuClick('evaluator-management', null)" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">3. 평가자 관리</button>
                    </div>
                </div>
            `;

            criteriaContainer.innerHTML = criteriaHTML;
        }

        function getWeightBadge(weight) {
            const weightMap = {
                'high': { bg: '#fef3c7', text: '#92400e', label: '높음' },
                'normal': { bg: '#e0f2fe', text: '#0277bd', label: '보통' },
                'low': { bg: '#f3e8ff', text: '#7c3aed', label: '낮음' }
            };
            return weightMap[weight] || weightMap.normal;
        }

        // 기준 관리 함수들
        function showAddCriteriaModal() {
            const modal = document.getElementById('addCriteriaModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('criteriaName').focus();
            }
        }

        function hideAddCriteriaModal() {
            const modal = document.getElementById('addCriteriaModal');
            if (modal) {
                modal.style.display = 'none';
                // 폼 리셋
                const form = document.getElementById('addCriteriaForm');
                if (form) form.reset();
            }
        }

        async function addNewCriteria() {
            try {
                const formData = {
                    name: document.getElementById('criteriaName').value.trim(),
                    description: document.getElementById('criteriaDescription').value.trim(),
                    weight: document.getElementById('criteriaWeight').value
                };

                if (!formData.name) {
                    alert('기준명은 필수 입력 사항입니다.');
                    return;
                }

                console.log('⚖️ 새 기준 추가:', formData);

                // API 호출 (실제 환경에서 활성화)
                // const result = await window.ahpApi.createCriterion(getCurrentProjectId(), formData);
                
                // 데모 응답 시뮬레이션
                await new Promise(resolve => setTimeout(resolve, 500));
                
                hideAddCriteriaModal();
                alert('기준이 성공적으로 추가되었습니다!');
                loadCriteriaFromAPI(); // 목록 새로고침
                
            } catch (error) {
                console.error('❌ 기준 추가 오류:', error);
                alert('기준 추가 중 오류가 발생했습니다.');
            }
        }

        function editCriteria(criteriaId) {
            console.log('✏️ 기준 편집:', criteriaId);
            alert(`기준 ${criteriaId} 편집 기능 구현 예정`);
        }

        function deleteCriteria(criteriaId) {
            if (!confirm('정말로 이 기준을 삭제하시겠습니까?\n삭제 시 관련된 모든 평가 데이터가 함께 삭제됩니다.')) {
                return;
            }

            console.log('🗑️ 기준 삭제:', criteriaId);
            alert('기준이 삭제되었습니다.');
            loadCriteriaFromAPI(); // 목록 새로고침
        }

        function moveCriteria(criteriaId, direction) {
            console.log('📊 기준 순서 변경:', criteriaId, direction);
            alert(`기준 순서 변경 기능 구현 예정 (${direction})`);
            // 실제 구현 시 순서 변경 후 목록 새로고침
            // loadCriteriaFromAPI();
        }

        // 쌍대비교 관련 함수들
        let currentPairwiseData = {
            criteria: [],
            comparisons: [],
            currentIndex: 0,
            totalComparisons: 0
        };

        function setupPairwiseComparison() {
            loadPairwiseData();
        }

        async function loadPairwiseData() {
            try {
                console.log('⚡ 쌍대비교 데이터 로딩 시작');
                
                const currentProjectId = getCurrentProjectId();
                
                if (!currentProjectId) {
                    displayNoPairwiseProject();
                    return;
                }
                
                // API 호출하여 기준 목록 가져오기 (실제 환경에서 활성화)
                // const criteriaResult = await window.ahpApi.getCriteria(currentProjectId);
                
                // 실제 기준 데이터 로드
                const projectId = getCurrentProjectId();
                if (!projectId) {
                    displayNoPairwiseProject();
                    return;
                }
                
                const result = await window.ahpApi.getCriteria(projectId);
                const criteria = result.data || [];
                
                if (criteria.length < 2) {
                    displayInsufficientCriteria();
                    return;
                }
                
                // 쌍대비교 데이터 초기화
                initializePairwiseComparison(criteria);
                
            } catch (error) {
                console.error('❌ 쌍대비교 데이터 로딩 오류:', error);
                displayPairwiseError(error);
            }
        }

        function displayNoPairwiseProject() {
            const container = document.getElementById('pairwiseContainer');
            if (!container) return;

            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #f9fafb; border-radius: 8px; border: 2px dashed #d1d5db;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📋</div>
                    <h3 style="margin-bottom: 1rem; color: #1f2937;">프로젝트를 먼저 선택하세요</h3>
                    <p style="margin-bottom: 2rem; color: #666;">쌍대비교를 수행하려면 먼저 프로젝트를 생성하거나 기존 프로젝트를 선택해야 합니다.</p>
                    <button onclick="handleMenuClick('my-projects', null)" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-right: 1rem;">내 프로젝트</button>
                    <button onclick="handleMenuClick('new-project', null)" style="background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">새 프로젝트</button>
                </div>
            `;
        }

        function displayInsufficientCriteria() {
            const container = document.getElementById('pairwiseContainer');
            if (!container) return;

            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #fef3c7; border-radius: 8px; border: 2px dashed #f59e0b;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">⚖️</div>
                    <h3 style="margin-bottom: 1rem; color: #92400e;">기준이 부족합니다</h3>
                    <p style="margin-bottom: 2rem; color: #92400e;">쌍대비교를 수행하려면 최소 2개 이상의 기준이 필요합니다.</p>
                    <button onclick="handleMenuClick('criteria-management', null)" style="background: #f59e0b; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">기준 설정하기</button>
                </div>
            `;
        }

        function displayPairwiseError(error) {
            const container = document.getElementById('pairwiseContainer');
            if (!container) return;

            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #fef2f2; border-radius: 8px; border: 2px dashed #ef4444;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">❌</div>
                    <h3 style="margin-bottom: 1rem; color: #dc2626;">데이터 로딩 오류</h3>
                    <p style="margin-bottom: 2rem; color: #dc2626;">${error.message || '쌍대비교 데이터를 불러오는 중 오류가 발생했습니다.'}</p>
                    <button onclick="loadPairwiseData()" style="background: #dc2626; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">다시 시도</button>
                </div>
            `;
        }

        function initializePairwiseComparison(criteria) {
            // 모든 가능한 쌍대비교 조합 생성
            const comparisons = [];
            for (let i = 0; i < criteria.length; i++) {
                for (let j = i + 1; j < criteria.length; j++) {
                    comparisons.push({
                        criteriaA: criteria[i],
                        criteriaB: criteria[j],
                        value: null,
                        completed: false
                    });
                }
            }

            currentPairwiseData = {
                criteria: criteria,
                comparisons: comparisons,
                currentIndex: 0,
                totalComparisons: comparisons.length
            };

            displayPairwiseComparison();
            updateProgress();
        }

        function displayPairwiseComparison() {
            const container = document.getElementById('pairwiseContainer');
            if (!container) return;

            const { comparisons, currentIndex, totalComparisons } = currentPairwiseData;
            
            if (currentIndex >= totalComparisons) {
                displayComparisonComplete();
                return;
            }

            const currentComparison = comparisons[currentIndex];
            const { criteriaA, criteriaB } = currentComparison;

            container.innerHTML = `
                <div style="background: #f9fafb; padding: 2.5rem; border-radius: 12px; text-align: center;">
                    <div style="margin-bottom: 1.5rem;">
                        <span style="background: #e5e7eb; color: #4b5563; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.9rem;">${currentIndex + 1} / ${totalComparisons}</span>
                    </div>
                    
                    <h3 style="margin-bottom: 1rem; color: #1f2937; font-size: 1.5rem;">
                        "${criteriaA.name}" vs "${criteriaB.name}"
                    </h3>
                    <p style="color: #666; margin-bottom: 2.5rem; font-size: 1.1rem;">
                        "${criteriaA.name}"이 "${criteriaB.name}"에 비해<br>
                        얼마나 더 중요하다고 생각하십니까?
                    </p>
                    
                    <!-- 왼쪽 선택 (criteriaA가 더 중요) -->
                    <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                        <div style="text-align: center; min-width: 120px;">
                            <div style="font-weight: 600; color: #C8A968; margin-bottom: 0.5rem;">${criteriaA.name}</div>
                            <div style="font-size: 0.8rem; color: #666;">이 더 중요</div>
                        </div>
                        
                        <div style="display: flex; gap: 0.25rem; align-items: center;">
                            ${[9, 7, 5, 3, 1].map(value => `
                                <button onclick="setPairwiseValue('left', ${value})" 
                                        style="width: 45px; height: 45px; border: 2px solid #d1d5db; background: white; cursor: pointer; border-radius: 8px; font-weight: 600; transition: all 0.2s; font-size: 1rem;"
                                        onMouseOver="this.style.borderColor='#C8A968'; this.style.background='#f5f3f0'"
                                        onMouseOut="this.style.borderColor='#d1d5db'; this.style.background='white'"
                                        title="${getScaleLabel(value)}">
                                    ${value}
                                </button>
                            `).join('')}
                            
                            <div style="margin: 0 1rem; font-size: 1.2rem; color: #666;">vs</div>
                            
                            ${[1, 3, 5, 7, 9].map(value => `
                                <button onclick="setPairwiseValue('right', ${value})" 
                                        style="width: 45px; height: 45px; border: 2px solid #d1d5db; background: white; cursor: pointer; border-radius: 8px; font-weight: 600; transition: all 0.2s; font-size: 1rem;"
                                        onMouseOver="this.style.borderColor='#C8A968'; this.style.background='#f5f3f0'"
                                        onMouseOut="this.style.borderColor='#d1d5db'; this.style.background='white'"
                                        title="${getScaleLabel(value)}">
                                    ${value}
                                </button>
                            `).join('')}
                        </div>
                        
                        <div style="text-align: center; min-width: 120px;">
                            <div style="font-weight: 600; color: #C8A968; margin-bottom: 0.5rem;">${criteriaB.name}</div>
                            <div style="font-size: 0.8rem; color: #666;">이 더 중요</div>
                        </div>
                    </div>
                    
                    <!-- 중간값 버튼들 -->
                    <div style="margin-bottom: 2rem;">
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">중간값을 선택하려면:</p>
                        <div style="display: flex; justify-content: center; gap: 0.5rem;">
                            ${[2, 4, 6, 8].map(value => `
                                <button onclick="showIntermediateValueModal(${value})" 
                                        style="width: 35px; height: 35px; border: 1px solid #d1d5db; background: #f9fafb; cursor: pointer; border-radius: 6px; font-size: 0.9rem; transition: all 0.2s;"
                                        onMouseOver="this.style.borderColor='#C8A968'; this.style.background='#f5f3f0'"
                                        onMouseOut="this.style.borderColor='#d1d5db'; this.style.background='#f9fafb'"
                                        title="중간값 ${value}">
                                    ${value}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div id="currentSelection" style="margin-bottom: 2rem; min-height: 1.5rem;">
                        <!-- 현재 선택된 값 표시 -->
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem;">
                        <button onclick="previousComparison()" 
                                ${currentIndex === 0 ? 'disabled' : ''} 
                                style="background: ${currentIndex === 0 ? '#e5e7eb' : '#6b7280'}; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: ${currentIndex === 0 ? 'not-allowed' : 'pointer'}; font-size: 1rem;">
                            ← 이전
                        </button>
                        <button onclick="skipComparison()" 
                                style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            건너뛰기
                        </button>
                        <button id="nextComparisonBtn" onclick="nextComparison()" 
                                disabled 
                                style="background: #e5e7eb; color: #9ca3af; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: not-allowed; font-size: 1rem;">
                            다음 →
                        </button>
                    </div>
                </div>
                
                <!-- 중간값 선택 모달 (숨김) -->
                <div id="intermediateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 400px; width: 90%; text-align: center;">
                        <h3 style="margin-bottom: 1rem; color: #1f2937;">중간값 선택</h3>
                        <p style="margin-bottom: 1.5rem; color: #666;">어느 쪽이 더 중요한지 선택하세요</p>
                        <div id="intermediateOptions" style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
                            <!-- 중간값 선택 옵션들이 여기에 동적으로 추가됩니다 -->
                        </div>
                        <button onclick="hideIntermediateModal()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">취소</button>
                    </div>
                </div>
            `;

            // 진행률 표시
            const progressDiv = document.getElementById('comparisonProgress');
            if (progressDiv) {
                progressDiv.style.display = 'block';
            }
        }

        function getScaleLabel(value) {
            const labels = {
                1: '동등함',
                2: '동등함~약간 중요',
                3: '약간 중요',
                4: '약간 중요~중요함',
                5: '중요함',
                6: '중요함~매우 중요',
                7: '매우 중요',
                8: '매우 중요~절대 중요',
                9: '절대 중요'
            };
            return labels[value] || value.toString();
        }

        function setPairwiseValue(side, value) {
            const { comparisons, currentIndex } = currentPairwiseData;
            const currentComparison = comparisons[currentIndex];
            
            // 값 설정 (왼쪽이면 양수, 오른쪽이면 음수로 구분)
            const finalValue = side === 'left' ? value : (1/value);
            currentComparison.value = finalValue;
            currentComparison.completed = true;
            
            // 선택 상태 표시
            updateCurrentSelection(currentComparison.criteriaA.name, currentComparison.criteriaB.name, side, value);
            
            // 다음 버튼 활성화
            const nextBtn = document.getElementById('nextComparisonBtn');
            if (nextBtn) {
                nextBtn.disabled = false;
                nextBtn.style.background = '#C8A968';
                nextBtn.style.color = 'white';
                nextBtn.style.cursor = 'pointer';
            }
            
            console.log(`⚡ 쌍대비교 값 설정: ${currentComparison.criteriaA.name} vs ${currentComparison.criteriaB.name} = ${finalValue}`);
        }

        function updateCurrentSelection(criteriaA, criteriaB, side, value) {
            const selectionDiv = document.getElementById('currentSelection');
            if (!selectionDiv) return;
            
            const winner = side === 'left' ? criteriaA : criteriaB;
            const loser = side === 'left' ? criteriaB : criteriaA;
            
            selectionDiv.innerHTML = `
                <div style="background: #f0f9ff; border: 1px solid #3b82f6; border-radius: 8px; padding: 1rem;">
                    <span style="font-weight: 600; color: #1f2937;">"${winner}"</span>이 
                    <span style="font-weight: 600; color: #1f2937;">"${loser}"</span>보다 
                    <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-weight: 600;">${getScaleLabel(value)}</span>
                </div>
            `;
        }

        function showIntermediateValueModal(value) {
            const modal = document.getElementById('intermediateModal');
            const optionsDiv = document.getElementById('intermediateOptions');
            
            if (!modal || !optionsDiv) return;
            
            const { comparisons, currentIndex } = currentPairwiseData;
            const currentComparison = comparisons[currentIndex];
            
            optionsDiv.innerHTML = `
                <button onclick="setPairwiseValueIntermediate('left', ${value})" 
                        style="flex: 1; background: #C8A968; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer;">
                    ${currentComparison.criteriaA.name}이<br>${value}배 중요
                </button>
                <button onclick="setPairwiseValueIntermediate('right', ${value})" 
                        style="flex: 1; background: #C8A968; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer;">
                    ${currentComparison.criteriaB.name}이<br>${value}배 중요
                </button>
            `;
            
            modal.style.display = 'flex';
        }

        function hideIntermediateModal() {
            const modal = document.getElementById('intermediateModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function setPairwiseValueIntermediate(side, value) {
            setPairwiseValue(side, value);
            hideIntermediateModal();
        }

        function previousComparison() {
            if (currentPairwiseData.currentIndex > 0) {
                currentPairwiseData.currentIndex--;
                displayPairwiseComparison();
                updateProgress();
            }
        }

        function nextComparison() {
            const { comparisons, currentIndex } = currentPairwiseData;
            
            if (!comparisons[currentIndex].completed) {
                alert('비교값을 선택해주세요.');
                return;
            }
            
            currentPairwiseData.currentIndex++;
            displayPairwiseComparison();
            updateProgress();
            
            // API에 비교 결과 저장 (실제 환경에서 활성화)
            // savePairwiseComparison(comparisons[currentIndex]);
        }

        function skipComparison() {
            if (confirm('이 비교를 건너뛰시겠습니까?\n나중에 다시 설정할 수 있습니다.')) {
                currentPairwiseData.currentIndex++;
                displayPairwiseComparison();
                updateProgress();
            }
        }

        function updateProgress() {
            const { comparisons, totalComparisons } = currentPairwiseData;
            const completedCount = comparisons.filter(c => c.completed).length;
            const progressPercent = Math.round((completedCount / totalComparisons) * 100);
            
            const progressText = document.getElementById('progressText');
            const progressBar = document.getElementById('progressBar');
            
            if (progressText) {
                progressText.textContent = `${completedCount}/${totalComparisons} 완료`;
            }
            
            if (progressBar) {
                progressBar.style.width = `${progressPercent}%`;
            }
        }

        function displayComparisonComplete() {
            const container = document.getElementById('pairwiseContainer');
            if (!container) return;

            const { comparisons } = currentPairwiseData;
            const completedCount = comparisons.filter(c => c.completed).length;
            const totalCount = comparisons.length;
            const completionRate = Math.round((completedCount / totalCount) * 100);

            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #f0fdf4; border-radius: 12px; border: 2px solid #10b981;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">🎉</div>
                    <h3 style="margin-bottom: 1rem; color: #065f46;">쌍대비교 완료!</h3>
                    <p style="margin-bottom: 2rem; color: #047857;">
                        총 ${totalCount}개 중 ${completedCount}개의 비교를 완료했습니다 (${completionRate}%)
                    </p>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; min-width: 120px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${completedCount}</div>
                            <div style="font-size: 0.9rem; color: #666;">완료된 비교</div>
                        </div>
                        <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; min-width: 120px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${totalCount - completedCount}</div>
                            <div style="font-size: 0.9rem; color: #666;">건너뛴 비교</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem;">
                        <button onclick="calculateResults()" style="background: #10b981; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">📊 결과 계산하기</button>
                        <button onclick="reviewComparisons()" style="background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">📝 비교 검토하기</button>
                        <button onclick="resetPairwiseComparison()" style="background: #6b7280; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">🔄 다시 시작</button>
                    </div>
                </div>
            `;
        }

        function calculateResults() {
            console.log('📊 AHP 결과 계산 시작');
            handleMenuClick('results-analysis', null);
        }

        function reviewComparisons() {
            console.log('📝 쌍대비교 검토 시작');
            currentPairwiseData.currentIndex = 0;
            displayPairwiseComparison();
        }

        function resetPairwiseComparison() {
            if (confirm('모든 쌍대비교를 초기화하시겠습니까?\n입력한 모든 데이터가 삭제됩니다.')) {
                console.log('🔄 쌍대비교 초기화');
                loadPairwiseData();
            }
        }

        // =========================
        // Phase 2: AHP 계산 엔진
        // =========================
        
        /**
         * AHP 우선순위 계산을 위한 수학적 함수들
         */
        class AHPCalculator {
            constructor() {
                this.randomIndex = {
                    1: 0, 2: 0, 3: 0.58, 4: 0.9, 5: 1.12, 6: 1.24, 7: 1.32, 8: 1.41, 9: 1.45, 10: 1.49
                };
            }

            /**
             * 쌍대비교 매트릭스 생성
             */
            createComparisonMatrix(criteria, comparisons) {
                const n = criteria.length;
                const matrix = Array(n).fill().map(() => Array(n).fill(1));

                // 대각선은 1로 초기화 (자기 자신과의 비교)
                for (let i = 0; i < n; i++) {
                    matrix[i][i] = 1;
                }

                // 쌍대비교 결과를 매트릭스에 입력
                comparisons.forEach(comparison => {
                    if (!comparison.completed) return;

                    const indexA = criteria.findIndex(c => c.id === comparison.criteriaA.id);
                    const indexB = criteria.findIndex(c => c.id === comparison.criteriaB.id);

                    if (indexA >= 0 && indexB >= 0) {
                        matrix[indexA][indexB] = comparison.value || 1;
                        matrix[indexB][indexA] = 1 / (comparison.value || 1); // 역수 관계
                    }
                });

                return matrix;
            }

            /**
             * 기하평균법을 사용한 고유벡터 계산 (우선순위 계산)
             */
            calculatePriorities(matrix) {
                const n = matrix.length;
                const priorities = [];

                for (let i = 0; i < n; i++) {
                    let product = 1;
                    for (let j = 0; j < n; j++) {
                        product *= matrix[i][j];
                    }
                    priorities[i] = Math.pow(product, 1/n);
                }

                // 정규화 (합이 1이 되도록)
                const sum = priorities.reduce((a, b) => a + b, 0);
                return priorities.map(p => p / sum);
            }

            /**
             * 일관성 비율 (CR) 계산
             */
            calculateConsistencyRatio(matrix, priorities) {
                const n = matrix.length;
                
                if (n <= 2) return 0; // 2x2 매트릭스는 항상 일관성 있음

                // λmax (최대 고유값) 계산
                let lambdaMax = 0;
                for (let i = 0; i < n; i++) {
                    let sum = 0;
                    for (let j = 0; j < n; j++) {
                        sum += matrix[i][j] * priorities[j];
                    }
                    lambdaMax += sum / priorities[i];
                }
                lambdaMax /= n;

                // CI (일관성 지수) 계산
                const ci = (lambdaMax - n) / (n - 1);

                // CR (일관성 비율) 계산
                const ri = this.randomIndex[n] || 1.49;
                const cr = ci / ri;

                return {
                    lambdaMax: lambdaMax,
                    ci: ci,
                    cr: cr,
                    isConsistent: cr <= 0.1 // 10% 이하면 일관성 있음
                };
            }

            /**
             * 전체 AHP 분석 실행
             */
            performAHPAnalysis(criteria, comparisons) {
                console.log('🔢 AHP 분석 시작:', { criteria: criteria.length, comparisons: comparisons.length });

                // 1. 비교 매트릭스 생성
                const matrix = this.createComparisonMatrix(criteria, comparisons);
                console.log('📊 비교 매트릭스:', matrix);

                // 2. 우선순위 계산
                const priorities = this.calculatePriorities(matrix);
                console.log('📈 우선순위:', priorities);

                // 3. 일관성 검증
                const consistency = this.calculateConsistencyRatio(matrix, priorities);
                console.log('🎯 일관성 검증:', consistency);

                // 4. 결과를 기준과 매칭
                const results = criteria.map((criterion, index) => ({
                    criterion: criterion,
                    priority: priorities[index],
                    rank: 0 // 나중에 순위 계산
                }));

                // 5. 우선순위 순으로 정렬 및 순위 부여
                results.sort((a, b) => b.priority - a.priority);
                results.forEach((result, index) => {
                    result.rank = index + 1;
                });

                return {
                    matrix: matrix,
                    priorities: priorities,
                    consistency: consistency,
                    results: results,
                    completedComparisons: comparisons.filter(c => c.completed).length,
                    totalComparisons: comparisons.length,
                    completionRate: Math.round((comparisons.filter(c => c.completed).length / comparisons.length) * 100)
                };
            }
        }

        // AHP 계산기 인스턴스
        const ahpCalculator = new AHPCalculator();

        /**
         * 현재 프로젝트의 AHP 분석 실행
         */
        function performCurrentProjectAnalysis() {
            const currentProject = getCurrentProject();
            const currentCriteria = getCurrentCriteria(); 
            const currentComparisons = getCurrentComparisons();

            if (!currentProject || !currentCriteria || currentCriteria.length < 2) {
                console.warn('⚠️ AHP 분석을 위한 데이터가 부족합니다');
                return null;
            }

            return ahpCalculator.performAHPAnalysis(currentCriteria, currentComparisons);
        }

        /**
         * 현재 프로젝트 정보 가져오기
         */
        function getCurrentProject() {
            // 현재 선택된 프로젝트 정보 반환
            const projectId = getCurrentProjectId();
            if (!projectId) return null;
            
            // API를 통해 프로젝트 정보를 가져와야 함
            // TODO: window.ahpApi.getProject(projectId)
            return { id: projectId, name: '현재 프로젝트' };
        }

        /**
         * 현재 기준 목록 가져오기
         */
        function getCurrentCriteria() {
            // 실제 구현 시에는 API에서 가져오거나 현재 상태에서 조회
            return currentCriteriaData?.criteria || [];
        }

        /**
         * 현재 쌍대비교 결과 가져오기
         */
        function getCurrentComparisons() {
            // 실제 구현 시에는 API에서 가져오거나 현재 상태에서 조회
            return currentPairwiseData?.comparisons || [];
        }

        /**
         * calculateResults 함수 업데이트 - 실제 AHP 계산 수행
         */
        function calculateResults() {
            console.log('📊 AHP 결과 계산 시작');
            
            // AHP 분석 실행
            const analysisResult = performCurrentProjectAnalysis();
            
            if (analysisResult) {
                // 결과를 전역 변수에 저장 (결과 화면에서 사용)
                window.currentAHPResult = analysisResult;
                console.log('✅ AHP 분석 완료:', analysisResult);
            } else {
                // 분석 실패 시 기본값 설정
                window.currentAHPResult = null;
                console.warn('⚠️ AHP 분석 실패 - 데이터가 부족합니다');
            }
            
            handleMenuClick('results-analysis', null);
        }

        /**
         * 추가 AHP 분석 함수들
         */
        function recalculateResults() {
            console.log('🔄 AHP 결과 재계산 시작');
            calculateResults(); // 기존 계산 함수 재실행
        }

        function downloadAHPReport() {
            const ahpResult = window.currentAHPResult;
            if (!ahpResult) {
                alert('먼저 AHP 분석을 완료해주세요.');
                return;
            }

            // 간단한 텍스트 보고서 생성
            const currentProject = getCurrentProject();
            const reportText = generateTextReport(currentProject, ahpResult);
            
            // 파일 다운로드
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `AHP_분석보고서_${currentProject?.name || '프로젝트'}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            console.log('📄 AHP 분석 보고서 다운로드 완료');
        }

        function generateTextReport(project, ahpResult) {
            const { consistency, results, completionRate, completedComparisons, totalComparisons } = ahpResult;
            const date = new Date().toLocaleDateString('ko-KR');
            const time = new Date().toLocaleTimeString('ko-KR');
            
            let report = '';
            report += '==================================================\n';
            report += '           AHP (Analytic Hierarchy Process)\n';
            report += '                  분석 결과 보고서\n';
            report += '==================================================\n\n';
            
            report += `분석 일시: ${date} ${time}\n`;
            report += `프로젝트: ${project?.name || '이름 없음'}\n`;
            report += `목표: ${project?.goal || '목표 없음'}\n`;
            report += `설명: ${project?.description || '설명 없음'}\n\n`;
            
            report += '==================================================\n';
            report += '                   분석 개요\n';
            report += '==================================================\n';
            report += `평가 기준 수: ${results.length}개\n`;
            report += `총 비교 쌍: ${totalComparisons}개\n`;
            report += `완료된 비교: ${completedComparisons}개 (${completionRate}%)\n`;
            report += `분석 방법: 기하평균법 (Geometric Mean Method)\n\n`;
            
            report += '==================================================\n';
            report += '                 일관성 검증 결과\n';
            report += '==================================================\n';
            report += `최대 고유값 (λmax): ${consistency.lambdaMax.toFixed(6)}\n`;
            report += `일관성 지수 (CI): ${consistency.ci.toFixed(6)}\n`;
            report += `무작위 지수 (RI): ${ahpCalculator.randomIndex[results.length] || 1.49}\n`;
            report += `일관성 비율 (CR): ${consistency.cr.toFixed(6)}\n`;
            report += `일관성 상태: ${consistency.isConsistent ? '통과 (CR ≤ 0.1)' : '검토 필요 (CR > 0.1)'}\n\n`;
            
            if (!consistency.isConsistent) {
                report += '⚠️  경고: 일관성 비율이 0.1을 초과합니다.\n';
                report += '    쌍대비교를 재검토하여 일관성을 개선하는 것이 좋습니다.\n\n';
            }
            
            report += '==================================================\n';
            report += '                최종 우선순위 결과\n';
            report += '==================================================\n';
            results.forEach((result, index) => {
                const percentage = (result.priority * 100).toFixed(2);
                report += `${result.rank}위. ${result.criterion.name}\n`;
                report += `     우선순위: ${result.priority.toFixed(6)} (${percentage}%)\n`;
                if (result.criterion.description) {
                    report += `     설명: ${result.criterion.description}\n`;
                }
                report += '\n';
            });
            
            report += '==================================================\n';
            report += '                   권장사항\n';
            report += '==================================================\n';
            const topCriterion = results[0];
            const topPercentage = (topCriterion.priority * 100).toFixed(1);
            report += `• 최우선 기준: "${topCriterion.criterion.name}" (${topPercentage}%)\n`;
            report += `• 의사결정 시 "${topCriterion.criterion.name}" 기준을 가장 중요하게 고려하세요.\n`;
            
            if (consistency.isConsistent) {
                report += `• 일관성 검증을 통과하여 결과를 신뢰할 수 있습니다.\n`;
            } else {
                report += `• 일관성이 부족하므로 쌍대비교를 재검토해주세요.\n`;
            }
            
            report += '\n==================================================\n';
            report += '본 보고서는 AHP for Paper 플랫폼에서 생성되었습니다.\n';
            report += `생성 시간: ${date} ${time}\n`;
            report += '==================================================\n';
            
            return report;
        }

        function generateVisualization() {
            console.log('📊 AHP 시각화 생성 시작');
            const ahpResult = window.currentAHPResult;
            if (!ahpResult) {
                alert('먼저 AHP 분석을 완료해주세요.');
                return;
            }

            // 시각화 페이지로 이동하고 데이터 전달
            handleMenuClick('visualization-dashboard', null);
        }

        /**
         * 시각화 대시보드 콘텐츠 생성
         */
        function generateVisualizationDashboardContent() {
            const ahpResult = window.currentAHPResult;
            if (!ahpResult) {
                return generateComingSoonContent('시각화 대시보드', 'visualization-dashboard');
            }

            const { results, consistency } = ahpResult;
            
            // 막대 차트 HTML 생성
            const maxPriority = Math.max(...results.map(r => r.priority));
            const barChartHtml = results.map((result, index) => {
                const percentage = (result.priority * 100).toFixed(1);
                const barWidth = (result.priority / maxPriority) * 100;
                const barColor = `hsl(${45 + index * 30}, 65%, 55%)`; // 색상 다양화
                
                return `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600; color: #1f2937;">${result.rank}. ${result.criterion.name}</span>
                            <span style="color: #6b7280; font-size: 0.9rem;">${percentage}%</span>
                        </div>
                        <div style="background: #f3f4f6; height: 24px; border-radius: 12px; overflow: hidden; position: relative;">
                            <div style="
                                background: linear-gradient(90deg, ${barColor}, ${barColor}dd);
                                height: 100%;
                                width: ${Math.max(barWidth, 2)}%;
                                transition: width 0.8s ease;
                                border-radius: 12px;
                                display: flex;
                                align-items: center;
                                padding: 0 0.75rem;
                            ">
                                <span style="color: white; font-weight: 600; font-size: 0.85rem; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">
                                    ${result.priority.toFixed(3)}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // 파이 차트 데이터 준비 (CSS로 구현)
            let cumulativeAngle = 0;
            const pieSegments = results.map((result, index) => {
                const percentage = result.priority * 100;
                const angle = (percentage / 100) * 360;
                const startAngle = cumulativeAngle;
                cumulativeAngle += angle;
                
                const color = `hsl(${45 + index * 30}, 65%, 55%)`;
                
                return {
                    ...result,
                    percentage: percentage.toFixed(1),
                    startAngle,
                    endAngle: cumulativeAngle,
                    color
                };
            });

            // 파이 차트 범례 생성
            const legendHtml = pieSegments.map(segment => `
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <div style="
                        width: 16px;
                        height: 16px;
                        background: ${segment.color};
                        border-radius: 2px;
                        margin-right: 0.75rem;
                        flex-shrink: 0;
                    "></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.9rem; color: #1f2937;">${segment.criterion.name}</div>
                        <div style="font-size: 0.8rem; color: #6b7280;">${segment.percentage}%</div>
                    </div>
                </div>
            `).join('');

            // 일관성 시각화 (게이지 차트)
            const consistencyPercentage = Math.max(0, Math.min(100, (1 - consistency.cr / 0.2) * 100)); // 0.2를 기준으로 정규화
            const consistencyColor = consistency.cr <= 0.05 ? '#10b981' : consistency.cr <= 0.1 ? '#f59e0b' : '#ef4444';

            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">📊 AHP 분석 시각화</h2>
                            <button onclick="handleMenuClick('results-analysis', null)" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">← 결과 분석으로</button>
                        </div>

                        <!-- 시각화 탭 메뉴 -->
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid #f3f4f6;">
                            <button onclick="showVisualizationTab('bar')" id="barChartTab" style="
                                background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; 
                                border-radius: 6px 6px 0 0; cursor: pointer; font-weight: 600;
                            ">막대 차트</button>
                            <button onclick="showVisualizationTab('pie')" id="pieChartTab" style="
                                background: #e5e7eb; color: #6b7280; border: none; padding: 0.75rem 1.5rem; 
                                border-radius: 6px 6px 0 0; cursor: pointer; font-weight: 600;
                            ">파이 차트</button>
                            <button onclick="showVisualizationTab('consistency')" id="consistencyTab" style="
                                background: #e5e7eb; color: #6b7280; border: none; padding: 0.75rem 1.5rem; 
                                border-radius: 6px 6px 0 0; cursor: pointer; font-weight: 600;
                            ">일관성 분석</button>
                        </div>

                        <!-- 막대 차트 -->
                        <div id="barChartSection" style="display: block;">
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #1f2937; margin-bottom: 1rem;">📊 우선순위 막대 차트</h3>
                                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 2rem;">
                                    각 기준의 상대적 중요도를 막대의 길이로 표현합니다.
                                </p>
                                <div style="background: #f9fafb; padding: 2rem; border-radius: 8px;">
                                    ${barChartHtml}
                                </div>
                            </div>
                        </div>

                        <!-- 파이 차트 -->
                        <div id="pieChartSection" style="display: none;">
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #1f2937; margin-bottom: 1rem;">🥧 우선순위 파이 차트</h3>
                                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 2rem;">
                                    전체에서 각 기준이 차지하는 비중을 원형으로 표현합니다.
                                </p>
                                <div style="display: grid; grid-template-columns: 1fr 250px; gap: 2rem; background: #f9fafb; padding: 2rem; border-radius: 8px;">
                                    <!-- 파이 차트 (CSS로 구현) -->
                                    <div style="display: flex; justify-content: center; align-items: center;">
                                        <div style="position: relative; width: 200px; height: 200px;">
                                            <!-- 단순한 도넛 차트로 구현 -->
                                            <div style="
                                                width: 200px; height: 200px; border-radius: 50%;
                                                background: conic-gradient(
                                                    ${pieSegments.map(s => `${s.color} ${s.startAngle/360*100}% ${s.endAngle/360*100}%`).join(', ')}
                                                );
                                                position: relative;
                                            ">
                                                <div style="
                                                    position: absolute; top: 50px; left: 50px;
                                                    width: 100px; height: 100px; border-radius: 50%;
                                                    background: white; display: flex;
                                                    align-items: center; justify-content: center;
                                                    flex-direction: column;
                                                ">
                                                    <div style="font-weight: bold; color: #1f2937;">총합</div>
                                                    <div style="font-size: 0.9rem; color: #6b7280;">100%</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 범례 -->
                                    <div>
                                        <h4 style="margin-bottom: 1rem; color: #1f2937;">범례</h4>
                                        ${legendHtml}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 일관성 분석 -->
                        <div id="consistencySection" style="display: none;">
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #1f2937; margin-bottom: 1rem;">🎯 일관성 분석 시각화</h3>
                                <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 2rem;">
                                    쌍대비교의 일관성을 시각적으로 분석합니다. (CR ≤ 0.1이 권장)
                                </p>
                                
                                <div style="background: #f9fafb; padding: 2rem; border-radius: 8px;">
                                    <!-- 일관성 게이지 -->
                                    <div style="text-align: center; margin-bottom: 2rem;">
                                        <div style="position: relative; width: 200px; height: 100px; margin: 0 auto; margin-bottom: 1rem;">
                                            <!-- 반원 게이지 배경 -->
                                            <div style="
                                                width: 200px; height: 100px; 
                                                border: 10px solid #e5e7eb;
                                                border-bottom: none;
                                                border-radius: 100px 100px 0 0;
                                                position: relative;
                                                background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
                                                background-clip: padding-box;
                                                padding: 10px;
                                            ">
                                                <!-- 게이지 바늘 -->
                                                <div style="
                                                    position: absolute;
                                                    bottom: 10px;
                                                    left: 50%;
                                                    transform: translateX(-50%) rotate(${(consistency.cr / 0.2) * 180 - 90}deg);
                                                    transform-origin: 50% 100%;
                                                    width: 2px;
                                                    height: 80px;
                                                    background: #1f2937;
                                                    transition: transform 0.5s ease;
                                                "></div>
                                                
                                                <!-- 중심점 -->
                                                <div style="
                                                    position: absolute;
                                                    bottom: 5px;
                                                    left: 50%;
                                                    transform: translateX(-50%);
                                                    width: 10px;
                                                    height: 10px;
                                                    background: #1f2937;
                                                    border-radius: 50%;
                                                "></div>
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: 1rem;">
                                            <div style="color: ${consistencyColor}; font-size: 2rem; font-weight: bold;">
                                                ${consistency.cr.toFixed(3)}
                                            </div>
                                            <div style="color: #666;">일관성 비율 (CR)</div>
                                        </div>
                                        
                                        <div style="background: ${consistency.isConsistent ? '#f0fdf4' : '#fef2f2'}; padding: 1rem; border-radius: 6px; border: 1px solid ${consistency.isConsistent ? '#10b981' : '#ef4444'};">
                                            <div style="color: ${consistencyColor}; font-weight: 600;">
                                                ${consistency.isConsistent ? '✅ 일관성 양호' : '⚠️ 일관성 개선 필요'}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 일관성 지표 세부 정보 -->
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;">
                                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                            <div style="color: #6b7280; font-size: 0.9rem;">λmax</div>
                                            <div style="font-weight: bold; color: #1f2937;">${consistency.lambdaMax.toFixed(3)}</div>
                                        </div>
                                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                            <div style="color: #6b7280; font-size: 0.9rem;">CI</div>
                                            <div style="font-weight: bold; color: #1f2937;">${consistency.ci.toFixed(3)}</div>
                                        </div>
                                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                            <div style="color: #6b7280; font-size: 0.9rem;">RI</div>
                                            <div style="font-weight: bold; color: #1f2937;">${ahpCalculator.randomIndex[results.length] || 1.49}</div>
                                        </div>
                                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                            <div style="color: #6b7280; font-size: 0.9rem;">CR</div>
                                            <div style="font-weight: bold; color: ${consistencyColor};">${consistency.cr.toFixed(3)}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 액션 버튼 -->
                        <div style="text-align: center; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                            <button onclick="downloadAHPReport()" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-right: 1rem;">📄 보고서 다운로드</button>
                            <button onclick="printVisualization()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">🖨️ 인쇄하기</button>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 시각화 탭 전환 함수
         */
        function showVisualizationTab(tabName) {
            // 모든 섹션 숨기기
            document.getElementById('barChartSection').style.display = 'none';
            document.getElementById('pieChartSection').style.display = 'none';
            document.getElementById('consistencySection').style.display = 'none';

            // 모든 탭 비활성화
            document.getElementById('barChartTab').style.background = '#e5e7eb';
            document.getElementById('barChartTab').style.color = '#6b7280';
            document.getElementById('pieChartTab').style.background = '#e5e7eb';
            document.getElementById('pieChartTab').style.color = '#6b7280';
            document.getElementById('consistencyTab').style.background = '#e5e7eb';
            document.getElementById('consistencyTab').style.color = '#6b7280';

            // 선택된 탭과 섹션 활성화
            if (tabName === 'bar') {
                document.getElementById('barChartSection').style.display = 'block';
                document.getElementById('barChartTab').style.background = '#C8A968';
                document.getElementById('barChartTab').style.color = 'white';
            } else if (tabName === 'pie') {
                document.getElementById('pieChartSection').style.display = 'block';
                document.getElementById('pieChartTab').style.background = '#C8A968';
                document.getElementById('pieChartTab').style.color = 'white';
            } else if (tabName === 'consistency') {
                document.getElementById('consistencySection').style.display = 'block';
                document.getElementById('consistencyTab').style.background = '#C8A968';
                document.getElementById('consistencyTab').style.color = 'white';
            }
        }

        function printVisualization() {
            window.print();
        }

        // =========================
        // Phase 3: 협업 기능
        // =========================

        /**
         * 평가자 관리 콘텐츠 생성
         */
        function generateEvaluatorManagementContent() {
            // 평가자 관리 페이지 로드 시 초기화
            setTimeout(() => {
                setupEvaluatorManagement();
            }, 100);

            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">👥 평가자 관리</h2>
                            <div>
                                <button onclick="showAddEvaluatorModal()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-right: 1rem; font-weight: 600;">+ 평가자 초대</button>
                                <button onclick="exportEvaluatorList()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-right: 1rem;">📊 목록 내보내기</button>
                                <button onclick="completeEvaluatorManagement()" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600;">✅ 관리 완료 - 다음 단계</button>
                            </div>
                        </div>

                        <!-- 평가자 통계 카드 -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid #10b981;">
                                <div style="color: #10b981; font-size: 2rem; font-weight: bold;">12</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">활성 평가자</div>
                                <div style="color: #10b981; font-size: 0.9rem;">+3 지난주 대비</div>
                            </div>
                            <div style="background: #fef3f2; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid #f59e0b;">
                                <div style="color: #f59e0b; font-size: 2rem; font-weight: bold;">3</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">초대 대기중</div>
                                <div style="color: #666; font-size: 0.9rem;">2일 전 초대</div>
                            </div>
                            <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid #3b82f6;">
                                <div style="color: #3b82f6; font-size: 2rem; font-weight: bold;">87%</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">평균 완료율</div>
                                <div style="color: #10b981; font-size: 0.9rem;">+5% 상승</div>
                            </div>
                            <div style="background: #fdf4ff; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid #8b5cf6;">
                                <div style="color: #8b5cf6; font-size: 2rem; font-weight: bold;">2.3일</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">평균 응답시간</div>
                                <div style="color: #10b981; font-size: 0.9rem;">-0.5일 개선</div>
                            </div>
                        </div>

                        <!-- 검색 및 필터 -->
                        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <div style="display: grid; grid-template-columns: 1fr auto auto auto; gap: 1rem; align-items: center;">
                                <div>
                                    <input type="text" id="evaluatorSearch" placeholder="평가자 이름, 이메일로 검색..." style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; 
                                        font-size: 0.9rem; background: white;
                                    " oninput="filterEvaluators()">
                                </div>
                                <select id="statusFilter" onchange="filterEvaluators()" style="
                                    padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; 
                                    background: white; font-size: 0.9rem;
                                ">
                                    <option value="">모든 상태</option>
                                    <option value="active">활성</option>
                                    <option value="pending">대기중</option>
                                    <option value="completed">완료</option>
                                    <option value="inactive">비활성</option>
                                </select>
                                <select id="roleFilter" onchange="filterEvaluators()" style="
                                    padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; 
                                    background: white; font-size: 0.9rem;
                                ">
                                    <option value="">모든 역할</option>
                                    <option value="senior">선임 평가자</option>
                                    <option value="expert">전문 평가자</option>
                                    <option value="evaluator">일반 평가자</option>
                                </select>
                                <button onclick="resetFilters()" style="
                                    padding: 0.75rem 1rem; background: #6b7280; color: white; 
                                    border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;
                                ">초기화</button>
                            </div>
                        </div>

                        <!-- 평가자 목록 테이블 -->
                        <div style="background: white; border-radius: 8px; border: 1px solid #e5e7eb; overflow: hidden;">
                            <div style="background: #f9fafb; padding: 1rem; border-bottom: 1px solid #e5e7eb; font-weight: 600; color: #374151;">
                                <div style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1fr 1fr 1fr auto; gap: 1rem; align-items: center;">
                                    <div>평가자 정보</div>
                                    <div>연락처</div>
                                    <div>역할</div>
                                    <div>상태</div>
                                    <div>진행률</div>
                                    <div>마지막 활동</div>
                                    <div>액션</div>
                                </div>
                            </div>
                            <div id="evaluatorList">
                                <!-- 평가자 목록이 여기에 로드됩니다 -->
                            </div>
                        </div>

                        <!-- 대량 작업 도구 -->
                        <div style="margin-top: 2rem; padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: between; align-items: center;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                        <input type="checkbox" id="selectAllEvaluators" onchange="toggleAllEvaluators()">
                                        <span>전체 선택</span>
                                    </label>
                                </div>
                                <div style="display: flex; gap: 1rem; margin-left: auto;">
                                    <button onclick="sendBulkReminder()" style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📧 리마인더 발송</button>
                                    <button onclick="bulkStatusUpdate()" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📊 상태 업데이트</button>
                                    <button onclick="exportSelectedEvaluators()" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📤 선택 내보내기</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 평가자 초대 모달 -->
                    <div id="addEvaluatorModal" style="
                        display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                        background: rgba(0,0,0,0.5); z-index: 9999; 
                        align-items: center; justify-content: center;
                    ">
                        <div style="
                            background: white; padding: 2rem; border-radius: 12px; 
                            max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
                        ">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                <h3 style="color: #1f2937; margin: 0;">평가자 초대하기</h3>
                                <button onclick="hideAddEvaluatorModal()" style="
                                    background: none; border: none; font-size: 1.5rem; 
                                    cursor: pointer; color: #6b7280;
                                ">×</button>
                            </div>

                            <form id="addEvaluatorForm" style="space-y: 1rem;">
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">이름 *</label>
                                    <input type="text" id="evaluatorName" required style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; 
                                        border-radius: 6px; font-size: 1rem;
                                    " placeholder="평가자 이름을 입력하세요">
                                </div>

                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">이메일 *</label>
                                    <input type="email" id="evaluatorEmail" required style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; 
                                        border-radius: 6px; font-size: 1rem;
                                    " placeholder="평가자 이메일을 입력하세요">
                                </div>

                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">역할</label>
                                    <select id="evaluatorRole" style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; 
                                        border-radius: 6px; font-size: 1rem; background: white;
                                    ">
                                        <option value="evaluator">일반 평가자</option>
                                        <option value="expert">전문 평가자</option>
                                        <option value="senior">선임 평가자</option>
                                    </select>
                                </div>

                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">소속</label>
                                    <input type="text" id="evaluatorOrganization" style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; 
                                        border-radius: 6px; font-size: 1rem;
                                    " placeholder="소속 기관이나 부서 (선택사항)">
                                </div>

                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">할당 프로젝트</label>
                                    <select id="assignedProjects" multiple style="
                                        width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; 
                                        border-radius: 6px; font-size: 1rem; background: white; min-height: 80px;
                                    ">
                                        <option value="project1">공급업체 선정 프로젝트</option>
                                        <option value="project2">마케팅 전략 평가</option>
                                        <option value="project3">신제품 개발 우선순위</option>
                                    </select>
                                    <div style="color: #6b7280; font-size: 0.8rem; margin-top: 0.5rem;">Ctrl/Cmd 키를 누른 채 여러 프로젝트 선택 가능</div>
                                </div>

                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                        <input type="checkbox" id="sendInviteEmail" checked>
                                        <span>초대 이메일 즉시 발송</span>
                                    </label>
                                </div>

                                <div style="display: flex; justify-content: end; gap: 1rem;">
                                    <button type="button" onclick="hideAddEvaluatorModal()" style="
                                        padding: 0.75rem 1.5rem; background: #6b7280; color: white; 
                                        border: none; border-radius: 6px; cursor: pointer;
                                    ">취소</button>
                                    <button type="submit" style="
                                        padding: 0.75rem 1.5rem; background: #10b981; color: white; 
                                        border: none; border-radius: 6px; cursor: pointer; font-weight: 600;
                                    ">평가자 초대</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }

        // 콘텐츠 생성 함수들
        function generateMyProjectsContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h2 style="color: #C8A968; margin: 0; margin-bottom: 0.5rem;">📋 내 프로젝트</h2>
                                <p style="color: #6b7280; margin: 0; font-size: 0.875rem;">프로젝트를 선택하여 AHP 분석을 시작하세요</p>
                            </div>
                            <div>
                                <button onclick="handleMenuClick('new-project', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; margin-right: 0.5rem; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#B59A4D'" onmouseout="this.style.background='#C8A968'">➕ 새 프로젝트</button>
                                <button onclick="loadProjectsFromAPI()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;" onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">🔄 새로고침</button>
                            </div>
                        </div>
                        
                        <!-- 프로젝트 목록 컨테이너 -->
                        <div id="projectsContainer">
                            <div id="loadingState" style="text-align: center; padding: 4rem; color: #6b7280;">
                                <div style="display: inline-flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                                    <div style="width: 32px; height: 32px; border: 3px solid #e5e7eb; border-top: 3px solid #C8A968; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                </div>
                                <p style="margin: 0; font-size: 1rem;">프로젝트를 불러오는 중입니다...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 프로젝트 카드 스타일 추가 -->
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                    
                    .project-card {
                        border: 1px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 1.5rem;
                        background: #ffffff;
                        transition: all 0.2s ease;
                        cursor: pointer;
                        margin-bottom: 1rem;
                    }
                    
                    .project-card:hover {
                        background: #f9fafb;
                        border-color: #C8A968;
                        box-shadow: 0 4px 12px rgba(200, 169, 104, 0.15);
                        transform: translateY(-2px);
                    }
                    
                    .project-status-badge {
                        display: inline-block;
                        padding: 0.25rem 0.75rem;
                        border-radius: 9999px;
                        font-size: 0.75rem;
                        font-weight: 500;
                        text-transform: uppercase;
                        letter-spacing: 0.025em;
                    }
                    
                    .status-draft {
                        background: #f3f4f6;
                        color: #374151;
                    }
                    
                    .status-active {
                        background: #dbeafe;
                        color: #1e40af;
                    }
                    
                    .status-completed {
                        background: #dcfce7;
                        color: #166534;
                    }
                    
                    .project-meta {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 1rem;
                        margin: 1rem 0;
                    }
                    
                    @media (min-width: 768px) {
                        .project-meta {
                            grid-template-columns: repeat(4, 1fr);
                        }
                    }
                    
                    .meta-item {
                        text-align: left;
                    }
                    
                    .meta-label {
                        font-size: 0.75rem;
                        color: #6b7280;
                        font-weight: 500;
                        display: block;
                        margin-bottom: 0.25rem;
                    }
                    
                    .meta-value {
                        font-size: 0.875rem;
                        color: #1f2937;
                        font-weight: 600;
                    }
                </style>
            `;
        }

        function generateNewProjectContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">➕ 새 프로젝트</h2>
                            <button onclick="handleMenuClick('my-projects', null)" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">← 프로젝트 목록</button>
                        </div>
                        
                        <form id="newProjectForm" style="max-width: 700px;">
                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937;">프로젝트 이름 *</label>
                                <input type="text" id="projectName" required style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;" placeholder="예: 신제품 개발 우선순위 분석" onFocus="this.style.borderColor='#C8A968'" onBlur="this.style.borderColor='#d1d5db'">
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937;">목표/목적 *</label>
                                <textarea id="projectGoal" required style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; min-height: 80px; font-size: 1rem; transition: border-color 0.2s;" placeholder="이 AHP 분석을 통해 달성하고자 하는 목표를 명확히 기술하세요" onFocus="this.style.borderColor='#C8A968'" onBlur="this.style.borderColor='#d1d5db'"></textarea>
                            </div>
                            
                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937;">상세 설명</label>
                                <textarea id="projectDescription" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; min-height: 120px; font-size: 1rem; transition: border-color 0.2s;" placeholder="프로젝트 배경, 범위, 고려사항 등을 자세히 설명하세요" onFocus="this.style.borderColor='#C8A968'" onBlur="this.style.borderColor='#d1d5db'"></textarea>
                            </div>
                            
                            <!-- 평가방식 선택 섹션 -->
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 500; color: #1f2937; font-size: 1.1rem;">평가방식 선택 *</label>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    
                                    <!-- 쌍대비교 옵션 -->
                                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.2s;" onclick="selectEvaluationMethod('pairwise', this)" onmouseover="if(!this.classList.contains('selected')) this.style.borderColor='#C8A968'" onmouseout="if(!this.classList.contains('selected')) this.style.borderColor='#e5e7eb'">
                                        <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                            <input type="radio" name="evaluationMethod" value="pairwise" id="pairwise" style="margin-right: 1rem; transform: scale(1.2);" checked>
                                            <div style="font-size: 1.5rem; margin-right: 0.75rem;">⚖️</div>
                                            <h4 style="margin: 0; color: #1f2937; font-size: 1.1rem;">쌍대비교</h4>
                                        </div>
                                        <p style="margin: 0; color: #6b7280; font-size: 0.9rem; line-height: 1.4;">두 요소를 비교하여 평가하는 AHP의 전통적 방식입니다. 정성적 판단이 중요한 경우에 적합합니다.</p>
                                        <div style="margin-top: 0.75rem; font-size: 0.8rem; color: #9ca3af;">
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; margin-right: 0.5rem;">기본 추천</span>
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px;">정성적 평가</span>
                                        </div>
                                    </div>
                                    
                                    <!-- 직접입력 옵션 -->
                                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.2s;" onclick="selectEvaluationMethod('direct', this)" onmouseover="if(!this.classList.contains('selected')) this.style.borderColor='#C8A968'" onmouseout="if(!this.classList.contains('selected')) this.style.borderColor='#e5e7eb'">
                                        <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                            <input type="radio" name="evaluationMethod" value="direct" id="direct" style="margin-right: 1rem; transform: scale(1.2);">
                                            <div style="font-size: 1.5rem; margin-right: 0.75rem;">📝</div>
                                            <h4 style="margin: 0; color: #1f2937; font-size: 1.1rem;">직접입력</h4>
                                        </div>
                                        <p style="margin: 0; color: #6b7280; font-size: 0.9rem; line-height: 1.4;">직접 점수를 입력하여 평가하는 방식입니다. 명확한 수치 기준이 있는 경우에 적합합니다.</p>
                                        <div style="margin-top: 0.75rem; font-size: 0.8rem; color: #9ca3af;">
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; margin-right: 0.5rem;">빠른 평가</span>
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px;">정량적 평가</span>
                                        </div>
                                    </div>
                                    
                                    <!-- 실무형 옵션 -->
                                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.2s;" onclick="selectEvaluationMethod('practical', this)" onmouseover="if(!this.classList.contains('selected')) this.style.borderColor='#C8A968'" onmouseout="if(!this.classList.contains('selected')) this.style.borderColor='#e5e7eb'">
                                        <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                            <input type="radio" name="evaluationMethod" value="practical" id="practical" style="margin-right: 1rem; transform: scale(1.2);">
                                            <div style="font-size: 1.5rem; margin-right: 0.75rem;">📈</div>
                                            <h4 style="margin: 0; color: #1f2937; font-size: 1.1rem;">실무형</h4>
                                        </div>
                                        <p style="margin: 0; color: #6b7280; font-size: 0.9rem; line-height: 1.4;">실무 중심의 평가 방식으로 쌍대비교와 직접입력을 혼합한 하이브리드 방식입니다.</p>
                                        <div style="margin-top: 0.75rem; font-size: 0.8rem; color: #9ca3af;">
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; margin-right: 0.5rem;">하이브리드</span>
                                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px;">실무 최적화</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937;">프로젝트 유형</label>
                                    <select id="projectCategory" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;" onFocus="this.style.borderColor='#C8A968'" onBlur="this.style.borderColor='#d1d5db'">
                                        <option value="general">일반 AHP 분석</option>
                                        <option value="supplier">공급업체 선정</option>
                                        <option value="investment">투자 우선순위</option>
                                        <option value="product">제품 개발</option>
                                        <option value="strategy">전략 수립</option>
                                        <option value="location">입지 선정</option>
                                        <option value="hr">인사 관리</option>
                                        <option value="other">기타</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #1f2937;">우선순위</label>
                                    <select id="projectPriority" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;" onFocus="this.style.borderColor='#C8A968'" onBlur="this.style.borderColor='#d1d5db'">
                                        <option value="high">높음</option>
                                        <option value="medium" selected>보통</option>
                                        <option value="low">낮음</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 1rem; color: #1f2937;">💡 프로젝트 생성 후 단계</h4>
                                <ol style="margin-left: 1.5rem; color: #6b7280; line-height: 1.6;">
                                    <li>평가 기준 설정 (3-7개 권장)</li>
                                    <li>대안 정의 (2-10개 권장)</li>
                                    <li>평가자 초대 및 권한 설정</li>
                                    <li>쌍대비교 매트릭스 완성</li>
                                    <li>일관성 검증 및 결과 분석</li>
                                </ol>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button type="button" onclick="console.log('🚀 프로젝트 생성 버튼 클릭!'); createNewProject();" style="flex: 1; padding: 1rem 2rem; background: #C8A968; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onMouseOver="this.style.background='#B59A4D'" onMouseOut="this.style.background='#C8A968'">🚀 프로젝트 생성</button>
                                <button type="button" onclick="console.log('🧪 직접 테스트 버튼 클릭!'); testDirectProjectCreation();" style="flex: 1; padding: 1rem 2rem; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;">🧪 직접 테스트</button>
                                <button type="button" onclick="handleMenuClick('my-projects', null)" style="flex: 1; padding: 1rem 2rem; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s;" onMouseOver="this.style.background='#4b5563'" onMouseOut="this.style.background='#6b7280'">취소</button>
                            </div>
                        </form>
                        
                        <div id="createProjectMessage" style="margin-top: 1rem;"></div>
                    </div>
                </div>
            `;
        }

        function generateCriteriaManagementContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">⚖️ 기준 설정</h2>
                            <div>
                                <button onclick="showAddCriteriaModal()" style="background: #C8A968; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; margin-right: 0.5rem;">➕ 기준 추가</button>
                                <button onclick="handleMenuClick('pairwise-comparison', null)" style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">▶️ 쌍대비교</button>
                            </div>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <span style="font-size: 1.2rem;">💡</span>
                                <h4 style="margin: 0; color: #1f2937;">기준 설정 가이드라인</h4>
                            </div>
                            <ul style="color: #666; line-height: 1.6; margin-left: 1rem;">
                                <li>평가 기준은 3-7개가 적절합니다 (너무 많으면 복잡성 증가)</li>
                                <li>각 기준은 명확하고 측정 가능해야 합니다</li>
                                <li>기준들 간에는 상호 독립적이어야 합니다</li>
                                <li>모든 기준이 목표 달성에 기여해야 합니다</li>
                            </ul>
                        </div>
                        
                        <div id="criteriaContainer">
                            <!-- 기준 목록이 여기에 동적으로 로딩됩니다 -->
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                기준 정보를 불러오는 중...
                            </div>
                        </div>
                        
                        <!-- 기준 추가 모달 (숨김) -->
                        <div id="addCriteriaModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
                            <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                    <h3 style="margin: 0; color: #1f2937;">새 평가 기준 추가</h3>
                                    <button onclick="hideAddCriteriaModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
                                </div>
                                
                                <form id="addCriteriaForm">
                                    <div style="margin-bottom: 1.5rem;">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">기준명 *</label>
                                        <input type="text" id="criteriaName" required style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px;" placeholder="예: 비용 효율성">
                                    </div>
                                    
                                    <div style="margin-bottom: 1.5rem;">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">상세 설명</label>
                                        <textarea id="criteriaDescription" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px; min-height: 100px;" placeholder="이 기준이 무엇을 평가하는지 구체적으로 설명하세요"></textarea>
                                    </div>
                                    
                                    <div style="margin-bottom: 1.5rem;">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">가중치 (선택)</label>
                                        <select id="criteriaWeight" style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 8px;">
                                            <option value="normal">보통</option>
                                            <option value="high">높음</option>
                                            <option value="low">낮음</option>
                                        </select>
                                        <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">최종 가중치는 쌍대비교를 통해 결정됩니다</p>
                                    </div>
                                    
                                    <div style="display: flex; gap: 1rem;">
                                        <button type="submit" style="flex: 1; background: #C8A968; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">추가</button>
                                        <button type="button" onclick="hideAddCriteriaModal()" style="flex: 1; background: #6b7280; color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">취소</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePairwiseComparisonContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">⚡ 쌍대비교</h2>
                            <div>
                                <button onclick="resetPairwiseComparison()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; margin-right: 0.5rem;">🔄 초기화</button>
                                <button onclick="handleMenuClick('results-analysis', null)" style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">📈 결과 보기</button>
                            </div>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <span style="font-size: 1.2rem;">📚</span>
                                <h4 style="margin: 0; color: #1f2937;">AHP 쌍대비교 척도</h4>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; font-size: 0.85rem;">
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>1</strong><br>동등함</div>
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>3</strong><br>약간 중요</div>
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>5</strong><br>중요함</div>
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>7</strong><br>매우 중요</div>
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>9</strong><br>절대 중요</div>
                                <div style="background: white; padding: 0.5rem; border-radius: 4px; text-align: center;"><strong>2,4,6,8</strong><br>중간값</div>
                            </div>
                        </div>
                        
                        <div id="pairwiseContainer">
                            <!-- 쌍대비교 인터페이스가 여기에 동적으로 로딩됩니다 -->
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                쌍대비교 데이터를 불러오는 중...
                            </div>
                        </div>
                        
                        <!-- 진행률 표시 -->
                        <div id="comparisonProgress" style="margin-top: 2rem; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6; display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-weight: 500;">전체 진행률</span>
                                <span id="progressText">0/0 완료</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                                <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #1d4ed8); border-radius: 4px; width: 0%; transition: width 0.5s ease;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateResultsAnalysisContent() {
            // 실제 AHP 계산 결과 가져오기
            const ahpResult = window.currentAHPResult;
            
            if (!ahpResult) {
                // 데이터가 없는 경우 분석 실행 안내
                return `
                    <div style="padding: 2rem;">
                        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h2 style="color: #C8A968; margin-bottom: 2rem;">📈 결과 분석</h2>
                            
                            <div style="text-align: center; padding: 3rem; background: #fef3f2; border-radius: 12px; border: 2px solid #fca5a5;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">⚠️</div>
                                <h3 style="margin-bottom: 1rem; color: #dc2626;">분석을 위한 데이터가 부족합니다</h3>
                                <p style="margin-bottom: 2rem; color: #991b1b;">
                                    AHP 분석을 수행하려면 다음 단계를 완료해주세요:
                                </p>
                                <div style="text-align: left; max-width: 400px; margin: 0 auto 2rem;">
                                    <div style="margin-bottom: 0.5rem;">✓ 프로젝트 생성</div>
                                    <div style="margin-bottom: 0.5rem;">✓ 기준 설정 (최소 2개 이상)</div>
                                    <div style="margin-bottom: 0.5rem;">✓ 쌍대비교 수행</div>
                                </div>
                                
                                <div style="display: flex; justify-content: center; gap: 1rem;">
                                    <button onclick="handleMenuClick('hierarchy-design', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">기준 설정하기</button>
                                    <button onclick="handleMenuClick('pairwise-comparison', null)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">쌍대비교하기</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 실제 계산 결과 표시
            const { consistency, results, completionRate } = ahpResult;
            const criteriaCount = results.length;
            
            // 일관성 상태 및 색상 결정
            const consistencyColor = consistency.isConsistent ? '#10b981' : '#dc2626';
            const consistencyStatus = consistency.isConsistent ? '양호' : '불량';
            const consistencyIcon = consistency.isConsistent ? '✅' : '⚠️';
            
            // 완료율 색상 결정
            const completionColor = completionRate >= 100 ? '#10b981' : completionRate >= 80 ? '#f59e0b' : '#dc2626';

            // 우선순위 결과 HTML 생성
            const priorityResultsHtml = results.map(result => {
                const percentage = (result.priority * 100).toFixed(1);
                const barWidth = Math.max(percentage, 5); // 최소 5% 너비 보장
                
                return `
                    <div style="margin-bottom: 1rem; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600; color: #1f2937;">
                                ${result.rank}. ${result.criterion.name}
                            </span>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="color: #C8A968; font-weight: bold; font-size: 1.1rem;">
                                    ${result.priority.toFixed(3)} (${percentage}%)
                                </span>
                            </div>
                        </div>
                        <div style="background: #f3f4f6; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #C8A968, #A98C4B); height: 100%; width: ${barWidth}%; transition: width 0.5s ease;"></div>
                        </div>
                        ${result.criterion.description ? `<div style="color: #6b7280; font-size: 0.9rem; margin-top: 0.5rem;">${result.criterion.description}</div>` : ''}
                    </div>
                `;
            }).join('');

            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">📈 AHP 분석 결과</h2>
                            <button onclick="recalculateResults()" style="background: #6b7280; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">🔄 재계산</button>
                        </div>
                        
                        <!-- 주요 지표 카드들 -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; text-align: center; border: 2px solid ${consistency.cr <= 0.05 ? '#10b981' : consistency.cr <= 0.1 ? '#f59e0b' : '#dc2626'};">
                                <div style="color: ${consistencyColor}; font-size: 1.8rem; font-weight: bold;">${consistency.cr.toFixed(3)}</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">일관성 비율 (CR)</div>
                                <div style="color: ${consistencyColor}; font-size: 0.9rem; font-weight: 600;">
                                    ${consistencyIcon} ${consistencyStatus}
                                    ${consistency.cr <= 0.1 ? '' : ' (검토 필요)'}
                                </div>
                            </div>
                            <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="color: ${completionColor}; font-size: 1.8rem; font-weight: bold;">${completionRate}%</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">비교 완료율</div>
                                <div style="color: #666; font-size: 0.9rem;">${ahpResult.completedComparisons}/${ahpResult.totalComparisons} 완료</div>
                            </div>
                            <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="color: #3b82f6; font-size: 1.8rem; font-weight: bold;">${criteriaCount}</div>
                                <div style="color: #666; margin-bottom: 0.5rem;">평가 기준</div>
                                <div style="color: #666; font-size: 0.9rem;">총 ${Math.floor(criteriaCount * (criteriaCount - 1) / 2)}개 비교</div>
                            </div>
                        </div>
                        
                        <!-- 우선순위 결과 -->
                        <div style="background: #f9fafb; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3 style="margin: 0; color: #1f2937;">🏆 최종 우선순위</h3>
                                <div style="color: #666; font-size: 0.9rem;">
                                    총합: ${results.reduce((sum, r) => sum + r.priority, 0).toFixed(3)} 
                                    (기하평균법 사용)
                                </div>
                            </div>
                            ${priorityResultsHtml}
                        </div>

                        <!-- 일관성 분석 상세 -->
                        <div style="background: #f9fafb; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1.5rem; color: #1f2937;">🎯 일관성 분석 상세</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.9rem;">최대 고유값 (λmax)</div>
                                    <div style="font-weight: bold; color: #1f2937;">${consistency.lambdaMax.toFixed(4)}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.9rem;">일관성 지수 (CI)</div>
                                    <div style="font-weight: bold; color: #1f2937;">${consistency.ci.toFixed(4)}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.9rem;">무작위 지수 (RI)</div>
                                    <div style="font-weight: bold; color: #1f2937;">${ahpCalculator.randomIndex[criteriaCount] || 1.49}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.9rem;">일관성 비율 (CR)</div>
                                    <div style="font-weight: bold; color: ${consistencyColor};">${consistency.cr.toFixed(4)}</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1.5rem; padding: 1rem; background: ${consistency.isConsistent ? '#f0fdf4' : '#fef2f2'}; border-radius: 6px; border: 1px solid ${consistency.isConsistent ? '#10b981' : '#dc2626'};">
                                <div style="color: ${consistencyColor}; font-weight: 600; margin-bottom: 0.5rem;">
                                    ${consistency.isConsistent ? '✅ 일관성 검증 통과' : '⚠️ 일관성 검토 필요'}
                                </div>
                                <div style="color: #666; font-size: 0.9rem;">
                                    ${consistency.isConsistent 
                                        ? 'CR ≤ 0.1 기준을 만족하여 결과를 신뢰할 수 있습니다.' 
                                        : 'CR > 0.1로 쌍대비교를 재검토하여 일관성을 개선하는 것이 좋습니다.'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- 액션 버튼들 -->
                        <div style="text-align: center;">
                            <button onclick="downloadAHPReport()" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-right: 1rem; font-weight: 600;">📄 분석 보고서 다운로드</button>
                            <button onclick="handleMenuClick('sensitivity-analysis', null)" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-right: 1rem;">📊 민감도 분석</button>
                            ${!consistency.isConsistent ? 
                                '<button onclick="handleMenuClick(\'pairwise-comparison\', null)" style="background: #dc2626; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">🔄 쌍대비교 재검토</button>' : 
                                '<button onclick="generateVisualization()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">📈 시각화</button>'
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function generateComingSoonContent(title, contentType) {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 4rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 2rem;">🚧</div>
                        <h2 style="color: #C8A968; margin-bottom: 1rem;">${title}</h2>
                        <p style="color: #666; margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                            이 기능은 현재 개발 중입니다. 곧 사용할 수 있도록 준비하고 있습니다.
                        </p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button onclick="handleMenuClick('my-projects', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">내 프로젝트로</button>
                            <button onclick="window.location.reload()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">대시보드로</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showErrorContent(contentType, error) {
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="background: white; padding: 4rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 2rem;">⚠️</div>
                            <h2 style="color: #dc2626; margin-bottom: 1rem;">오류 발생</h2>
                            <p style="color: #666; margin-bottom: 2rem;">${contentType} 페이지를 로드하는 중 오류가 발생했습니다.</p>
                            <p style="color: #999; font-size: 0.9rem; margin-bottom: 2rem;">${error.message}</p>
                            <div style="display: flex; gap: 1rem; justify-content: center;">
                                <button onclick="window.location.reload()" style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">페이지 새로고침</button>
                                <button onclick="handleMenuClick('my-projects', null)" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">내 프로젝트로</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // =========================
        // Phase 3: 평가자 관리 시스템 JavaScript 함수들
        // =========================

        /**
         * 평가자 관리 인터페이스 초기화
         */
        function setupEvaluatorManagement() {
            console.log('🎯 평가자 관리 시스템 초기화');
            
            // 평가자 목록 로드
            loadEvaluatorList();
            
            // 검색 및 필터 이벤트 설정
            const searchInput = document.getElementById('evaluatorSearch');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(filterEvaluators, 300));
            }
            
            const statusFilterElement = document.getElementById('statusFilter');
            if (statusFilterElement) {
                statusFilterElement.addEventListener('change', filterEvaluators);
            }
        }

        /**
         * 평가자 추가 모달 표시
         */
        function showAddEvaluatorModal() {
            const modal = document.getElementById('addEvaluatorModal');
            if (modal) {
                modal.style.display = 'flex';
                
                // 모달 외부 클릭 시 닫기
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        hideAddEvaluatorModal();
                    }
                });
                
                // ESC 키로 모달 닫기
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        hideAddEvaluatorModal();
                    }
                });
                
                console.log('✨ 평가자 추가 모달 표시됨');
            }
        }

        /**
         * 평가자 추가 모달 숨기기
         */
        function hideAddEvaluatorModal() {
            const modal = document.getElementById('addEvaluatorModal');
            if (modal) {
                modal.style.display = 'none';
                
                // 폼 리셋
                const form = document.getElementById('addEvaluatorForm');
                if (form) {
                    form.reset();
                }
                
                console.log('❌ 평가자 추가 모달 숨겨짐');
            }
        }

        /**
         * 평가자 검색 및 필터링
         */
        function filterEvaluators() {
            const searchInput = document.getElementById('evaluatorSearch');
            const statusFilterElement = document.getElementById('statusFilter');
            const evaluatorRows = document.querySelectorAll('#evaluatorTableBody tr');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const statusFilterValue = statusFilterElement ? statusFilterElement.value : '';
            
            let visibleCount = 0;
            
            evaluatorRows.forEach(row => {
                const name = row.cells[0] ? row.cells[0].textContent.toLowerCase() : '';
                const email = row.cells[1] ? row.cells[1].textContent.toLowerCase() : '';
                const status = row.cells[2] ? row.cells[2].textContent : '';
                
                const matchesSearch = !searchTerm || name.includes(searchTerm) || email.includes(searchTerm);
                const matchesStatus = !statusFilterValue || status.includes(statusFilterValue);
                
                if (matchesSearch && matchesStatus) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // 검색 결과가 없는 경우 메시지 표시
            updateEvaluatorTableEmptyState(visibleCount === 0);
            
            console.log(`🔍 평가자 필터링 완료: ${visibleCount}개 결과`);
        }

        /**
         * 평가자 목록 로드
         */
        async function loadEvaluatorList() {
            console.log('📋 평가자 목록 로딩 시작');
            
            try {
                // Django API를 통해 실제 평가자 데이터 조회
                const result = await window.ahpApi.getEvaluators();
                
                if (!result.success) {
                    console.error('❌ 평가자 목록 조회 실패:', result.message);
                    updateEvaluatorTableEmptyState(true);
                    return;
                }
                
                const evaluators = result.data || [];
                
                // 테이블에 평가자 데이터 추가
                const tableBody = document.getElementById('evaluatorTableBody');
                if (tableBody) {
                    if (evaluators.length === 0) {
                        updateEvaluatorTableEmptyState(true);
                    } else {
                        tableBody.innerHTML = evaluators.map(evaluator => `
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 1rem; font-weight: 500;">${evaluator.name || evaluator.evaluator_name || '-'}</td>
                                <td style="padding: 1rem; color: #6b7280;">${evaluator.email || evaluator.evaluator_email || '-'}</td>
                                <td style="padding: 1rem;">
                                    <span class="status-badge ${evaluator.status || 'pending'}" style="
                                        padding: 0.25rem 0.75rem; 
                                        border-radius: 12px; 
                                        font-size: 0.8rem; 
                                        font-weight: 500;
                                        background: ${evaluator.status === 'active' ? '#dcfce7' : '#fef3c7'};
                                        color: ${evaluator.status === 'active' ? '#166534' : '#92400e'};
                                    ">
                                        ${evaluator.status === 'active' ? '활성' : '대기중'}
                                    </span>
                                </td>
                                <td style="padding: 1rem; color: #6b7280;">${evaluator.role || 'Evaluator'}</td>
                                <td style="padding: 1rem; text-align: center;">${evaluator.projects_count || 0}</td>
                                <td style="padding: 1rem; text-align: center;">${evaluator.completion_rate || 0}%</td>
                                <td style="padding: 1rem; color: #6b7280;">${evaluator.last_activity ? new Date(evaluator.last_activity).toLocaleDateString() : '-'}</td>
                                <td style="padding: 1rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="editEvaluator(${evaluator.id})" style="
                                            background: #3b82f6; 
                                            color: white; 
                                            border: none; 
                                            padding: 0.25rem 0.5rem; 
                                            border-radius: 4px; 
                                            cursor: pointer; 
                                            font-size: 0.8rem;
                                        ">편집</button>
                                        <button onclick="removeEvaluator(${evaluator.id})" style="
                                            background: #ef4444; 
                                            color: white; 
                                            border: none; 
                                            padding: 0.25rem 0.5rem; 
                                            border-radius: 4px; 
                                            cursor: pointer; 
                                            font-size: 0.8rem;
                                        ">제거</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('');
                    }
                }
                
                // 통계 카드 업데이트
                updateEvaluatorStats(evaluators);
                
                console.log(`✅ 평가자 목록 로드 완료: ${evaluators.length}명`);
            } catch (error) {
                console.error('❌ 평가자 목록 로드 오류:', error);
                updateEvaluatorTableEmptyState(true);
            }
        }

        /**
         * 평가자 통계 업데이트
         */
        function updateEvaluatorStats(evaluators) {
            const activeEvaluators = evaluators.filter(e => e.status === 'active').length;
            const pendingInvites = evaluators.filter(e => e.status === 'pending').length;
            const avgCompletionRate = evaluators.length > 0 ? 
                evaluators.reduce((sum, e) => sum + (e.completion_rate || e.completionRate || 0), 0) / evaluators.length : 0;
            
            // 통계 카드 값 업데이트
            const statsElements = {
                'active-evaluators': activeEvaluators,
                'pending-invites': pendingInvites,
                'avg-completion-rate': Math.round(avgCompletionRate) + '%'
            };
            
            Object.entries(statsElements).forEach(([id, value]) => {
                const element = document.querySelector(`[data-stat="${id}"]`);
                if (element) {
                    element.textContent = value;
                }
            });
        }

        /**
         * 평가자 테이블 빈 상태 업데이트
         */
        function updateEvaluatorTableEmptyState(isEmpty) {
            const tableBody = document.getElementById('evaluatorTableBody');
            if (isEmpty && tableBody) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #6b7280;">
                            검색 조건에 맞는 평가자가 없습니다.
                        </td>
                    </tr>
                `;
            }
        }

        /**
         * 평가자 편집
         */
        function editEvaluator(evaluatorId) {
            console.log(`✏️ 평가자 편집: ID ${evaluatorId}`);
            alert(`평가자 편집 기능이 곧 추가될 예정입니다. (ID: ${evaluatorId})`);
        }

        /**
         * 평가자 제거
         */
        function removeEvaluator(evaluatorId) {
            if (confirm('이 평가자를 정말 제거하시겠습니까?')) {
                console.log(`🗑️ 평가자 제거: ID ${evaluatorId}`);
                // 실제 구현시 API 호출
                loadEvaluatorList(); // 목록 새로고침
            }
        }

        /**
         * 평가자 추가 폼 처리
         */
        function handleAddEvaluator(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            const evaluatorData = {
                name: formData.get('name'),
                email: formData.get('email'),
                role: formData.get('role'),
                message: formData.get('message')
            };
            
            console.log('👤 새 평가자 추가:', evaluatorData);
            
            // 실제 구현시 API 호출
            // await window.ahpApi.inviteEvaluator(evaluatorData);
            
            // 성공 메시지
            alert(`${evaluatorData.name}님께 초대 이메일을 발송했습니다.`);
            
            // 모달 닫기 및 목록 새로고침
            hideAddEvaluatorModal();
            loadEvaluatorList();
        }

        /**
         * 일괄 작업 처리
         */
        function handleBulkAction() {
            const action = document.getElementById('bulkActionSelect')?.value;
            const checkedBoxes = document.querySelectorAll('input[name="evaluatorSelect"]:checked');
            
            if (!action) {
                alert('작업을 선택해주세요.');
                return;
            }
            
            if (checkedBoxes.length === 0) {
                alert('대상 평가자를 선택해주세요.');
                return;
            }
            
            const selectedIds = Array.from(checkedBoxes).map(cb => cb.value);
            console.log(`🔄 일괄 작업 실행: ${action} for IDs: ${selectedIds}`);
            
            if (confirm(`선택된 ${checkedBoxes.length}명의 평가자에게 ${action} 작업을 수행하시겠습니까?`)) {
                // 실제 구현시 API 호출
                alert(`${action} 작업이 완료되었습니다.`);
                loadEvaluatorList();
            }
        }

        /**
         * 디바운스 함수 (검색 성능 최적화)
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // =========================
        // Phase 3: 협업 허브 및 진행 모니터링 콘텐츠 생성 함수들
        // =========================

        /**
         * 협업 허브 콘텐츠 생성
         */
        function generateCollaborationHubContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">🤝 협업 허브</h2>
                            <button onclick="refreshCollaborationData()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">🔄 새로고침</button>
                        </div>

                        <!-- 실시간 협업 현황 -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">⚡</div>
                                <h3 style="margin-bottom: 1rem;">실시간 협업 세션</h3>
                                <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">3</div>
                                <p style="opacity: 0.9;">진행중인 세션</p>
                            </div>
                            <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); color: #2d3436; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                                <h3 style="margin-bottom: 1rem;">동기화된 프로젝트</h3>
                                <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">8</div>
                                <p style="opacity: 0.8;">활성 프로젝트</p>
                            </div>
                        </div>

                        <!-- 최근 협업 활동 -->
                        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3 style="color: #1f2937; margin-bottom: 1rem;">📋 최근 협업 활동</h3>
                            <div id="recentCollaborationActivities">
                                <div style="display: flex; align-items: center; padding: 1rem; background: white; border-radius: 6px; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="width: 40px; height: 40px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                        👤
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500; margin-bottom: 0.25rem;">프로젝트 평가 완료</div>
                                        <div style="color: #6b7280; font-size: 0.9rem;">5분 전</div>
                                    </div>
                                    <div style="color: #10b981; font-weight: 500;">완료</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 1rem; background: white; border-radius: 6px; margin-bottom: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="width: 40px; height: 40px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                        💬
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500; margin-bottom: 0.25rem;">코멘트 추가</div>
                                        <div style="color: #6b7280; font-size: 0.9rem;">15분 전</div>
                                    </div>
                                    <div style="color: #3b82f6; font-weight: 500;">활성</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 1rem; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="width: 40px; height: 40px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                        ⚡
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500; margin-bottom: 0.25rem;">실시간 동기화 시작됨</div>
                                        <div style="color: #6b7280; font-size: 0.9rem;">30분 전</div>
                                    </div>
                                    <div style="color: #10b981; font-weight: 500;">진행중</div>
                                </div>
                            </div>
                        </div>

                        <!-- 협업 도구 -->
                        <div>
                            <h3 style="color: #1f2937; margin-bottom: 1rem;">🛠️ 협업 도구</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button onclick="startRealTimeSession()" style="background: #10b981; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: center;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🔴</div>
                                    <div style="font-weight: 600;">실시간 세션 시작</div>
                                </button>
                                <button onclick="syncAllProjects()" style="background: #3b82f6; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: center;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🔄</div>
                                    <div style="font-weight: 600;">프로젝트 동기화</div>
                                </button>
                                <button onclick="generateTeamReport()" style="background: #8b5cf6; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: center;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">📄</div>
                                    <div style="font-weight: 600;">팀 리포트</div>
                                </button>
                                <button onclick="managePermissions()" style="background: #ef4444; color: white; border: none; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: center;">
                                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">🔐</div>
                                    <div style="font-weight: 600;">권한 관리</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 진행 모니터링 콘텐츠 생성
         */
        function generateProgressMonitoringContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">📈 진행 모니터링</h2>
                            <div>
                                <select style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; margin-right: 1rem;">
                                    <option value="7days">최근 7일</option>
                                    <option value="30days">최근 30일</option>
                                    <option value="90days">최근 90일</option>
                                </select>
                                <button onclick="exportProgressReport()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">📊 리포트 내보내기</button>
                            </div>
                        </div>

                        <!-- 전체 진행 상황 대시보드 -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">78%</div>
                                <div style="opacity: 0.9; margin-bottom: 1rem;">전체 완료율</div>
                                <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: white; height: 100%; width: 78%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                            <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">15</div>
                                <div style="opacity: 0.9; margin-bottom: 1rem;">활성 프로젝트</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">+3 지난주 대비</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #2d3436; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">32</div>
                                <div style="opacity: 0.9; margin-bottom: 1rem;">참여 평가자</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">12개국에서 참여</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); color: #2d3436; padding: 2rem; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">94%</div>
                                <div style="opacity: 0.9; margin-bottom: 1rem;">평균 일관성</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">우수한 품질</div>
                            </div>
                        </div>

                        <!-- 프로젝트별 진행 상황 -->
                        <div style="margin-bottom: 3rem;">
                            <h3 style="color: #1f2937; margin-bottom: 1.5rem;">📋 프로젝트별 진행 상황</h3>
                            <div style="background: #f8fafc; border-radius: 8px; overflow: hidden;">
                                <div style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 2fr; gap: 1rem; padding: 1rem; background: #e5e7eb; font-weight: 600; color: #374151;">
                                    <div>프로젝트명</div>
                                    <div style="text-align: center;">진행률</div>
                                    <div style="text-align: center;">평가자</div>
                                    <div style="text-align: center;">일관성</div>
                                    <div style="text-align: center;">상태</div>
                                </div>
                                <div style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 2fr; gap: 1rem; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                                    <div style="font-weight: 500;">신제품 개발 우선순위</div>
                                    <div style="text-align: center;">
                                        <div style="background: #dcfce7; color: #166534; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.9rem;">85%</div>
                                    </div>
                                    <div style="text-align: center;">8/10</div>
                                    <div style="text-align: center; color: #10b981;">0.08</div>
                                    <div style="text-align: center;">
                                        <span style="background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">진행중</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 2fr; gap: 1rem; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                                    <div style="font-weight: 500;">마케팅 전략 평가</div>
                                    <div style="text-align: center;">
                                        <div style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.9rem;">45%</div>
                                    </div>
                                    <div style="text-align: center;">5/12</div>
                                    <div style="text-align: center; color: #f59e0b;">0.12</div>
                                    <div style="text-align: center;">
                                        <span style="background: #f59e0b; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">대기</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 2fr; gap: 1rem; padding: 1rem;">
                                    <div style="font-weight: 500;">투자 포트폴리오 분석</div>
                                    <div style="text-align: center;">
                                        <div style="background: #dcfce7; color: #166534; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.9rem;">100%</div>
                                    </div>
                                    <div style="text-align: center;">15/15</div>
                                    <div style="text-align: center; color: #10b981;">0.05</div>
                                    <div style="text-align: center;">
                                        <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">완료</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 시간대별 활동 패턴 -->
                        <div>
                            <h3 style="color: #1f2937; margin-bottom: 1.5rem;">⏰ 시간대별 활동 패턴</h3>
                            <div style="background: #f8fafc; padding: 2rem; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <div style="font-size: 0.9rem; color: #6b7280;">가장 활발한 시간: 14:00 - 16:00</div>
                                    <div style="font-size: 0.9rem; color: #6b7280;">평균 평가 시간: 12분</div>
                                </div>
                                <div style="display: flex; align-items: end; gap: 0.25rem; height: 100px;">
                                    ${Array.from({length: 24}, (_, i) => {
                                        const height = Math.random() * 80 + 20;
                                        const isActive = i >= 9 && i <= 17;
                                        return `<div style="flex: 1; background: ${isActive ? '#3b82f6' : '#d1d5db'}; height: ${height}%; border-radius: 2px;" title="${i}:00"></div>`;
                                    }).join('')}
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem;">
                                    <span>0시</span>
                                    <span>6시</span>
                                    <span>12시</span>
                                    <span>18시</span>
                                    <span>24시</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 협업 및 모니터링 관련 유틸리티 함수들
        function refreshCollaborationData() {
            console.log('🔄 협업 데이터 새로고침');
            alert('협업 데이터를 새로고침했습니다.');
        }

        function startRealTimeSession() {
            console.log('🔴 실시간 세션 시작');
            alert('실시간 협업 세션을 시작합니다.');
        }

        function syncAllProjects() {
            console.log('🔄 모든 프로젝트 동기화');
            alert('모든 프로젝트를 동기화했습니다.');
        }

        function generateTeamReport() {
            console.log('📄 팀 리포트 생성');
            alert('팀 리포트를 생성했습니다.');
        }

        function managePermissions() {
            console.log('🔐 권한 관리');
            alert('권한 관리 페이지로 이동합니다.');
        }

        function exportProgressReport() {
            console.log('📊 진행 리포트 내보내기');
            alert('진행 리포트를 내보냈습니다.');
        }

        function exportEvaluatorList() {
            console.log('📊 평가자 목록 내보내기');
            alert('평가자 목록을 Excel 파일로 내보냈습니다.');
        }

        // 누락된 초기화 함수들 추가
        function setupCollaborationHub() {
            console.log('🤝 협업 허브 초기화');
            // 실제 구현시 실시간 데이터 로딩
        }

        function loadProgressData() {
            console.log('📈 진행 데이터 로딩');
            // 실제 구현시 API에서 진행 데이터 가져오기
        }

        function setupCriteriaManagement() {
            console.log('📝 기준 관리 초기화');
            // 기준 관리 폼 이벤트 리스너 설정
        }

        function setupPairwiseComparison() {
            console.log('⚖️ 쌍대비교 초기화');
            // 쌍대비교 인터페이스 초기화
        }

        function setupAlternativesManagement() {
            console.log('🎯 대안 관리 초기화');
            // 대안 관리 폼 이벤트 리스너 설정
        }

        // 누락된 콘텐츠 생성 함수들 추가
        function generateAlternativesManagementContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">🎯 대안 관리</h2>
                            <button onclick="addAlternative()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">+ 대안 추가</button>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🎯</div>
                            <h3 style="margin-bottom: 1rem;">대안 관리</h3>
                            <p style="color: #666; margin-bottom: 2rem;">평가할 대안들을 추가하고 관리하세요.</p>
                            <button onclick="addAlternative()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">첫 대안 추가하기</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTrashContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">🗑️ 휴지통</h2>
                            <button onclick="emptyTrash()" style="background: #ef4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">전체 삭제</button>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🗑️</div>
                            <h3 style="margin-bottom: 1rem;">휴지통이 비어있습니다</h3>
                            <p style="color: #666;">삭제된 프로젝트가 없습니다.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateReportGenerationContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">📄 보고서 생성</h2>
                            <button onclick="generateReport()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">보고서 생성</button>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📄</div>
                            <h3 style="margin-bottom: 1rem;">보고서 생성</h3>
                            <p style="color: #666; margin-bottom: 2rem;">AHP 분석 결과를 전문적인 보고서로 생성하세요.</p>
                            <button onclick="generateReport()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">보고서 생성하기</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSensitivityAnalysisContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">📊 민감도 분석</h2>
                            <button onclick="runSensitivityAnalysis()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">분석 실행</button>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                            <h3 style="margin-bottom: 1rem;">민감도 분석</h3>
                            <p style="color: #666; margin-bottom: 2rem;">기준 가중치 변화에 따른 결과 변동을 분석하세요.</p>
                            <button onclick="runSensitivityAnalysis()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">분석 시작하기</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePersonalSettingsContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0;">⚙️ 개인 설정</h2>
                            <button onclick="saveSettings()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">설정 저장</button>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px;">
                            <div style="margin-bottom: 2rem;">
                                <h3 style="margin-bottom: 1rem;">언어 설정</h3>
                                <select style="padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; width: 200px;">
                                    <option value="ko">한국어</option>
                                    <option value="en">English</option>
                                    <option value="ja">日本語</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <h3 style="margin-bottom: 1rem;">테마 설정</h3>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="theme" value="light" checked>
                                        <span>라이트 모드</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="theme" value="dark">
                                        <span>다크 모드</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="margin-bottom: 1rem;">알림 설정</h3>
                                <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>이메일 알림</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>푸시 알림</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePlanManagementContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h2 style="color: #C8A968; margin-bottom: 2rem;">💳 요금제 관리</h2>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">💳</div>
                            <h3 style="margin-bottom: 1rem;">현재 플랜: 기본 플랜</h3>
                            <p style="color: #666; margin-bottom: 2rem;">프로젝트 1개, 평가자 30명까지 이용 가능</p>
                            <button onclick="upgradePlan()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">플랜 업그레이드</button>
                        </div>
                    </div>
                </div>
            `;
        }


        function generateTeamComparisonContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h2 style="color: #C8A968; margin-bottom: 2rem;">👥 팀 비교 분석</h2>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">👥</div>
                            <h3 style="margin-bottom: 1rem;">팀 비교 분석</h3>
                            <p style="color: #666; margin-bottom: 2rem;">여러 평가자의 결과를 비교하고 합의점을 찾으세요.</p>
                            <button onclick="startTeamComparison()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">분석 시작하기</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateRealTimeSyncContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h2 style="color: #C8A968; margin-bottom: 2rem;">🔄 실시간 동기화</h2>
                        
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🔄</div>
                            <h3 style="margin-bottom: 1rem;">실시간 동기화</h3>
                            <p style="color: #666; margin-bottom: 2rem;">모든 평가자와 실시간으로 데이터를 동기화합니다.</p>
                            <button onclick="startRealTimeSync()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">동기화 시작</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // 유틸리티 함수들
        function addAlternative() {
            console.log('🎯 대안 추가');
            alert('대안 추가 기능이 곧 구현될 예정입니다.');
        }

        function emptyTrash() {
            console.log('🗑️ 휴지통 비우기');
            if (confirm('휴지통을 완전히 비우시겠습니까?')) {
                alert('휴지통이 비워졌습니다.');
            }
        }

        function generateReport() {
            console.log('📄 보고서 생성');
            alert('보고서를 생성했습니다.');
        }

        function runSensitivityAnalysis() {
            console.log('📊 민감도 분석 실행');
            alert('민감도 분석을 실행했습니다.');
        }

        function saveSettings() {
            console.log('⚙️ 설정 저장');
            alert('설정이 저장되었습니다.');
        }

        function upgradePlan() {
            console.log('💳 플랜 업그레이드');
            alert('플랜 업그레이드 페이지로 이동합니다.');
        }

        function startTeamComparison() {
            console.log('👥 팀 비교 분석 시작');
            alert('팀 비교 분석을 시작합니다.');
        }

        function startRealTimeSync() {
            console.log('🔄 실시간 동기화 시작');
            alert('실시간 동기화를 시작합니다.');
        }



        // showAuthError 함수도 GitHub Pages 경로에 맞게 수정
        // showAuthError 함수 제거됨 - 로그인 관련 기능 삭제
        

        // =========================
        // 대시보드 및 인구통계학적 설문조사 함수들
        // =========================

        /**
         * 모델구축 콘텐츠 생성
         */
        function generateModelBuildingContent() {
            return `
                <div style="padding: 2rem;">
                    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #C8A968; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">🏗️</span>
                                모델구축
                            </h2>
                            <div style="display: flex; gap: 1rem;">
                                <button onclick="createNewModel()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    + 새 모델 생성
                                </button>
                                <button onclick="loadModelTemplate()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    📋 템플릿 선택
                                </button>
                            </div>
                        </div>

                        <!-- 평가 방법 선택 -->
                        <div id="evaluation-mode-selector" style="margin-bottom: 2rem;">
                            <h3 style="color: #1f2937; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>⚙️</span>
                                평가 방법 선택
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                <div id="eval-method-pairwise" onclick="selectEvaluationMethod('pairwise')" 
                                     style="border: 2px solid #3b82f6; background: #eff6ff; padding: 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="width: 50px; height: 50px; background: #3b82f6; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">⚖️</div>
                                        <div style="flex: 1;">
                                            <h4 style="margin: 0; color: #1e40af;">쌍대비교</h4>
                                            <span style="font-size: 0.8rem; color: #3b82f6; background: #dbeafe; padding: 0.25rem 0.5rem; border-radius: 4px;">실용형/이론형</span>
                                        </div>
                                        <div style="color: #3b82f6; font-size: 1.5rem;">✓</div>
                                    </div>
                                    <p style="color: #1e40af; font-size: 0.9rem; margin: 0 0 1rem 0;">두 요소를 직접 비교하여 상대적 중요도를 평가합니다.</p>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="event.stopPropagation(); selectPairwiseMode('practical')" 
                                                style="background: #60a5fa; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">⚡ 실용형</button>
                                        <button onclick="event.stopPropagation(); selectPairwiseMode('theoretical')" 
                                                style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🎓 이론형</button>
                                    </div>
                                </div>
                                
                                <div id="eval-method-direct" onclick="selectEvaluationMethod('direct')" 
                                     style="border: 2px solid #e5e7eb; background: white; padding: 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="width: 50px; height: 50px; background: #10b981; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">📊</div>
                                        <div>
                                            <h4 style="margin: 0; color: #6b7280;">직접입력</h4>
                                            <span style="font-size: 0.8rem; color: #10b981; background: #dcfce7; padding: 0.25rem 0.5rem; border-radius: 4px;">정량형</span>
                                        </div>
                                    </div>
                                    <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">기존 데이터나 전문가 판단을 직접 입력하여 중요도를 설정합니다.</p>
                                </div>
                            </div>
                        </div>

                        <!-- 모델 빌더 탭 메뉴 -->
                        <div style="border-bottom: 2px solid #e5e7eb; margin-bottom: 2rem;">
                            <div style="display: flex; gap: 2rem;">
                                <button id="model-tab-criteria" onclick="switchModelTab('criteria')" 
                                        style="padding: 1rem 1.5rem; border: none; background: none; color: #3b82f6; border-bottom: 2px solid #3b82f6; font-weight: 600; cursor: pointer;">
                                    📊 평가 기준
                                </button>
                                <button id="model-tab-alternatives" onclick="switchModelTab('alternatives')" 
                                        style="padding: 1rem 1.5rem; border: none; background: none; color: #6b7280; border-bottom: 2px solid transparent; cursor: pointer;">
                                    🎯 대안
                                </button>
                                <button id="model-tab-evaluation" onclick="switchModelTab('evaluation')" 
                                        style="padding: 1rem 1.5rem; border: none; background: none; color: #6b7280; border-bottom: 2px solid transparent; cursor: pointer;">
                                    ⚖️ 평가 실행
                                </button>
                                <button id="model-tab-hierarchy" onclick="switchModelTab('hierarchy')" 
                                        style="padding: 1rem 1.5rem; border: none; background: none; color: #6b7280; border-bottom: 2px solid transparent; cursor: pointer;">
                                    🏗️ 계층구조
                                </button>
                                <button id="model-tab-settings" onclick="switchModelTab('settings')" 
                                        style="padding: 1rem 1.5rem; border: none; background: none; color: #6b7280; border-bottom: 2px solid transparent; cursor: pointer;">
                                    ⚙️ 설정
                                </button>
                            </div>
                        </div>

                        <!-- 탭 콘텐츠 영역 -->
                        <div id="model-tab-content">
                            <!-- 초기 콘텐츠는 setupModelBuilding에서 로드 -->
                        </div>

                        <!-- 모델 상태 요약 -->
                        <div style="margin-top: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #C8A968;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4 style="color: #1f2937; margin: 0;">📈 모델 상태</h4>
                                <button onclick="validateModel()" style="background: #8b5cf6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">
                                    ✅ 모델 검증
                                </button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;" id="criteria-count">0</div>
                                    <div style="font-size: 0.9rem; color: #6b7280;">평가 기준</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;" id="alternatives-count">0</div>
                                    <div style="font-size: 0.9rem; color: #6b7280;">대안</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;" id="model-completion">0%</div>
                                    <div style="font-size: 0.9rem; color: #6b7280;">완성도</div>
                                </div>
                                <div style="text-align: center; padding: 1rem; background: white; border-radius: 6px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #ef4444;" id="model-status">❌</div>
                                    <div style="font-size: 0.9rem; color: #6b7280;">검증 상태</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 대시보드 콘텐츠 생성
         */
        function generateDashboardContent() {
            return `
                <div class="dashboard-container">
                    <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h1 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 2rem;">🏠</span>
                            AHP 개인 서비스 대시보드
                        </h1>
                        <p style="color: #6b7280; margin-bottom: 2rem;">분석적 계층화 과정(AHP)을 통한 의사결정 지원 시스템입니다.</p>
                    </div>

                    <!-- 빠른 액션 -->
                    <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                        <h2 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span>⚡</span>
                            빠른 작업
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <button onclick="handleMenuClick('new-project', null)" 
                                    style="background: linear-gradient(135deg, #C8A968, #A98C4B); color: white; border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">➕</div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">새 프로젝트</div>
                                <div style="font-size: 0.875rem; opacity: 0.9;">새로운 AHP 분석 시작</div>
                            </button>
                            
                            <button onclick="handleMenuClick('my-projects', null)" 
                                    style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">📋</div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">내 프로젝트</div>
                                <div style="font-size: 0.875rem; opacity: 0.9;">진행 중인 프로젝트 보기</div>
                            </button>
                            
                            <button onclick="handleMenuClick('results-analysis', null)" 
                                    style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 1.5rem; border-radius: 8px; cursor: pointer; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">📈</div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">결과 분석</div>
                                <div style="font-size: 0.875rem; opacity: 0.9;">분석 결과 확인</div>
                            </button>
                        </div>
                    </div>

                    <!-- 대시보드 통계 -->
                    <div id="dashboardStats" style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h2 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span>📊</span>
                            프로젝트 현황
                        </h2>
                        <div style="text-align: center; color: #6b7280; padding: 2rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 1rem;">⏳</div>
                            <p>데이터를 불러오는 중...</p>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 대시보드 데이터 로드
         */
        // 프로젝트 목록 새로고침 함수
        async function refreshProjectList() {
            try {
                console.log('🔄 프로젝트 목록 새로고침 시작');
                
                // 캐시 무효화를 위해 타임스탬프 추가
                const timestamp = new Date().getTime();
                const result = await window.ahpApi.getProjects(`?_t=${timestamp}`);
                
                if (result.success && result.data) {
                    const projects = Array.isArray(result.data) ? result.data : (result.data.results || []);
                    console.log(`✅ 프로젝트 목록 새로고침 완료: ${projects.length}개 프로젝트`);
                    
                    // 대시보드가 현재 화면에 있다면 업데이트
                    const dashboardStats = document.getElementById('dashboardStats');
                    if (dashboardStats) {
                        await loadDashboardData();
                    }
                    
                    // 프로젝트 목록 화면이 현재 활성화되어 있다면 업데이트
                    const projectListContainer = document.querySelector('.projects-container');
                    if (projectListContainer) {
                        await loadProjectsContent();
                    }
                    
                    // "내 프로젝트" 메뉴가 활성화되어 있다면 다시 로드
                    const currentContent = document.querySelector('.main-content');
                    if (currentContent && currentContent.innerHTML.includes('내 프로젝트')) {
                        console.log('🔄 내 프로젝트 화면 새로고침');
                        handleMenuClick('my-projects', null);
                    }
                    
                    return result.data;
                } else {
                    console.log('⚠️ 프로젝트 목록 새로고침 실패:', result.message);
                    return [];
                }
            } catch (error) {
                console.error('❌ 프로젝트 목록 새로고침 오류:', error);
                return [];
            }
        }

        // 프로젝트 목록 콘텐츠 로드 함수 (간단한 구현)
        async function loadProjectsContent() {
            try {
                console.log('📋 프로젝트 목록 콘텐츠 새로고침');
                const result = await window.ahpApi.getProjects();
                
                if (result.success && result.data) {
                    const projects = Array.isArray(result.data) ? result.data : (result.data.results || []);
                    console.log(`✅ 프로젝트 목록 업데이트 완료: ${projects.length}개`);
                } else {
                    console.log('⚠️ 프로젝트 목록 업데이트 실패');
                }
            } catch (error) {
                console.error('❌ 프로젝트 목록 업데이트 오류:', error);
            }
        }

        async function loadDashboardData() {
            try {
                console.log('📊 대시보드 데이터 로딩 시작');
                const result = await window.ahpApi.getProjects();
                
                const statsContainer = document.getElementById('dashboardStats');
                if (!statsContainer) return;
                
                if (result.success && result.data) {
                    // API 응답 구조에 따라 올바른 배열 추출
                    const projects = Array.isArray(result.data) ? result.data : (result.data.results || []);
                    const totalProjects = projects.length;
                    const completedProjects = projects.filter(p => p.status === 'completed').length;
                    const activeProjects = projects.filter(p => p.status === 'active').length;
                    
                    statsContainer.innerHTML = `
                        <h2 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span>📊</span>
                            프로젝트 현황
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem;">
                            <div style="text-align: center; padding: 1.5rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #C8A968;">
                                <div style="font-size: 2rem; font-weight: bold; color: #C8A968;">${totalProjects}</div>
                                <div style="color: #6b7280; margin-top: 0.5rem;">총 프로젝트</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                                <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;">${activeProjects}</div>
                                <div style="color: #6b7280; margin-top: 0.5rem;">진행 중</div>
                            </div>
                            <div style="text-align: center; padding: 1.5rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                                <div style="font-size: 2rem; font-weight: bold; color: #10b981;">${completedProjects}</div>
                                <div style="color: #6b7280; margin-top: 0.5rem;">완료</div>
                            </div>
                        </div>
                    `;
                } else {
                    statsContainer.innerHTML = `
                        <h2 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span>📊</span>
                            프로젝트 현황
                        </h2>
                        <div style="text-align: center; color: #6b7280; padding: 2rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">📝</div>
                            <p>아직 생성된 프로젝트가 없습니다.</p>
                            <button onclick="handleMenuClick('new-project', null)" 
                                    style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-top: 1rem;">
                                첫 프로젝트 만들기
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('❌ 대시보드 데이터 로딩 오류:', error);
                const statsContainer = document.getElementById('dashboardStats');
                if (statsContainer) {
                    statsContainer.innerHTML = `
                        <h2 style="color: #1f2937; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span>📊</span>
                            프로젝트 현황
                        </h2>
                        <div style="text-align: center; color: #dc2626; padding: 2rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">⚠️</div>
                            <p>데이터를 불러올 수 없습니다.</p>
                        </div>
                    `;
                }
            }
        }

        /**
         * 평가자용 연구 프로젝트 참여 설문조사 콘텐츠 생성
         */
        function generateEvaluatorDemographicSurveyContent() {
            return `
                <div style="max-width: 1000px; margin: 0 auto; padding: 2rem;">
                    <div style="background: white; border-radius: 12px; padding: 2rem; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h2 style="color: var(--text-primary); font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">
                            📊 인구통계학적 설문조사
                        </h2>
                        
                        <form id="demographicSurveyForm" style="space-y: 1.5rem;">
                            <!-- 기본 정보 섹션 -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: var(--text-primary); font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">
                                    기본 정보
                                </h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            연령대
                                        </label>
                                        <select name="age" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                            <option value="">선택하세요</option>
                                            <option value="20s">20대</option>
                                            <option value="30s">30대</option>
                                            <option value="40s">40대</option>
                                            <option value="50s">50대</option>
                                            <option value="60s">60대 이상</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            성별
                                        </label>
                                        <select name="gender" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                            <option value="">선택하세요</option>
                                            <option value="male">남성</option>
                                            <option value="female">여성</option>
                                            <option value="other">기타</option>
                                            <option value="prefer-not">응답하지 않음</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            최종 학력
                                        </label>
                                        <select name="education" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                            <option value="">선택하세요</option>
                                            <option value="high-school">고등학교 졸업</option>
                                            <option value="bachelor">학사</option>
                                            <option value="master">석사</option>
                                            <option value="phd">박사</option>
                                            <option value="other">기타</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            직업
                                        </label>
                                        <input type="text" name="occupation" placeholder="예: 소프트웨어 엔지니어" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                    </div>
                                </div>
                            </div>

                            <!-- 전문 정보 섹션 -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: var(--text-primary); font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">
                                    전문 정보
                                </h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            해당 분야 경력
                                        </label>
                                        <select name="experience" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                            <option value="">선택하세요</option>
                                            <option value="less-1">1년 미만</option>
                                            <option value="1-3">1-3년</option>
                                            <option value="3-5">3-5년</option>
                                            <option value="5-10">5-10년</option>
                                            <option value="more-10">10년 이상</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            소속 부서
                                        </label>
                                        <input type="text" name="department" placeholder="예: 연구개발부" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            직급/직책
                                        </label>
                                        <input type="text" name="position" placeholder="예: 선임연구원" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                            AHP 프로젝트 경험
                                        </label>
                                        <select name="projectExperience" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                            <option value="">선택하세요</option>
                                            <option value="none">없음</option>
                                            <option value="1-2">1-2회</option>
                                            <option value="3-5">3-5회</option>
                                            <option value="more-5">5회 이상</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 의사결정 역할 -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: var(--text-primary); font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">
                                    의사결정 역할
                                </h3>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                        프로젝트에서의 역할
                                    </label>
                                    <select name="decisionRole" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary);" onchange="handleInputChange(this)">
                                        <option value="">선택하세요</option>
                                        <option value="decision-maker">최종 의사결정권자</option>
                                        <option value="advisor">자문/조언자</option>
                                        <option value="analyst">분석가</option>
                                        <option value="evaluator">평가자</option>
                                        <option value="observer">관찰자</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
                                        추가 정보 (선택사항)
                                    </label>
                                    <textarea name="additionalInfo" rows="4" placeholder="프로젝트와 관련된 추가 정보나 특별한 전문 분야가 있다면 입력해주세요." style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: var(--bg-surface); color: var(--text-primary); resize: vertical;" onchange="handleInputChange(this)"></textarea>
                                </div>
                            </div>

                            <!-- 버튼 섹션 -->
                            <div style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                                <button type="button" onclick="clearDemographicForm()" style="padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: 1px solid #d1d5db; background: transparent; color: var(--text-secondary); cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='transparent'">
                                    취소
                                </button>
                                <button type="submit" onclick="submitDemographicSurvey(event)" style="padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: none; background: var(--accent-primary); color: white; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='var(--accent-secondary)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-xl)'" onmouseout="this.style.background='var(--accent-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                    저장하기
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        /**
         * 인구통계학적 설문조사 설정 및 초기화
         */
        function setupEvaluatorDemographicSurvey() {
            console.log('📊 인구통계학적 설문조사 초기화');
            
            // 저장된 데이터 불러오기
            loadSavedDemographicData();
        }

        // 전역 변수로 폼 데이터 관리
        let demographicFormData = {
            age: '',
            gender: '',
            education: '',
            occupation: '',
            experience: '',
            department: '',
            position: '',
            projectExperience: '',
            decisionRole: '',
            additionalInfo: ''
        };

        /**
         * 입력 변경 처리
         */
        function handleInputChange(element) {
            const { name, value } = element;
            demographicFormData[name] = value;
            
            // 데이터는 제출 시에만 Django 백엔드에 저장
            console.log('📊 설문 데이터 임시 저장 (메모리):', demographicFormData);
        }

        /**
         * 저장된 데이터 불러오기
         */
        function loadSavedDemographicData() {
            // Django 백엔드에서만 데이터 관리 (로컬 스토리지 사용 안 함)
            const savedData = null; // localStorage 대신 API 사용
            if (savedData) {
                try {
                    demographicFormData = savedData;
                    
                    // 폼 필드에 데이터 복원
                    setTimeout(() => {
                        Object.keys(demographicFormData).forEach(key => {
                            const element = document.querySelector(`[name="${key}"]`);
                            if (element && demographicFormData[key]) {
                                element.value = demographicFormData[key];
                            }
                        });
                    }, 100);
                    
                    console.log('💾 저장된 설문 데이터 복원됨');
                } catch (error) {
                    console.error('❌ 저장된 데이터 복원 실패:', error);
                }
            }
        }

        /**
         * 설문 양식 지우기
         */
        function clearDemographicForm() {
            if (confirm('모든 입력 내용을 지우시겠습니까?')) {
                // 폼 초기화
                const form = document.getElementById('demographicSurveyForm');
                if (form) {
                    form.reset();
                }
                
                // 데이터 초기화
                demographicFormData = {
                    age: '',
                    gender: '',
                    education: '',
                    occupation: '',
                    experience: '',
                    department: '',
                    position: '',
                    projectExperience: '',
                    decisionRole: '',
                    additionalInfo: ''
                };
                
                // 메모리에서 데이터 초기화
                demographicFormData = {};
                
                console.log('🔄 설문조사 양식이 초기화되었습니다');
            }
        }

        /**
         * 설문조사 제출
         */
        async function submitDemographicSurvey(event) {
            if (event) {
                event.preventDefault();
            }

            const form = document.getElementById('demographicSurveyForm');
            if (!form) {
                console.error('❌ 폼을 찾을 수 없습니다');
                return;
            }

            // 현재 폼 데이터 수집
            const formData = new FormData(form);
            const surveyData = {
                age: formData.get('age'),
                gender: formData.get('gender'),
                education: formData.get('education'),
                occupation: formData.get('occupation'),
                experience: formData.get('experience'),
                department: formData.get('department'),
                position: formData.get('position'),
                project_experience: formData.get('projectExperience'),
                decision_role: formData.get('decisionRole'),
                additional_info: formData.get('additionalInfo')
            };

            console.log('📊 설문조사 데이터:', surveyData);

            try {
                // API를 통해 설문조사 제출
                const result = await window.ahpApi.submitDemographicSurvey(surveyData);
                
                if (result.success) {
                    // 성공 메시지 표시
                    alert('✅ 설문조사가 성공적으로 저장되었습니다!');
                    
                    // Django 백엔드에 완료 상태 저장됨
                    console.log('✅ 설문조사 데이터가 PostgreSQL에 저장되었습니다');
                    
                    console.log('✅ 설문조사 API 제출 성공:', result.data);
                } else {
                    throw new Error(result.message || '설문조사 저장에 실패했습니다.');
                }
            } catch (error) {
                console.error('❌ 설문조사 제출 오류:', error);
                alert('❌ 설문조사 저장 중 오류가 발생했습니다: ' + error.message);
                
                // API 실패 시 에러 표시 (로컬 스토리지 사용 안 함)
                console.error('⚠️ 설문조사 제출 실패 - Django 백엔드 연결 필요');
            }
        }

        /**
         * 인구통계학적 설문조사 설정 및 초기화
         */
        function setupEvaluatorDemographicSurvey() {
            console.log('📋 인구통계학적 설문조사 초기화');
            
            // 기존 설문 데이터 확인
            checkExistingSurveyData();
        }

        /**
         * 기존 설문 데이터 확인
         */
        async function checkExistingSurveyData() {
            try {
                // 사용자가 이미 설문을 완료했는지 확인
                const existingSurvey = await window.ahpApi.getUserDemographicData();
                if (existingSurvey.success && existingSurvey.data) {
                    showExistingSurveyMessage();
                }
            } catch (error) {
                console.log('📋 신규 설문조사 사용자');
            }
        }

        /**
         * 기존 설문 완료 메시지 표시
         */
        function showExistingSurveyMessage() {
            const form = document.getElementById('demographicSurveyForm');
            if (form) {
                form.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1.5rem;">✅</div>
                        <h3 style="color: #10b981; margin-bottom: 1rem;">설문조사 완료</h3>
                        <p style="color: #6b7280; margin-bottom: 2rem;">이미 인구통계학적 설문조사를 완료하셨습니다.<br>연구에 참여해 주셔서 감사합니다!</p>
                        <button onclick="handleMenuClick('dashboard', null)" 
                                style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">
                            대시보드로 돌아가기
                        </button>
                    </div>
                `;
            }
        }

        /**
         * 구글 폼 스타일 선택 하이라이트 효과
         */
        function highlightSelection(element) {
            // 선택된 항목의 부모 label 하이라이트
            const label = element.closest('label');
            if (label) {
                // 같은 그룹의 다른 선택 항목들 하이라이트 제거
                const groupName = element.name;
                if (groupName) {
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(input => {
                        const parentLabel = input.closest('label');
                        if (parentLabel) {
                            parentLabel.style.backgroundColor = 'transparent';
                        }
                    });
                }
                
                // 현재 선택된 항목 하이라이트
                if (element.checked) {
                    label.style.backgroundColor = '#e8f0fe';
                    label.style.borderColor = '#C8A968';
                } else {
                    label.style.backgroundColor = 'transparent';
                }
            }
        }

        /**
         * 양식 지우기 함수
         */
        function clearForm() {
            if (confirm('모든 입력 내용을 지우시겠습니까?')) {
                const form = document.getElementById('demographicSurveyForm');
                if (form) {
                    // 모든 입력 필드 초기화
                    form.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                        input.checked = false;
                        const label = input.closest('label');
                        if (label) {
                            label.style.backgroundColor = 'transparent';
                        }
                    });
                    
                    // 텍스트 영역 초기화
                    const commentsTextarea = document.getElementById('comments');
                    if (commentsTextarea) {
                        commentsTextarea.value = '';
                    }
                    
                    console.log('📋 설문조사 양식이 초기화되었습니다.');
                }
            }
        }

        /**
         * 설문조사 제출 처리
         */
        async function submitDemographicSurvey() {
            const form = document.getElementById('demographicSurveyForm');
            if (!form) return;

            // 필수 항목 확인
            const ageGroup = document.querySelector('input[name="ageGroup"]:checked');
            const gender = document.querySelector('input[name="gender"]:checked');
            const education = document.querySelector('input[name="education"]:checked');
            const occupation = document.querySelector('input[name="occupation"]:checked');
            const experience = document.querySelector('input[name="experience"]:checked');
            const ahpExperience = document.querySelector('input[name="ahpExperience"]:checked');
            const agreeToTerms = document.getElementById('agreeToTerms').checked;

            // 구글 폼 스타일 유효성 검사 및 오류 표시
            const showValidationError = (message, inputElement = null) => {
                // 구글 폼 스타일 오류 표시
                alert(`❗ ${message}`);
                
                // 해당 섹션으로 스크롤
                if (inputElement) {
                    inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // 오류 표시를 위한 스타일 적용
                    const container = inputElement.closest('div[style*="background: #ffffff"]');
                    if (container) {
                        container.style.border = '2px solid #d93025';
                        container.style.backgroundColor = '#fef7f0';
                        
                        // 3초 후 원래 스타일로 복원
                        setTimeout(() => {
                            container.style.border = 'none';
                            container.style.backgroundColor = '#ffffff';
                        }, 3000);
                    }
                }
            };

            // 유효성 검사
            if (!ageGroup) {
                showValidationError('1번 질문: 연령대를 선택해주세요.', document.querySelector('input[name="ageGroup"]'));
                return;
            }
            if (!gender) {
                showValidationError('2번 질문: 성별을 선택해주세요.', document.querySelector('input[name="gender"]'));
                return;
            }
            if (!education) {
                showValidationError('3번 질문: 최종 학력을 선택해주세요.', document.querySelector('input[name="education"]'));
                return;
            }
            if (!occupation) {
                showValidationError('4번 질문: 직업 분야를 선택해주세요.', document.querySelector('input[name="occupation"]'));
                return;
            }
            if (!experience) {
                showValidationError('5번 질문: 근무 경력을 선택해주세요.', document.querySelector('input[name="experience"]'));
                return;
            }
            if (!ahpExperience) {
                showValidationError('6번 질문: AHP 사용 경험을 선택해주세요.', document.querySelector('input[name="ahpExperience"]'));
                return;
            }

            // 사용 목적 확인 (최소 1개 선택 필요)
            const usagePurposeElements = document.querySelectorAll('input[name="usagePurpose"]:checked');
            if (usagePurposeElements.length === 0) {
                showValidationError('7번 질문: 의사결정 도구 사용 목적을 최소 1개 이상 선택해주세요.', document.querySelector('input[name="usagePurpose"]'));
                return;
            }

            if (!agreeToTerms) {
                showValidationError('개인정보 수집 및 이용 동의가 필요합니다.', document.getElementById('agreeToTerms'));
                return;
            }

            // 사용 목적 수집 (복수선택)
            const usagePurpose = Array.from(usagePurposeElements).map(el => el.value);

            // 설문 데이터 구성
            const surveyData = {
                age_group: ageGroup.value,
                gender: gender.value,
                education: education.value,
                occupation: occupation.value,
                experience: experience.value,
                ahp_experience: ahpExperience.value,
                usage_purpose: usagePurpose,
                comments: document.getElementById('comments').value.trim(),
                submitted_at: new Date().toISOString()
            };

            try {
                console.log('📋 설문조사 제출:', surveyData);
                
                // 제출 버튼 비활성화 및 로딩 표시
                const submitBtn = form.querySelector('button');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '제출 중...';
                submitBtn.disabled = true;

                // API 호출
                const result = await window.ahpApi.submitDemographicSurvey(surveyData);

                if (result.success) {
                    // 구글 폼 스타일 성공 메시지 표시
                    const container = document.querySelector('.demographic-survey-container');
                    if (container) {
                        container.innerHTML = `
                            <div style="background: #ffffff; border-radius: 8px; padding: 3rem; margin: 2rem auto; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); text-align: center; max-width: 600px;">
                                <div style="width: 80px; height: 80px; background: #e8f5e8; border-radius: 50%; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center;">
                                    <svg style="width: 40px; height: 40px; color: #4caf50;" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <h1 style="color: #202124; font-size: 1.5rem; font-weight: 400; margin: 0 0 1rem 0;">설문조사가 제출되었습니다</h1>
                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 2rem 0; line-height: 1.5;">
                                    소중한 시간을 내어 설문조사에 참여해 주셔서 감사합니다.<br>
                                    제출해 주신 정보는 연구 발전에 큰 도움이 될 것입니다.
                                </p>
                                <div style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem; margin: 2rem 0; border: 1px solid #e8eaed;">
                                    <h3 style="color: #202124; font-size: 1rem; font-weight: 500; margin: 0 0 1rem 0;">📊 제출 완료된 정보</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; text-align: left; font-size: 0.8rem; color: #5f6368;">
                                        <div>✓ 연령대: <strong>${surveyData.age_group}</strong></div>
                                        <div>✓ 성별: <strong>${surveyData.gender}</strong></div>
                                        <div>✓ 학력: <strong>${surveyData.education}</strong></div>
                                        <div>✓ 직업: <strong>${surveyData.occupation}</strong></div>
                                        <div>✓ 경력: <strong>${surveyData.experience}</strong></div>
                                        <div>✓ AHP 경험: <strong>${surveyData.ahp_experience}</strong></div>
                                    </div>
                                    <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #5f6368; text-align: left;">
                                        ✓ 사용 목적: <strong>${surveyData.usage_purpose.join(', ')}</strong>
                                    </div>
                                    ${surveyData.comments ? `<div style="margin-top: 0.5rem; font-size: 0.8rem; color: #5f6368; text-align: left;">✓ 추가 의견 작성됨</div>` : ''}
                                </div>
                                <p style="color: #5f6368; font-size: 0.75rem; margin: 1.5rem 0; line-height: 1.4;">
                                    🔒 제출된 정보는 연구 목적으로만 활용되며, 개인정보보호법에 따라 안전하게 관리됩니다.<br>
                                    제출 시각: ${new Date().toLocaleString('ko-KR')}
                                </p>
                                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                                    <button onclick="handleMenuClick('dashboard', null)" 
                                            style="background: #C8A968; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.3s;"
                                            onmouseover="this.style.background='#B59A4D'"
                                            onmouseout="this.style.background='#C8A968'">
                                        대시보드로 돌아가기
                                    </button>
                                    <button onclick="handleMenuClick('new-project', null)" 
                                            style="background: transparent; color: #C8A968; border: 1px solid #C8A968; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.3s;"
                                            onmouseover="this.style.background='#C8A968'; this.style.color='white'"
                                            onmouseout="this.style.background='transparent'; this.style.color='#C8A968'">
                                        새 프로젝트 시작
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    throw new Error(result.message || '설문조사 제출에 실패했습니다.');
                }

            } catch (error) {
                console.error('❌ 설문조사 제출 오류:', error);
                alert('설문조사 제출 중 오류가 발생했습니다. 다시 시도해주세요.');
                
                // 버튼 복구
                const submitBtn = form.querySelector('button');
                if (submitBtn) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }
        }

        // =========================
        // 사용자 가이드 (React ComprehensiveUserGuide + UserGuideOverview 구현)
        // =========================

        /**
         * 사용자 가이드 메인 콘텐츠 생성
         */
        function generateUserGuideContent() {
            return `
                <div class="user-guide-container" style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); min-height: 100vh;">
                    <!-- 가이드 헤더 -->
                    <div class="text-center mb-8">
                        <h1 style="color: #202124; font-size: 3rem; font-weight: 300; margin-bottom: 1rem; line-height: 1.2;">
                            안녕하세요, 
                            <span style="color: #C8A968; font-weight: 600; margin-left: 0.5rem;">AHP 연구자</span>님
                        </h1>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="width: 3rem; height: 0.125rem; background: #C8A968; border-radius: 9999px;"></div>
                            <span style="color: #C8A968; font-size: 0.75rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; padding: 0.25rem 0.75rem; border: 1px solid #C8A968; border-radius: 9999px; background: rgba(200, 169, 104, 0.1);">
                                Complete Guide
                            </span>
                            <div style="width: 3rem; height: 0.125rem; background: #C8A968; border-radius: 9999px;"></div>
                        </div>
                        <p style="color: #5f6368; font-size: 1.125rem; font-weight: 300; max-width: 48rem; margin: 0 auto; line-height: 1.6;">
                            전문적인 AHP 의사결정 분석을 위한 완벽한 단계별 가이드를 제공합니다
                        </p>
                    </div>

                    <!-- 가이드 모드 선택 -->
                    <div class="guide-mode-selector" style="display: grid; grid-template-columns: 1fr; lg:grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                        <!-- 완전 가이드 -->
                        <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border-radius: 1rem; padding: 2rem; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); text-align: center; cursor: pointer;" onclick="showComprehensiveGuide()">
                            <div style="font-size: 4rem; margin-bottom: 1.5rem;">📚</div>
                            <h3 style="color: #202124; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                📖 완전 가이드
                            </h3>
                            <p style="color: #5f6368; font-size: 1rem; margin-bottom: 1.5rem;">
                                연구자와 평가자를 위한 상세한 단계별 가이드
                            </p>
                            <div style="text-align: left; margin-bottom: 2rem;">
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">👨‍🔬</span>
                                    <span style="color: #202124;">연구자 완전 워크플로우</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">👨‍💼</span>
                                    <span style="color: #202124;">평가자 참여 프로세스</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">🎯</span>
                                    <span style="color: #202124;">실제 예시 및 데모</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📊</span>
                                    <span style="color: #202124;">자동 논문 생성 도구</span>
                                </div>
                            </div>
                            <button style="background: #C8A968; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; width: 100%; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#b8986b'" onmouseout="this.style.background='#C8A968'">
                                완전 가이드 시작하기
                            </button>
                        </div>

                        <!-- 단계별 가이드 -->
                        <div style="background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border-radius: 1rem; padding: 2rem; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); text-align: center; cursor: pointer;" onclick="showStepByStepGuide()">
                            <div style="font-size: 4rem; margin-bottom: 1.5rem;">🎯</div>
                            <h3 style="color: #202124; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                📋 단계별 가이드
                            </h3>
                            <p style="color: #5f6368; font-size: 1rem; margin-bottom: 1.5rem;">
                                5단계 인터랙티브 학습 프로세스
                            </p>
                            <div style="text-align: left; margin-bottom: 2rem;">
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">🎯</span>
                                    <span style="color: #202124;">프로젝트 생성</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📋</span>
                                    <span style="color: #202124;">기준 설정</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">🔀</span>
                                    <span style="color: #202124;">대안 설정</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">⚖️</span>
                                    <span style="color: #202124;">쌍대비교 & 결과분석</span>
                                </div>
                            </div>
                            <button style="background: #4285f4; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; width: 100%; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#3367d6'" onmouseout="this.style.background='#4285f4'">
                                단계별 가이드 시작하기
                            </button>
                        </div>
                    </div>

                    <!-- 빠른 시작 섹션 -->
                    <div id="quickStartSection" style="background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border-radius: 1rem; padding: 2rem; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); text-align: center; margin-bottom: 2rem;">
                        <h3 style="color: #202124; font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <span style="font-size: 1.5rem;">🚀</span>
                            지금 시작하기
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem;">
                            바로 프로젝트를 시작하거나 평가에 참여하세요
                        </p>
                        <div style="display: flex; flex-direction: column; sm:flex-direction: row; gap: 1rem; justify-content: center;">
                            <button onclick="handleMenuClick('new-project', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;" onmouseover="this.style.background='#b8986b'" onmouseout="this.style.background='#C8A968'">
                                <span>🏗️</span>
                                연구 프로젝트 시작
                            </button>
                            <button onclick="handleMenuClick('demographic-survey', null)" style="background: transparent; color: #C8A968; border: 2px solid #C8A968; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(200, 169, 104, 0.1)'" onmouseout="this.style.background='transparent'">
                                <span>📋</span>
                                설문조사 참여
                            </button>
                        </div>
                    </div>

                    <!-- 가이드 콘텐츠 영역 -->
                    <div id="guideContentArea"></div>
                </div>
            `;
        }

        /**
         * 완전 가이드 표시
         */
        function showComprehensiveGuide() {
            const contentArea = document.getElementById('guideContentArea');
            contentArea.innerHTML = `
                <div class="comprehensive-guide" style="background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border-radius: 1rem; padding: 2rem; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);">
                    <!-- 가이드 네비게이션 -->
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: #202124; font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 2.5rem;">📚</span>
                            AHP Research Platform 완전 가이드
                        </h2>
                        <button onclick="backToGuideHome()" style="background: transparent; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                            ← 가이드 홈으로
                        </button>
                    </div>

                    <!-- 섹션 네비게이션 -->
                    <div class="section-navigation" style="display: flex; gap: 0.5rem; margin-bottom: 2rem; flex-wrap: wrap;">
                        <button onclick="showGuideSection('overview')" class="guide-nav-btn active" data-section="overview" style="background: #4285f4; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                            개요
                        </button>
                        <button onclick="showGuideSection('researcher')" class="guide-nav-btn" data-section="researcher" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                            연구자 가이드
                        </button>
                        <button onclick="showGuideSection('evaluator')" class="guide-nav-btn" data-section="evaluator" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                            평가자 가이드
                        </button>
                        <button onclick="showGuideSection('demo')" class="guide-nav-btn" data-section="demo" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                            데모 체험
                        </button>
                    </div>

                    <!-- 콘텐츠 영역 -->
                    <div id="guideSectionContent">
                        ${generateOverviewSection()}
                    </div>
                </div>
            `;
        }

        /**
         * 단계별 가이드 표시
         */
        function showStepByStepGuide() {
            const contentArea = document.getElementById('guideContentArea');
            contentArea.innerHTML = generateStepByStepGuideContent();
            setupStepByStepGuide();
        }

        /**
         * 개요 섹션 생성
         */
        function generateOverviewSection() {
            return `
                <div class="overview-section">
                    <!-- 주요 기능 카드들 -->
                    <div style="display: grid; grid-template-columns: 1fr; lg:grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                        <!-- 연구자 모드 -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 1.5rem;">👨‍🔬</div>
                            <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                연구자 모드
                            </h3>
                            <p style="font-size: 1rem; margin-bottom: 1.5rem; opacity: 0.9;">
                                프로젝트 생성, 모델 구축, 평가자 관리, 결과 분석까지
                            </p>
                            <div style="text-align: left; margin-bottom: 2rem;">
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">🏗️</span>
                                    <span>계층구조 모델 설계</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">👥</span>
                                    <span>평가자 초대 및 관리</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📊</span>
                                    <span>실시간 평가 모니터링</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📈</span>
                                    <span>상세 결과 분석</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📋</span>
                                    <span>설문조사 도구</span>
                                </div>
                            </div>
                            <button onclick="showGuideSection('researcher')" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; width: 100%; backdrop-filter: blur(10px);">
                                연구자 가이드 보기
                            </button>
                        </div>

                        <!-- 평가자 모드 -->
                        <div style="background: white; border: 2px solid #dadce0; padding: 2rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 1.5rem;">👨‍💼</div>
                            <h3 style="color: #202124; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                평가자 모드
                            </h3>
                            <p style="color: #5f6368; font-size: 1rem; margin-bottom: 1.5rem;">
                                직관적인 평가 인터페이스로 간편하고 정확한 평가
                            </p>
                            <div style="text-align: left; margin-bottom: 2rem;">
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">🎯</span>
                                    <span style="color: #202124;">쌍대비교 평가</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📝</span>
                                    <span style="color: #202124;">직접입력 평가</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">⚡</span>
                                    <span style="color: #202124;">실시간 진행률 확인</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">💾</span>
                                    <span style="color: #202124;">자동 저장 및 복구</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.25rem; margin-right: 0.75rem;">📊</span>
                                    <span style="color: #202124;">설문조사 참여</span>
                                </div>
                            </div>
                            <button onclick="showGuideSection('evaluator')" style="background: transparent; color: #202124; border: 2px solid #202124; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; width: 100%;">
                                평가자 가이드 보기
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 연구자 가이드 섹션 생성
         */
        function generateResearcherSection() {
            return `
                <div class="researcher-section">
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 2rem;">
                        <h2 style="color: #202124; font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 2.5rem;">👨‍🔬</span>
                            연구자 완전 가이드
                        </h2>
                    </div>

                    <!-- 완전한 연구자 워크플로우 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; text-align: center;">
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                            🎯 완전한 AHP 연구 프로세스
                        </h3>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; font-weight: 500;">
                            <div style="background: rgba(66, 133, 244, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">프로젝트 생성</div>
                            <span>→</span>
                            <div style="background: rgba(34, 197, 94, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">모델 구축</div>
                            <span>→</span>
                            <div style="background: rgba(234, 179, 8, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">평가자 관리</div>
                            <span>→</span>
                            <div style="background: rgba(168, 85, 247, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">결과 분석</div>
                            <span>→</span>
                            <div style="background: rgba(239, 68, 68, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">논문 작성</div>
                        </div>
                    </div>

                    <!-- 단계별 상세 가이드 -->
                    <div style="display: grid; gap: 1.5rem;">
                        ${generateResearcherStep('1️⃣', '프로젝트 생성 및 설정', 'new-project')}
                        ${generateResearcherStep('2️⃣', 'AHP 계층구조 모델 구축', 'criteria-management')}
                        ${generateResearcherStep('3️⃣', '평가자 초대 및 관리', 'evaluator-management')}
                        ${generateResearcherStep('4️⃣', '결과 분석 및 해석', 'results-analysis')}
                        ${generateResearcherStep('5️⃣', '논문 작성 및 보고서 작성', 'report-generation')}
                    </div>

                    <!-- 실습 버튼 -->
                    <div style="text-align: center; margin-top: 2rem;">
                        <button onclick="handleMenuClick('new-project', null)" style="background: #C8A968; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; margin-right: 1rem; font-size: 1rem;" onmouseover="this.style.background='#b8986b'" onmouseout="this.style.background='#C8A968'">
                            🚀 연구자 모드로 실습하기
                        </button>
                        <button onclick="showGuideSection('demo')" style="background: transparent; color: #C8A968; border: 2px solid #C8A968; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; font-size: 1rem;" onmouseover="this.style.background='rgba(200, 169, 104, 0.1)'" onmouseout="this.style.background='transparent'">
                            🎮 연구자 데모 체험
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * 연구자 단계 생성 헬퍼
         */
        function generateResearcherStep(icon, title, menuLink) {
            const stepContent = {
                'new-project': {
                    color: '#4285f4',
                    description: '새로운 의사결정 분석을 위한 프로젝트를 생성합니다.',
                    points: [
                        '명확하고 구체적인 프로젝트명 설정',
                        '연구 목적과 배경 상세 작성',
                        '평가 방법 선택 (쌍대비교/직접입력)',
                        '프로젝트 범위와 제약사항 정의'
                    ]
                },
                'criteria-management': {
                    color: '#34a853',
                    description: 'AHP 분석을 위한 계층적 평가 기준을 설계합니다.',
                    points: [
                        '상위 기준과 세부 기준 정의',
                        '계층구조 시각화 및 검증',
                        '기준별 설명 및 정의 작성',
                        '전문가 검토를 통한 완성도 확보'
                    ]
                },
                'evaluator-management': {
                    color: '#fbbc04',
                    description: '평가자를 초대하고 평가 진행 상황을 모니터링합니다.',
                    points: [
                        '이메일 일괄 초대 시스템',
                        '개별 링크 생성 및 관리',
                        '실시간 진행률 모니터링',
                        '자동 리마인더 발송'
                    ]
                },
                'results-analysis': {
                    color: '#9c27b0',
                    description: '평가 결과를 종합 분석하고 최적 대안을 도출합니다.',
                    points: [
                        '가중치 및 순위 결과 확인',
                        '일관성 비율 분석',
                        '민감도 분석 수행',
                        '시각화 차트 생성'
                    ]
                },
                'report-generation': {
                    color: '#ea4335',
                    description: 'AI 지원으로 전문적인 논문 초안과 보고서를 생성합니다.',
                    points: [
                        '자동 논문 초안 생성',
                        'Word/PDF 형식 내보내기',
                        '참고문헌 자동 생성',
                        '시각화 자료 포함'
                    ]
                }
            };

            const step = stepContent[menuLink] || stepContent['new-project'];

            return `
                <div style="background: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <div style="font-size: 2rem;">${icon}</div>
                        <div style="flex: 1;">
                            <h3 style="color: #202124; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">
                                ${title}
                            </h3>
                            <div style="background: ${step.color}15; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid ${step.color};">
                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0;">
                                    ${step.description}
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <h4 style="color: #202124; font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">주요 기능</h4>
                                    <ul style="color: #5f6368; font-size: 0.875rem; margin: 0; padding-left: 1.5rem;">
                                        ${step.points.map(point => `<li style="margin-bottom: 0.25rem;">${point}</li>`).join('')}
                                    </ul>
                                </div>
                                <div style="display: flex; align-items: end;">
                                    <button onclick="handleMenuClick('${menuLink}', null)" style="background: ${step.color}; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
                                        📍 바로 이동하기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 평가자 가이드 섹션 생성
         */
        function generateEvaluatorSection() {
            return `
                <div class="evaluator-section">
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 2rem;">
                        <h2 style="color: #202124; font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 2.5rem;">👨‍💼</span>
                            평가자 완전 가이드
                        </h2>
                    </div>

                    <!-- 평가자 워크플로우 -->
                    <div style="background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); color: white; padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; text-align: center;">
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                            🎯 평가자 참여 프로세스
                        </h3>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; font-weight: 500;">
                            <div style="background: rgba(66, 133, 244, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">초대 수락</div>
                            <span>→</span>
                            <div style="background: rgba(34, 197, 94, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">로그인 및 설정</div>
                            <span>→</span>
                            <div style="background: rgba(234, 179, 8, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">평가 수행</div>
                            <span>→</span>
                            <div style="background: rgba(168, 85, 247, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">설문조사</div>
                            <span>→</span>
                            <div style="background: rgba(239, 68, 68, 0.2); padding: 0.5rem 1rem; border-radius: 9999px;">완료</div>
                        </div>
                    </div>

                    <!-- 평가자 단계별 가이드 -->
                    <div style="display: grid; gap: 1.5rem;">
                        ${generateEvaluatorStep('1️⃣', '프로젝트 초대 및 시작')}
                        ${generateEvaluatorStep('2️⃣', '쌍대비교 평가 수행')}
                        ${generateEvaluatorStep('3️⃣', '직접입력 평가 (선택적)')}
                        ${generateEvaluatorStep('4️⃣', '인구통계학적 설문조사')}
                        ${generateEvaluatorStep('5️⃣', '평가 완료 및 결과 확인')}
                    </div>

                    <!-- 실습 버튼 -->
                    <div style="text-align: center; margin-top: 2rem;">
                        <button onclick="handleMenuClick('demographic-survey', null)" style="background: #4285f4; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; margin-right: 1rem; font-size: 1rem;" onmouseover="this.style.background='#3367d6'" onmouseout="this.style.background='#4285f4'">
                            👨‍💼 평가자 모드로 실습하기
                        </button>
                        <button onclick="showGuideSection('demo')" style="background: transparent; color: #4285f4; border: 2px solid #4285f4; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; font-size: 1rem;" onmouseover="this.style.background='rgba(66, 133, 244, 0.1)'" onmouseout="this.style.background='transparent'">
                            🎮 평가자 데모 체험
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * 평가자 단계 생성 헬퍼
         */
        function generateEvaluatorStep(icon, title) {
            const steps = {
                '1️⃣': {
                    description: '이메일 초대장을 통해 프로젝트에 참여하고 기본 설정을 완료합니다.',
                    points: ['이메일 링크 클릭으로 간편 접속', '소셜 로그인 지원', '필수 정보 입력', '평가 환경 설정']
                },
                '2️⃣': {
                    description: 'AHP의 핵심인 쌍대비교를 통해 요소간 상대적 중요도를 평가합니다.',
                    points: ['9점 척도 사용법 학습', '직관적 비교 인터페이스', '실시간 일관성 검증', '자동 저장 기능']
                },
                '3️⃣': {
                    description: '전문가 의견을 바탕으로 직접 가중치를 입력하는 방식입니다.',
                    points: ['백분율 기반 입력', '실시간 합계 검증', '빠른 평가 완료', '직관적 사용법']
                },
                '4️⃣': {
                    description: '연구 품질 향상을 위한 평가자 배경 정보를 수집합니다.',
                    points: ['완전 익명 처리', '연구 목적 전용', '선택적 참여', 'GDPR 준수']
                },
                '5️⃣': {
                    description: '모든 평가를 완료하고 결과 알림을 받습니다.',
                    points: ['완료 확인 메시지', '평가 기여도 표시', '결과 알림 서비스', '추가 참여 기회']
                }
            };

            const step = steps[icon];
            
            return `
                <div style="background: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <div style="font-size: 2rem;">${icon}</div>
                        <div style="flex: 1;">
                            <h3 style="color: #202124; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">
                                ${title}
                            </h3>
                            <div style="background: #4285f415; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid #4285f4;">
                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0;">
                                    ${step.description}
                                </p>
                            </div>
                            <div>
                                <h4 style="color: #202124; font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">주요 특징</h4>
                                <ul style="color: #5f6368; font-size: 0.875rem; margin: 0; padding-left: 1.5rem;">
                                    ${step.points.map(point => `<li style="margin-bottom: 0.25rem;">${point}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 데모 섹션 생성
         */
        function generateDemoSection() {
            return `
                <div class="demo-section">
                    <div style="text-center; margin-bottom: 2rem;">
                        <h2 style="color: #202124; font-size: 2rem; font-weight: 700; margin-bottom: 1rem;">
                            🎮 데모 체험하기
                        </h2>
                        <p style="color: #5f6368; font-size: 1rem;">
                            실제 데이터로 AHP 분석 과정을 체험해보세요
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- 연구자 데모 -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">👨‍🔬</div>
                            <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem;">
                                연구자 데모
                            </h3>
                            <p style="margin-bottom: 1.5rem; opacity: 0.9;">
                                "AI 활용 방안 선정" 프로젝트로 전체 연구 과정 체험
                            </p>
                            <div style="text-align: left; margin-bottom: 1.5rem; font-size: 0.875rem;">
                                <div style="margin-bottom: 0.5rem;">✅ 완성된 AHP 모델</div>
                                <div style="margin-bottom: 0.5rem;">✅ 실제 평가 데이터</div>
                                <div style="margin-bottom: 0.5rem;">✅ 상세 분석 결과</div>
                                <div>✅ 시각화 차트</div>
                            </div>
                            <button onclick="handleMenuClick('new-project', null)" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; width: 100%; backdrop-filter: blur(10px);">
                                연구자 데모 시작
                            </button>
                        </div>

                        <!-- 평가자 데모 -->
                        <div style="background: white; border: 2px solid #dadce0; padding: 2rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">👨‍💼</div>
                            <h3 style="color: #202124; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem;">
                                평가자 데모
                            </h3>
                            <p style="color: #5f6368; margin-bottom: 1.5rem;">
                                실제 평가 인터페이스로 쌍대비교 평가 체험
                            </p>
                            <div style="text-align: left; margin-bottom: 1.5rem; font-size: 0.875rem; color: #202124;">
                                <div style="margin-bottom: 0.5rem;">✅ 쌍대비교 평가</div>
                                <div style="margin-bottom: 0.5rem;">✅ 직접입력 평가</div>
                                <div style="margin-bottom: 0.5rem;">✅ 일관성 검증</div>
                                <div>✅ 설문조사</div>
                            </div>
                            <button onclick="handleMenuClick('demographic-survey', null)" style="background: transparent; color: #202124; border: 2px solid #202124; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; width: 100%;">
                                평가자 데모 시작
                            </button>
                        </div>
                    </div>

                    <!-- 뒤로 가기 -->
                    <div style="text-center; margin-top: 2rem;">
                        <button onclick="showGuideSection('overview')" style="background: transparent; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                            ← 개요로 돌아가기
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * 단계별 가이드 콘텐츠 생성
         */
        function generateStepByStepGuideContent() {
            return `
                <div class="step-guide-container" style="background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border-radius: 1rem; padding: 2rem; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);">
                    <!-- 헤더 -->
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: #202124; font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 2.5rem;">🎯</span>
                            5단계 인터랙티브 가이드
                        </h2>
                        <button onclick="backToGuideHome()" style="background: transparent; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                            ← 가이드 홈으로
                        </button>
                    </div>

                    <!-- 단계 네비게이션 -->
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center;">
                        <button onclick="showStep(1)" class="step-nav-btn active" data-step="1" style="background: #4285f4; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <span>🎯</span>
                            <span>1단계: 프로젝트 생성</span>
                        </button>
                        <button onclick="showStep(2)" class="step-nav-btn" data-step="2" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <span>📋</span>
                            <span>2단계: 기준 설정</span>
                        </button>
                        <button onclick="showStep(3)" class="step-nav-btn" data-step="3" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <span>🔀</span>
                            <span>3단계: 대안 설정</span>
                        </button>
                        <button onclick="showStep(4)" class="step-nav-btn" data-step="4" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <span>⚖️</span>
                            <span>4단계: 쌍대비교</span>
                        </button>
                        <button onclick="showStep(5)" class="step-nav-btn" data-step="5" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <span>📊</span>
                            <span>5단계: 결과 분석</span>
                        </button>
                    </div>

                    <!-- 진행률 표시 -->
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 0.5rem;">
                            <span style="color: #5f6368; font-size: 0.875rem; font-weight: 500;">진행도:</span>
                            <span id="progressText" style="color: #4285f4; font-size: 0.875rem; font-weight: 700;">1/5 단계</span>
                        </div>
                        <div style="width: 100%; height: 0.5rem; background: #f1f3f4; border-radius: 9999px; overflow: hidden;">
                            <div id="progressBar" style="width: 20%; height: 100%; background: #4285f4; transition: width 0.3s ease;"></div>
                        </div>
                    </div>

                    <!-- 콘텐츠 영역 -->
                    <div id="stepContent">
                        ${generateStepContent(1)}
                    </div>

                    <!-- 네비게이션 버튼 -->
                    <div style="display: flex; justify-content: between; align-items: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #dadce0;">
                        <button id="prevBtn" onclick="prevStep()" style="background: #f8f9fa; color: #5f6368; border: 1px solid #dadce0; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: none;">
                            ← 이전 단계
                        </button>
                        <div style="color: #4285f4; font-size: 1rem; font-weight: 600;">
                            <span id="currentStepDisplay">1</span> / 5 단계
                        </div>
                        <button id="nextBtn" onclick="nextStep()" style="background: #4285f4; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                            다음 단계 →
                        </button>
                        <button id="completeBtn" onclick="handleMenuClick('new-project', null)" style="background: #34a853; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: none;">
                            🚀 실제 서비스 시작하기
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * 단계별 콘텐츠 생성
         */
        function generateStepContent(step) {
            const contents = {
                1: `
                    <div>
                        <h3 style="color: #202124; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 2rem;">🎯</span>
                            1단계: 프로젝트 생성
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">
                            AHP 의사결정 분석을 위한 프로젝트를 생성합니다.
                        </p>

                        <!-- 샘플 프로젝트 정보 -->
                        <div style="background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                            <h4 style="color: #1565c0; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">📋</span>
                                샘플 프로젝트 정보
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <p style="color: #1565c0; font-weight: 600; margin-bottom: 0.5rem;">프로젝트명</p>
                                    <p style="color: #202124; background: white; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #bbdefb;">
                                        AI 개발 도구 선정을 위한 AHP 분석
                                    </p>
                                </div>
                                <div>
                                    <p style="color: #1565c0; font-weight: 600; margin-bottom: 0.5rem;">현재 상태</p>
                                    <div style="background: white; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #bbdefb;">
                                        <span style="background: #e8f5e8; color: #2e7d32; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600;">
                                            ✅ 활성
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 1rem;">
                                <p style="color: #1565c0; font-weight: 600; margin-bottom: 0.5rem;">프로젝트 설명</p>
                                <p style="color: #202124; background: white; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #bbdefb; line-height: 1.5;">
                                    기업의 AI 개발 프로젝트를 위한 최적의 도구를 선정하기 위해 여러 대안을 체계적으로 비교 분석합니다.
                                </p>
                            </div>
                        </div>

                        <!-- 프로젝트 생성 팁 -->
                        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border: 1px solid #bbdefb; border-radius: 0.75rem; padding: 1.5rem;">
                            <h5 style="color: #1565c0; font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">💡</span>
                                프로젝트 생성 팁
                            </h5>
                            <ul style="color: #1565c0; margin: 0; padding-left: 1.5rem;">
                                <li style="margin-bottom: 0.5rem;">명확하고 구체적인 프로젝트명을 사용하세요</li>
                                <li style="margin-bottom: 0.5rem;">의사결정의 목적과 배경을 상세히 작성하세요</li>
                                <li style="margin-bottom: 0.5rem;">프로젝트 범위와 제약사항을 미리 정의하세요</li>
                            </ul>
                        </div>
                    </div>
                `,
                2: `
                    <div>
                        <h3 style="color: #202124; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 2rem;">📋</span>
                            2단계: 기준 설정
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">
                            의사결정에 사용할 평가 기준들을 계층적으로 구성합니다.
                        </p>

                        <!-- 기준 계층구조 -->
                        <div style="background: #e8f5e8; border: 1px solid #c8e6c8; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                            <h4 style="color: #2e7d32; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">🌳</span>
                                기준 계층구조 예시
                            </h4>

                            <div style="display: grid; grid-template-columns: 1fr; lg:grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                <div>
                                    <h5 style="color: #2e7d32; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 1.25rem;">🎯</span>
                                        상위 기준 (Level 1)
                                    </h5>
                                    <div style="background: white; border: 1px solid #c8e6c8; border-radius: 0.5rem; padding: 1rem;">
                                        <div style="margin-bottom: 0.75rem;">
                                            <div style="color: #2e7d32; font-weight: 600;">📊 성능</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">처리 속도 및 정확도</div>
                                        </div>
                                        <div style="margin-bottom: 0.75rem;">
                                            <div style="color: #2e7d32; font-weight: 600;">💰 비용</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">도입 및 운영 비용</div>
                                        </div>
                                        <div>
                                            <div style="color: #2e7d32; font-weight: 600;">👥 사용성</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">사용 편의성 및 학습 용이성</div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h5 style="color: #7b1fa2; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 1.25rem;">🔍</span>
                                        세부 기준 (Level 2)
                                    </h5>
                                    <div style="background: white; border: 1px solid #c8e6c8; border-radius: 0.5rem; padding: 1rem;">
                                        <div style="margin-bottom: 0.75rem;">
                                            <div style="color: #7b1fa2; font-weight: 600;">⚡ 응답 속도</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">API 호출 응답 시간</div>
                                        </div>
                                        <div style="margin-bottom: 0.75rem;">
                                            <div style="color: #7b1fa2; font-weight: 600;">🎯 정확도</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">결과 정확성</div>
                                        </div>
                                        <div>
                                            <div style="color: #7b1fa2; font-weight: 600;">📈 확장성</div>
                                            <div style="color: #5f6368; font-size: 0.875rem;">대용량 처리 능력</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 기준 설정 가이드라인 -->
                        <div style="background: linear-gradient(135deg, #e8f5e8 0%, #f3e5f5 100%); border: 1px solid #c8e6c8; border-radius: 0.75rem; padding: 1.5rem;">
                            <h5 style="color: #2e7d32; font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">📝</span>
                                기준 설정 가이드라인
                            </h5>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <ul style="color: #2e7d32; margin: 0; padding-left: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">3~7개 기준 권장</li>
                                    <li style="margin-bottom: 0.5rem;">상호 독립적인 기준</li>
                                    <li>완전성 확보</li>
                                </ul>
                                <ul style="color: #2e7d32; margin: 0; padding-left: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">측정 가능한 기준</li>
                                    <li style="margin-bottom: 0.5rem;">명확한 정의</li>
                                    <li>일관된 중요도</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                3: `
                    <div>
                        <h3 style="color: #202124; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 2rem;">🔀</span>
                            3단계: 대안 설정
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">
                            비교 평가할 대안들을 설정합니다.
                        </p>

                        <!-- 대안 목록 -->
                        <div style="background: #fff3e0; border: 1px solid #ffcc02; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                            <h4 style="color: #e65100; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">🎲</span>
                                평가 대안 목록
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div style="background: white; border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <div style="width: 2rem; height: 2rem; background: linear-gradient(135deg, #ff9800, #f57c00); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">1</div>
                                        <h5 style="color: #202124; font-size: 1rem; font-weight: 700;">GPT-4</h5>
                                    </div>
                                    <p style="color: #5f6368; font-size: 0.875rem; line-height: 1.4;">OpenAI의 최신 대화형 AI 모델로 뛰어난 성능과 다양한 기능을 제공합니다.</p>
                                </div>
                                
                                <div style="background: white; border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <div style="width: 2rem; height: 2rem; background: linear-gradient(135deg, #ff9800, #f57c00); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">2</div>
                                        <h5 style="color: #202124; font-size: 1rem; font-weight: 700;">Claude</h5>
                                    </div>
                                    <p style="color: #5f6368; font-size: 0.875rem; line-height: 1.4;">Anthropic의 AI 어시스턴트로 안전성과 유용성을 중시하는 설계가 특징입니다.</p>
                                </div>
                                
                                <div style="background: white; border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <div style="width: 2rem; height: 2rem; background: linear-gradient(135deg, #ff9800, #f57c00); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">3</div>
                                        <h5 style="color: #202124; font-size: 1rem; font-weight: 700;">Gemini</h5>
                                    </div>
                                    <p style="color: #5f6368; font-size: 0.875rem; line-height: 1.4;">Google의 차세대 AI 모델로 멀티모달 기능과 통합성이 강점입니다.</p>
                                </div>
                            </div>
                        </div>

                        <!-- 대안 설정 가이드라인 -->
                        <div style="background: linear-gradient(135deg, #fff3e0 0%, #f3e5f5 100%); border: 1px solid #ffcc02; border-radius: 0.75rem; padding: 1.5rem;">
                            <h5 style="color: #e65100; font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">📝</span>
                                대안 설정 가이드라인
                            </h5>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <ul style="color: #e65100; margin: 0; padding-left: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">실현 가능한 대안들로 구성</li>
                                    <li style="margin-bottom: 0.5rem;">상호 배타적인 대안들 선택</li>
                                    <li>비교 가능한 수준의 대안들</li>
                                </ul>
                                <ul style="color: #e65100; margin: 0; padding-left: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">최소 2개 이상 최대 9개 권장</li>
                                    <li style="margin-bottom: 0.5rem;">각 대안의 특징을 명확히 정의</li>
                                    <li>비용, 시간 등 제약사항 고려</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                4: `
                    <div>
                        <h3 style="color: #202124; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 2rem;">⚖️</span>
                            4단계: 쌍대비교 평가
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">
                            기준별로 대안들을 쌍으로 비교하여 중요도를 평가합니다.
                        </p>

                        <!-- 쌍대비교 매트릭스 -->
                        <div style="background: #f3e5f5; border: 1px solid #ce93d8; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                            <h4 style="color: #7b1fa2; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">📊</span>
                                쌍대비교 매트릭스 예시
                            </h4>
                            <div style="overflow-x: auto; background: white; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: #f8f9fa;">
                                        <tr>
                                            <th style="padding: 0.75rem; text-align: left; font-weight: 700; color: #5f6368; border-bottom: 2px solid #e0e0e0;">비교 기준</th>
                                            <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: #4285f4; border-bottom: 2px solid #e0e0e0;">GPT-4</th>
                                            <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: #34a853; border-bottom: 2px solid #e0e0e0;">Claude</th>
                                            <th style="padding: 0.75rem; text-align: center; font-weight: 700; color: #9c27b0; border-bottom: 2px solid #e0e0e0;">Gemini</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="padding: 0.75rem; font-weight: 600; color: #202124; border-bottom: 1px solid #e0e0e0;">성능</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #4285f4; border-bottom: 1px solid #e0e0e0;">1.0</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #34a853; border-bottom: 1px solid #e0e0e0;">0.8</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #9c27b0; border-bottom: 1px solid #e0e0e0;">0.7</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 0.75rem; font-weight: 600; color: #202124; border-bottom: 1px solid #e0e0e0;">비용</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #4285f4; border-bottom: 1px solid #e0e0e0;">0.6</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #34a853; border-bottom: 1px solid #e0e0e0;">1.0</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #9c27b0; border-bottom: 1px solid #e0e0e0;">0.9</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 0.75rem; font-weight: 600; color: #202124;">사용성</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #4285f4;">0.9</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #34a853;">0.7</td>
                                            <td style="padding: 0.75rem; text-align: center; font-weight: 700; color: #9c27b0;">1.0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 평가 척도와 일관성 -->
                        <div style="display: grid; grid-template-columns: 1fr; lg:grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                            <div style="background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 0.75rem; padding: 1rem;">
                                <h5 style="color: #1565c0; font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.25rem;">🎯</span>
                                    평가 척도
                                </h5>
                                <div style="background: white; border-radius: 0.5rem; padding: 0.75rem;">
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 0.25rem; background: #f8f9fa;">
                                        <span style="font-weight: 600;">9</span>
                                        <span style="font-size: 0.875rem; color: #5f6368;">극히 중요</span>
                                    </div>
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem;">
                                        <span style="font-weight: 600;">7</span>
                                        <span style="font-size: 0.875rem; color: #5f6368;">매우 중요</span>
                                    </div>
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 0.25rem; background: #f8f9fa;">
                                        <span style="font-weight: 600;">5</span>
                                        <span style="font-size: 0.875rem; color: #5f6368;">중요</span>
                                    </div>
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem;">
                                        <span style="font-weight: 600;">3</span>
                                        <span style="font-size: 0.875rem; color: #5f6368;">조금 중요</span>
                                    </div>
                                    <div style="display: flex; justify-content: between; align-items: center; padding: 0.5rem; border-radius: 0.25rem; background: #f8f9fa;">
                                        <span style="font-weight: 600;">1</span>
                                        <span style="font-size: 0.875rem; color: #5f6368;">같음</span>
                                    </div>
                                </div>
                            </div>

                            <div style="background: #e8f5e8; border: 1px solid #c8e6c8; border-radius: 0.75rem; padding: 1rem;">
                                <h5 style="color: #2e7d32; font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.25rem;">✅</span>
                                    일관성 검증
                                </h5>
                                <div style="background: white; border-radius: 0.5rem; padding: 0.75rem;">
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                                        <span style="font-weight: 600;">일관성 비율 (CR)</span>
                                        <span style="font-size: 1.125rem; font-weight: 700; color: #2e7d32;">0.08</span>
                                    </div>
                                    <div style="width: 100%; background: #e0e0e0; border-radius: 9999px; height: 0.75rem; overflow: hidden; margin-bottom: 0.5rem;">
                                        <div style="background: #34a853; height: 100%; width: 20%; border-radius: 9999px;"></div>
                                    </div>
                                    <p style="font-size: 0.875rem; color: #2e7d32; margin: 0;">✓ 우수한 일관성 (0.1 미만)</p>
                                </div>
                                <div style="font-size: 0.75rem; color: #5f6368; margin-top: 0.5rem;">
                                    <p style="margin: 0.25rem 0;">• CR < 0.1: 일관성 우수</p>
                                    <p style="margin: 0.25rem 0;">• CR < 0.2: 일관성 양호</p>
                                    <p style="margin: 0.25rem 0;">• CR >= 0.2: 재평가 필요</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                5: `
                    <div>
                        <h3 style="color: #202124; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 2rem;">📊</span>
                            5단계: 결과 분석
                        </h3>
                        <p style="color: #5f6368; font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">
                            평가 결과를 분석하고 최적의 대안을 도출합니다.
                        </p>

                        <!-- 결과 분석 -->
                        <div style="display: grid; grid-template-columns: 1fr; lg:grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                            <!-- 종합 결과 순위 -->
                            <div style="background: #e8f5e8; border: 1px solid #c8e6c8; border-radius: 0.75rem; padding: 1.5rem;">
                                <h4 style="color: #2e7d32; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.5rem;">🏆</span>
                                    종합 결과 순위
                                </h4>
                                <div>
                                    <div style="background: white; border: 1px solid #c8e6c8; border-radius: 0.5rem; padding: 1rem; margin-bottom: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                        <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 0.5rem;">
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 1.5rem;">🥇</span>
                                                <span style="color: #202124; font-weight: 700;">GPT-4</span>
                                            </div>
                                            <span style="color: #4285f4; font-size: 1.125rem; font-weight: 700;">0.42</span>
                                        </div>
                                        <div style="width: 100%; background: #e0e0e0; border-radius: 9999px; height: 1rem; overflow: hidden;">
                                            <div style="background: #4285f4; height: 100%; width: 85%; border-radius: 9999px; transition: width 1s ease;"></div>
                                        </div>
                                        <p style="font-size: 0.875rem; color: #5f6368; margin: 0.5rem 0 0 0;">전체 기준에서 가장 높은 점수</p>
                                    </div>

                                    <div style="background: white; border: 1px solid #c8e6c8; border-radius: 0.5rem; padding: 1rem; margin-bottom: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                        <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 0.5rem;">
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 1.5rem;">🥈</span>
                                                <span style="color: #202124; font-weight: 700;">Claude</span>
                                            </div>
                                            <span style="color: #34a853; font-size: 1.125rem; font-weight: 700;">0.37</span>
                                        </div>
                                        <div style="width: 100%; background: #e0e0e0; border-radius: 9999px; height: 1rem; overflow: hidden;">
                                            <div style="background: #34a853; height: 100%; width: 75%; border-radius: 9999px; transition: width 1s ease;"></div>
                                        </div>
                                        <p style="font-size: 0.875rem; color: #5f6368; margin: 0.5rem 0 0 0;">비용 효율성이 우수함</p>
                                    </div>

                                    <div style="background: white; border: 1px solid #c8e6c8; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                        <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 0.5rem;">
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <span style="font-size: 1.5rem;">🥉</span>
                                                <span style="color: #202124; font-weight: 700;">Gemini</span>
                                            </div>
                                            <span style="color: #9c27b0; font-size: 1.125rem; font-weight: 700;">0.32</span>
                                        </div>
                                        <div style="width: 100%; background: #e0e0e0; border-radius: 9999px; height: 1rem; overflow: hidden;">
                                            <div style="background: #9c27b0; height: 100%; width: 65%; border-radius: 9999px; transition: width 1s ease;"></div>
                                        </div>
                                        <p style="font-size: 0.875rem; color: #5f6368; margin: 0.5rem 0 0 0;">사용 편의성이 뛰어남</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 의사결정 권고사항 -->
                            <div style="background: #fff8e1; border: 1px solid #ffcc02; border-radius: 0.75rem; padding: 1.5rem;">
                                <h4 style="color: #f57c00; font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.5rem;">💼</span>
                                    의사결정 권고사항
                                </h4>
                                <div>
                                    <div style="background: white; border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem; margin-bottom: 0.75rem;">
                                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                                            <span style="font-size: 1.125rem;">🎯</span>
                                            <div>
                                                <h6 style="color: #202124; font-weight: 700; margin: 0 0 0.25rem 0;">1순위 권장: GPT-4</h6>
                                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0; line-height: 1.4;">종합 성능이 가장 우수하며, 복잡한 작업 처리에 탁월</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="background: white; border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem; margin-bottom: 0.75rem;">
                                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                                            <span style="font-size: 1.125rem;">💰</span>
                                            <div>
                                                <h6 style="color: #202124; font-weight: 700; margin: 0 0 0.25rem 0;">2순위 권장: Claude</h6>
                                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0; line-height: 1.4;">비용 대비 성능이 우수하며, 예산이 중요한 경우 추천</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="background: linear-gradient(135deg, #fff8e1 0%, #f3e5f5 100%); border: 1px solid #ffcc02; border-radius: 0.5rem; padding: 1rem;">
                                        <div style="display: flex; align-items: start; gap: 0.75rem;">
                                            <span style="font-size: 1.125rem;">💡</span>
                                            <div>
                                                <h6 style="color: #f57c00; font-weight: 700; margin: 0 0 0.5rem 0;">종합 결론</h6>
                                                <p style="color: #f57c00; font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                                    프로젝트 규모와 예산을 종합적으로 고려하여 GPT-4를 우선 검토하되, 
                                                    비용이 중요한 경우 Claude를 대안으로 고려하는 것이 최적의 전략입니다.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 추가 분석 도구 -->
                        <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 0.75rem; padding: 1.5rem; margin-top: 1.5rem;">
                            <h5 style="color: #202124; font-size: 1rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">📋</span>
                                추가 분석 도구
                            </h5>
                            <div style="display: grid; grid-template-columns: 1fr; md:grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                                <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e0e0e0; text-align: center; cursor: pointer;" onmouseover="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                                    <span style="font-size: 1.5rem;">📈</span>
                                    <h6 style="color: #202124; font-weight: 600; margin: 0.5rem 0;">민감도 분석</h6>
                                    <p style="color: #5f6368; font-size: 0.875rem; margin: 0;">가중치 변화 영향도</p>
                                </div>
                                
                                <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e0e0e0; text-align: center; cursor: pointer;" onmouseover="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                                    <span style="font-size: 1.5rem;">📊</span>
                                    <h6 style="color: #202124; font-weight: 600; margin: 0.5rem 0;">Excel 내보내기</h6>
                                    <p style="color: #5f6368; font-size: 0.875rem; margin: 0;">상세 데이터 분석</p>
                                </div>
                                
                                <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e0e0e0; text-align: center; cursor: pointer;" onmouseover="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                                    <span style="font-size: 1.5rem;">📄</span>
                                    <h6 style="color: #202124; font-weight: 600; margin: 0.5rem 0;">PDF 보고서</h6>
                                    <p style="color: #5f6368; font-size: 0.875rem; margin: 0;">의사결정 문서화</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            };

            return contents[step] || contents[1];
        }

        /**
         * 사용자 가이드 초기화
         */
        function setupUserGuide() {
            // 초기화 로직 (필요한 경우)
            console.log('🎯 사용자 가이드 초기화 완료');
        }

        /**
         * 가이드 홈으로 돌아가기
         */
        function backToGuideHome() {
            const contentArea = document.getElementById('guideContentArea');
            contentArea.innerHTML = '';
        }

        /**
         * 가이드 섹션 표시
         */
        function showGuideSection(section) {
            // 네비게이션 버튼 업데이트
            document.querySelectorAll('.guide-nav-btn').forEach(btn => {
                btn.style.background = '#f8f9fa';
                btn.style.color = '#5f6368';
                btn.style.border = '1px solid #dadce0';
            });
            
            const activeBtn = document.querySelector(`[data-section="${section}"]`);
            if (activeBtn) {
                activeBtn.style.background = '#4285f4';
                activeBtn.style.color = 'white';
                activeBtn.style.border = 'none';
            }

            // 콘텐츠 업데이트
            const contentArea = document.getElementById('guideSectionContent');
            switch(section) {
                case 'overview':
                    contentArea.innerHTML = generateOverviewSection();
                    break;
                case 'researcher':
                    contentArea.innerHTML = generateResearcherSection();
                    break;
                case 'evaluator':
                    contentArea.innerHTML = generateEvaluatorSection();
                    break;
                case 'demo':
                    contentArea.innerHTML = generateDemoSection();
                    break;
            }
        }

        /**
         * 단계별 가이드 초기화
         */
        function setupStepByStepGuide() {
            window.currentStep = 1;
            updateStepNavigation();
        }

        /**
         * 단계 표시
         */
        function showStep(step) {
            window.currentStep = step;
            
            // 콘텐츠 업데이트
            const contentArea = document.getElementById('stepContent');
            contentArea.innerHTML = generateStepContent(step);
            
            updateStepNavigation();
        }

        /**
         * 이전 단계
         */
        function prevStep() {
            if (window.currentStep > 1) {
                showStep(window.currentStep - 1);
            }
        }

        /**
         * 다음 단계
         */
        function nextStep() {
            if (window.currentStep < 5) {
                showStep(window.currentStep + 1);
            }
        }

        /**
         * 단계 네비게이션 업데이트
         */
        function updateStepNavigation() {
            const currentStep = window.currentStep || 1;
            
            // 네비게이션 버튼 업데이트
            document.querySelectorAll('.step-nav-btn').forEach(btn => {
                btn.style.background = '#f8f9fa';
                btn.style.color = '#5f6368';
                btn.style.border = '1px solid #dadce0';
            });
            
            const activeBtn = document.querySelector(`[data-step="${currentStep}"]`);
            if (activeBtn) {
                activeBtn.style.background = '#4285f4';
                activeBtn.style.color = 'white';
                activeBtn.style.border = 'none';
            }

            // 진행률 업데이트
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const currentStepDisplay = document.getElementById('currentStepDisplay');
            
            if (progressBar) {
                progressBar.style.width = `${(currentStep / 5) * 100}%`;
            }
            if (progressText) {
                progressText.textContent = `${currentStep}/5 단계`;
            }
            if (currentStepDisplay) {
                currentStepDisplay.textContent = currentStep;
            }

            // 버튼 표시/숨김
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const completeBtn = document.getElementById('completeBtn');
            
            if (prevBtn) {
                prevBtn.style.display = currentStep === 1 ? 'none' : 'block';
            }
            if (nextBtn) {
                nextBtn.style.display = currentStep === 5 ? 'none' : 'block';
            }
            if (completeBtn) {
                completeBtn.style.display = currentStep === 5 ? 'block' : 'none';
            }
        }

        // =========================
        // 평가자 관리 전 인구통계학적 설문조사 (동일한 구현)
        // =========================

        /**
         * 평가자 관리 전 설문조사 콘텐츠 생성 (구글 폼 스타일)
         */
        function generateEvaluatorPreSurveyContent() {
            return `
                <div class="demographic-survey-container" style="max-width: 800px; margin: 0 auto; background: #f8f9fa; min-height: 100vh; padding: 2rem 1rem;">
                    <!-- 구글 폼 스타일 헤더 -->
                    <div style="background: #ffffff; border-radius: 8px; padding: 2rem; margin-bottom: 1rem; border-top: 8px solid #8b5cf6; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                        <h1 style="color: #202124; font-size: 2rem; font-weight: 400; margin: 0 0 0.5rem 0; line-height: 1.2;">👥 평가자 인구통계학적 설문조사</h1>
                        <p style="color: #5f6368; font-size: 0.875rem; margin: 0; line-height: 1.4;">평가자 관리를 시작하기 전에 기본 인구통계 정보를 수집합니다. 모든 정보는 익명으로 처리되며, 응답은 약 5-10분 소요됩니다. <span style="color: #d93025;">*</span> 표시는 필수 응답 항목입니다.</p>
                        <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
                            <p style="color: #856404; font-size: 0.875rem; margin: 0; font-weight: 500;">
                                📋 이 설문조사를 완료하면 평가자 관리 단계로 자동 진행됩니다.
                            </p>
                        </div>
                    </div>

                    <form id="evaluatorDemographicSurveyForm">
                        <!-- 기본 정보 섹션 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <!-- 연령대 -->
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                    1. 귀하의 연령대를 선택해주세요 <span style="color: #d93025;">*</span>
                                </label>
                                <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                    예시: 20대 후반, 30대 초반, 40대 중반 등
                                </p>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="evaluatorAgeGroup" value="20-29" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                        <span style="color: #202124; font-size: 0.875rem;">20대 (20-29세)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="evaluatorAgeGroup" value="30-39" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                        <span style="color: #202124; font-size: 0.875rem;">30대 (30-39세)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="evaluatorAgeGroup" value="40-49" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                        <span style="color: #202124; font-size: 0.875rem;">40대 (40-49세)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="evaluatorAgeGroup" value="50-59" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                        <span style="color: #202124; font-size: 0.875rem;">50대 (50-59세)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="evaluatorAgeGroup" value="60+" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                        <span style="color: #202124; font-size: 0.875rem;">60세 이상</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 성별 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                2. 성별을 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 남성, 여성, 또는 개인정보 보호를 위해 응답하지 않을 수 있습니다
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorGender" value="male" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">남성</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorGender" value="female" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">여성</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorGender" value="prefer-not-to-say" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">응답하지 않음</span>
                                </label>
                            </div>
                        </div>

                        <!-- 최종 학력 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                3. 최종 학력을 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 서울대 컴퓨터공학과 학사, KAIST 경영학 석사, 연세대 의학 박사 등
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorEducation" value="high-school" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">고등학교 졸업</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorEducation" value="bachelor" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">학사 (대학교 졸업)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorEducation" value="master" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">석사 (대학원 졸업)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorEducation" value="phd" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">박사 (박사과정 수료 또는 졸업)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorEducation" value="other" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">기타</span>
                                </label>
                            </div>
                        </div>

                        <!-- 직업 분야 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                4. 현재 종사하고 있는 직업 분야를 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 삼성전자 SW개발자, 서울대병원 의사, 공무원 9급 등
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="academic" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">교육/연구 (교수, 연구원, 교사 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="business" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">경영/사업 (CEO, 매니저, 기획자 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="engineering" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">공학/기술 (개발자, 엔지니어, 디자이너 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="healthcare" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">의료/보건 (의사, 간호사, 약사 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="government" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">공공/행정 (공무원, 공기업 직원 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="consulting" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">컨설팅 (경영컨설턴트, 전문컨설턴트 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="finance" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">금융 (은행원, 증권사, 보험사 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="student" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">학생 (대학생, 대학원생 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorOccupation" value="other" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">기타</span>
                                </label>
                            </div>
                        </div>

                        <!-- 근무 경력 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                5. 해당 분야 총 근무 경력을 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 신입사원(1년 미만), 주임급(3년차), 과장급(7년차) 등
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorExperience" value="0-2" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">0-2년 (신입 ~ 사원급)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorExperience" value="3-5" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">3-5년 (주임 ~ 대리급)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorExperience" value="6-10" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">6-10년 (과장 ~ 차장급)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorExperience" value="11-15" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">11-15년 (부장 ~ 이사급)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorExperience" value="16+" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">16년 이상 (임원급 이상)</span>
                                </label>
                            </div>
                        </div>

                        <!-- AHP 사용 경험 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                6. AHP(계층화 분석법) 사용 경험을 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 논문 작성 시 1회 사용, 회사 프로젝트에서 3회 사용, 컨설팅에서 전문적 활용 등
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorAhpExperience" value="none" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">경험 없음 (이번이 처음)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorAhpExperience" value="basic" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">기본적인 이해 (이론적 지식만 보유)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorAhpExperience" value="intermediate" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">중급 (1-3회 실제 사용 경험)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="radio" name="evaluatorAhpExperience" value="advanced" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">고급 (4회 이상 전문적 활용)</span>
                                </label>
                            </div>
                        </div>

                        <!-- 의사결정 도구 사용 목적 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                7. 의사결정 도구 사용 목적을 모두 선택해주세요 <span style="color: #d93025;">*</span>
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: 박사 논문 연구, 신제품 출시 결정, 개인 주택 구매 결정 등 (복수 선택 가능)
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="checkbox" name="evaluatorUsagePurpose" value="research" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">학술 연구 (논문, 연구 프로젝트 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="checkbox" name="evaluatorUsagePurpose" value="business" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">비즈니스 의사결정 (투자, 전략 수립 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="checkbox" name="evaluatorUsagePurpose" value="personal" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">개인적 의사결정 (구매, 선택 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="checkbox" name="evaluatorUsagePurpose" value="education" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">교육/학습 (수업, 교육 자료 등)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 0.75rem; border-radius: 4px; transition: background-color 0.2s;">
                                    <input type="checkbox" name="evaluatorUsagePurpose" value="consulting" style="margin-right: 0.75rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span style="color: #202124; font-size: 0.875rem;">컨설팅 프로젝트 (고객 의사결정 지원 등)</span>
                                </label>
                            </div>
                        </div>

                        <!-- 추가 의견 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <label style="display: block; color: #202124; font-size: 1rem; font-weight: 400; margin-bottom: 0.5rem; line-height: 1.5;">
                                8. 추가 의견이나 건의사항이 있으시면 자유롭게 작성해주세요 (선택사항)
                            </label>
                            <p style="color: #5f6368; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                                예시: "UI가 더 직관적이었으면", "엑셀 연동 기능 필요", "모바일 버전 개발 요청" 등
                            </p>
                            <textarea id="evaluatorComments" rows="4" placeholder="AHP 시스템에 대한 의견, 개선 제안사항, 사용 중 불편했던 점 등을 자유롭게 작성해주세요." 
                                      style="width: 100%; padding: 0.75rem; border: 1px solid #dadce0; border-radius: 4px; font-size: 0.875rem; font-family: inherit; resize: vertical; background: #ffffff; color: #202124; line-height: 1.4;" 
                                      onfocus="this.style.borderColor='#8b5cf6'; this.style.outline='none';" 
                                      onblur="this.style.borderColor='#dadce0';"></textarea>
                        </div>

                        <!-- 동의 확인 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);">
                            <div style="border: 1px solid #dadce0; border-radius: 4px; padding: 1rem; background: #f8f9fa;">
                                <label style="display: flex; align-items: flex-start; cursor: pointer; color: #202124; font-size: 0.875rem; line-height: 1.4;">
                                    <input type="checkbox" id="evaluatorAgreeToTerms" style="margin-right: 0.75rem; margin-top: 0.125rem; accent-color: #8b5cf6;" onchange="highlightEvaluatorSelection(this)">
                                    <span>
                                        <strong style="color: #d93025;">개인정보 수집 및 이용 동의 (필수)</strong><br>
                                        수집된 정보는 평가자 관리 및 연구 목적으로만 사용되며, 개인을 식별할 수 없도록 익명화하여 처리됩니다. 
                                        연구 완료 후 모든 개인정보는 안전하게 폐기됩니다. 
                                        수집 항목: 연령대, 성별, 학력, 직업, 경력, AHP 경험, 사용 목적, 의견사항
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- 제출 버튼 -->
                        <div style="background: #ffffff; border-radius: 8px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); text-align: left;">
                            <button type="button" onclick="submitEvaluatorDemographicSurvey()" id="evaluatorSubmitButton"
                                    style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.3s; margin-right: 1rem;"
                                    onmouseover="this.style.background='#7c3aed'; this.style.boxShadow='0 2px 8px rgba(139,92,246,0.3)'"
                                    onmouseout="this.style.background='#8b5cf6'; this.style.boxShadow='none'">
                                설문조사 제출하고 평가자 관리로 이동
                            </button>
                            <button type="button" onclick="clearEvaluatorForm()" 
                                    style="background: transparent; color: #8b5cf6; border: 1px solid #8b5cf6; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.3s;"
                                    onmouseover="this.style.background='#8b5cf6'; this.style.color='white'"
                                    onmouseout="this.style.background='transparent'; this.style.color='#8b5cf6'">
                                양식 지우기
                            </button>
                            <p style="color: #5f6368; font-size: 0.75rem; margin: 1rem 0 0 0; line-height: 1.4;">
                                🔒 제출된 정보는 SSL로 암호화하여 전송되며, 평가자 관리 및 연구 목적으로만 활용됩니다. 
                                개인정보보호법에 따라 안전하게 관리됩니다.
                            </p>
                        </div>
                    </form>
                </div>
            `;
        }

        /**
         * 평가자 설문조사 초기화
         */
        function setupEvaluatorPreSurvey() {
            console.log('👥 평가자 인구통계학적 설문조사 초기화');
            
            // 기존 설문 데이터 확인
            checkExistingEvaluatorSurveyData();
        }

        /**
         * 평가자 기존 설문 데이터 확인
         */
        async function checkExistingEvaluatorSurveyData() {
            try {
                // 사용자가 이미 설문을 완료했는지 확인
                const existingSurvey = await window.ahpApi.getUserDemographicData();
                if (existingSurvey.success && existingSurvey.data) {
                    showExistingEvaluatorSurveyMessage();
                }
            } catch (error) {
                console.log('👥 신규 평가자 설문조사 사용자');
            }
        }

        /**
         * 평가자 기존 설문 완료 메시지 표시
         */
        function showExistingEvaluatorSurveyMessage() {
            const form = document.getElementById('evaluatorDemographicSurveyForm');
            if (form) {
                form.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1.5rem;">✅</div>
                        <h3 style="color: #10b981; margin-bottom: 1rem;">설문조사 완료됨</h3>
                        <p style="color: #6b7280; margin-bottom: 2rem;">이미 인구통계학적 설문조사를 완료하셨습니다.<br>바로 평가자 관리를 시작하겠습니다.</p>
                        <button onclick="proceedToEvaluatorManagement()" 
                                style="background: #8b5cf6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">
                            평가자 관리 시작
                        </button>
                    </div>
                `;
            }
        }

        /**
         * 평가자용 구글 폼 스타일 선택 하이라이트 효과
         */
        function highlightEvaluatorSelection(element) {
            // 선택된 항목의 부모 label 하이라이트
            const label = element.closest('label');
            if (label) {
                // 같은 그룹의 다른 선택 항목들 하이라이트 제거
                const groupName = element.name;
                if (groupName) {
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(input => {
                        const parentLabel = input.closest('label');
                        if (parentLabel) {
                            parentLabel.style.backgroundColor = 'transparent';
                        }
                    });
                }
                
                // 현재 선택된 항목 하이라이트
                if (element.checked) {
                    label.style.backgroundColor = '#f3f4f6';
                    label.style.borderColor = '#8b5cf6';
                } else {
                    label.style.backgroundColor = 'transparent';
                }
            }
        }

        /**
         * 평가자 양식 지우기 함수
         */
        function clearEvaluatorForm() {
            if (confirm('모든 입력 내용을 지우시겠습니까?')) {
                const form = document.getElementById('evaluatorDemographicSurveyForm');
                if (form) {
                    // 모든 입력 필드 초기화
                    form.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                        input.checked = false;
                        const label = input.closest('label');
                        if (label) {
                            label.style.backgroundColor = 'transparent';
                        }
                    });
                    
                    // 텍스트 영역 초기화
                    const commentsTextarea = document.getElementById('evaluatorComments');
                    if (commentsTextarea) {
                        commentsTextarea.value = '';
                    }
                    
                    console.log('👥 평가자 설문조사 양식이 초기화되었습니다.');
                }
            }
        }

        /**
         * 평가자 설문조사 제출 처리
         */
        async function submitEvaluatorDemographicSurvey() {
            const form = document.getElementById('evaluatorDemographicSurveyForm');
            if (!form) return;

            // 필수 항목 확인
            const ageGroup = document.querySelector('input[name="evaluatorAgeGroup"]:checked');
            const gender = document.querySelector('input[name="evaluatorGender"]:checked');
            const education = document.querySelector('input[name="evaluatorEducation"]:checked');
            const occupation = document.querySelector('input[name="evaluatorOccupation"]:checked');
            const experience = document.querySelector('input[name="evaluatorExperience"]:checked');
            const ahpExperience = document.querySelector('input[name="evaluatorAhpExperience"]:checked');
            const agreeToTerms = document.getElementById('evaluatorAgreeToTerms').checked;

            // 구글 폼 스타일 유효성 검사 및 오류 표시
            const showEvaluatorValidationError = (message, inputElement = null) => {
                // 구글 폼 스타일 오류 표시
                alert(`❗ ${message}`);
                
                // 해당 섹션으로 스크롤
                if (inputElement) {
                    inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // 오류 표시를 위한 스타일 적용
                    const container = inputElement.closest('div[style*="background: #ffffff"]');
                    if (container) {
                        container.style.border = '2px solid #d93025';
                        container.style.backgroundColor = '#fef7f0';
                        
                        // 3초 후 원래 스타일로 복원
                        setTimeout(() => {
                            container.style.border = 'none';
                            container.style.backgroundColor = '#ffffff';
                        }, 3000);
                    }
                }
            };

            // 유효성 검사
            if (!ageGroup) {
                showEvaluatorValidationError('1번 질문: 연령대를 선택해주세요.', document.querySelector('input[name="evaluatorAgeGroup"]'));
                return;
            }
            if (!gender) {
                showEvaluatorValidationError('2번 질문: 성별을 선택해주세요.', document.querySelector('input[name="evaluatorGender"]'));
                return;
            }
            if (!education) {
                showEvaluatorValidationError('3번 질문: 최종 학력을 선택해주세요.', document.querySelector('input[name="evaluatorEducation"]'));
                return;
            }
            if (!occupation) {
                showEvaluatorValidationError('4번 질문: 직업 분야를 선택해주세요.', document.querySelector('input[name="evaluatorOccupation"]'));
                return;
            }
            if (!experience) {
                showEvaluatorValidationError('5번 질문: 근무 경력을 선택해주세요.', document.querySelector('input[name="evaluatorExperience"]'));
                return;
            }
            if (!ahpExperience) {
                showEvaluatorValidationError('6번 질문: AHP 사용 경험을 선택해주세요.', document.querySelector('input[name="evaluatorAhpExperience"]'));
                return;
            }

            // 사용 목적 확인 (최소 1개 선택 필요)
            const usagePurposeElements = document.querySelectorAll('input[name="evaluatorUsagePurpose"]:checked');
            if (usagePurposeElements.length === 0) {
                showEvaluatorValidationError('7번 질문: 의사결정 도구 사용 목적을 최소 1개 이상 선택해주세요.', document.querySelector('input[name="evaluatorUsagePurpose"]'));
                return;
            }

            if (!agreeToTerms) {
                showEvaluatorValidationError('개인정보 수집 및 이용 동의가 필요합니다.', document.getElementById('evaluatorAgreeToTerms'));
                return;
            }

            // 사용 목적 수집 (복수선택)
            const usagePurpose = Array.from(usagePurposeElements).map(el => el.value);

            // 설문 데이터 구성
            const surveyData = {
                age_group: ageGroup.value,
                gender: gender.value,
                education: education.value,
                occupation: occupation.value,
                experience: experience.value,
                ahp_experience: ahpExperience.value,
                usage_purpose: usagePurpose,
                comments: document.getElementById('evaluatorComments').value.trim(),
                submitted_at: new Date().toISOString(),
                survey_type: 'evaluator_pre_survey' // 평가자 사전 설문조사 구분
            };

            try {
                console.log('👥 평가자 설문조사 제출:', surveyData);
                
                // 제출 버튼 비활성화 및 로딩 표시
                const submitBtn = form.querySelector('button');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '제출 중...';
                submitBtn.disabled = true;

                // API 호출
                const result = await window.ahpApi.submitDemographicSurvey(surveyData);

                if (result.success) {
                    // 성공 후 평가자 관리로 자동 이동
                    console.log('✅ 평가자 설문조사 제출 성공 - 평가자 관리로 이동');
                    
                    // 성공 메시지 잠깐 표시 후 이동
                    alert('✅ 설문조사가 성공적으로 제출되었습니다!\n평가자 관리를 시작합니다.');
                    
                    // 평가자 관리로 이동
                    proceedToEvaluatorManagement();
                } else {
                    throw new Error(result.message || '설문조사 제출에 실패했습니다.');
                }

            } catch (error) {
                console.error('❌ 평가자 설문조사 제출 오류:', error);
                alert('설문조사 제출 중 오류가 발생했습니다. 다시 시도해주세요.');
                
                // 버튼 복구
                const submitBtn = form.querySelector('button');
                if (submitBtn) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }
        }

        /**
         * 평가자 관리로 이동
         */
        function proceedToEvaluatorManagement() {
            console.log('👥 평가자 관리 시작');
            
            // 실제 평가자 관리 콘텐츠 로드
            handleMenuClick('evaluator-management', null);
        }
        
        /**
         * 평가자 관리 완료 후 분석 결과로 이동
         */
        function completeEvaluatorManagement() {
            console.log('✅ 평가자 관리 완료 - 분석 결과로 이동');
            
            // 완료 메시지 표시
            showMessage('✅ 평가자 관리가 완료되었습니다!\n🔄 분석 결과 단계로 이동합니다...', 'success');
            
            // 2초 후 분석 결과로 자동 이동
            setTimeout(() => {
                console.log('🚀 평가자 관리 완료 - 분석 결과로 이동');
                handleMenuClick('results-analysis', null);
            }, 2000);
        }

        // =========================
        // 모델구축 JavaScript 함수들
        // =========================

        /**
         * 모델구축 초기화
         */
        function setupModelBuilding() {
            console.log('🏗️ 모델구축 시스템 초기화');
            
            // 초기 탭 콘텐츠 로드
            const contentContainer = document.getElementById('model-tab-content');
            if (contentContainer) {
                contentContainer.innerHTML = generateCriteriaTabContent();
            }
            
            // 초기 데이터 로드
            loadModelData();
            updateModelStatus();
        }

        /**
         * 탭 내용 생성 함수들
         */
        function generateCriteriaTabContent() {
            return `
                <div id="criteria-tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1f2937; margin: 0;">📊 평가 기준 관리</h3>
                        <button onclick="addRootCriterion()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            + 주기준 추가
                        </button>
                    </div>

                    <div id="criteria-hierarchy-container">
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center; border: 2px dashed #d1d5db;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                            <h4 style="color: #374151; margin-bottom: 1rem;">평가 기준이 없습니다</h4>
                            <p style="color: #6b7280; margin-bottom: 2rem;">
                                AHP 분석을 위한 평가 기준을 추가해주세요.<br>
                                최소 2개 이상의 기준이 필요합니다.
                            </p>
                            <button onclick="addRootCriterion()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                                첫 번째 기준 추가하기
                            </button>
                        </div>
                    </div>

                    <!-- 기준 추가 폼 (숨김 상태) -->
                    <div id="criterion-form" style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <h4 style="color: #1f2937; margin-bottom: 1rem;">새 기준 추가</h4>
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">기준명 *</label>
                                <input type="text" id="criterion-name" placeholder="예: 비용 효율성" 
                                       style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">설명 (선택사항)</label>
                                <textarea id="criterion-description" placeholder="기준에 대한 자세한 설명을 입력하세요" 
                                          style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <button onclick="saveCriterion()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    ✅ 저장
                                </button>
                                <button onclick="cancelCriterionForm()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                    ❌ 취소
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateAlternativesTabContent() {
            return `
                <div id="alternatives-tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1f2937; margin: 0;">🎯 대안 관리</h3>
                        <button onclick="addAlternative()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            + 대안 추가
                        </button>
                    </div>

                    <div id="alternatives-container">
                        <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center; border: 2px dashed #d1d5db;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🎯</div>
                            <h4 style="color: #374151; margin-bottom: 1rem;">대안이 없습니다</h4>
                            <p style="color: #6b7280; margin-bottom: 2rem;">
                                비교 평가할 대안들을 추가해주세요.<br>
                                최소 2개 이상의 대안이 필요합니다.
                            </p>
                            <button onclick="addAlternative()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                                첫 번째 대안 추가하기
                            </button>
                        </div>
                    </div>

                    <!-- 대안 추가 폼 (숨김 상태) -->
                    <div id="alternative-form" style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: #f8fafc; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <h4 style="color: #1f2937; margin-bottom: 1rem;">새 대안 추가</h4>
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">대안명 *</label>
                                <input type="text" id="alternative-name" placeholder="예: 대안 A" 
                                       style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">설명 (선택사항)</label>
                                <textarea id="alternative-description" placeholder="대안에 대한 자세한 설명을 입력하세요" 
                                          style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <button onclick="saveAlternative()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    ✅ 저장
                                </button>
                                <button onclick="cancelAlternativeForm()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                    ❌ 취소
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateHierarchyTabContent() {
            return `
                <div id="hierarchy-tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1f2937; margin: 0;">🏗️ 계층구조 시각화</h3>
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="autoLayoutHierarchy()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                🔄 자동 정렬
                            </button>
                            <button onclick="exportHierarchy()" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                💾 내보내기
                            </button>
                        </div>
                    </div>

                    <div id="hierarchy-visualization" style="background: #f8fafc; padding: 2rem; border-radius: 8px; min-height: 400px; border: 1px solid #e5e7eb;">
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">🏗️</div>
                            <h4 style="color: #374151; margin-bottom: 1rem;">계층구조를 생성해주세요</h4>
                            <p style="color: #6b7280;">
                                먼저 평가 기준과 대안을 추가한 후<br>
                                계층구조를 시각화할 수 있습니다.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSettingsTabContent() {
            return `
                <div id="settings-tab-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #1f2937; margin: 0;">⚙️ 모델 설정</h3>
                        <button onclick="resetModelSettings()" style="background: #ef4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            🔄 설정 초기화
                        </button>
                    </div>

                    <div style="display: grid; gap: 2rem;">
                        <!-- 기본 설정 -->
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <h4 style="color: #1f2937; margin-bottom: 1rem;">🎯 기본 설정</h4>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">모델명</label>
                                    <input type="text" id="model-name" placeholder="새 AHP 모델" 
                                           style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">목표/목적</label>
                                    <textarea id="model-objective" placeholder="이 AHP 모델의 목표를 설명해주세요" 
                                              style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; min-height: 80px; resize: vertical;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- AHP 설정 -->
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <h4 style="color: #1f2937; margin-bottom: 1rem;">⚖️ AHP 분석 설정</h4>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">일관성 임계값</label>
                                    <select id="consistency-threshold" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                        <option value="0.1">0.1 (표준)</option>
                                        <option value="0.15">0.15 (관대)</option>
                                        <option value="0.05">0.05 (엄격)</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">가중치 계산 방법</label>
                                    <select id="weight-method" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                        <option value="geometric">기하평균법 (권장)</option>
                                        <option value="eigenvalue">고유벡터법</option>
                                        <option value="arithmetic">산술평균법</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 저장 및 적용 -->
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="saveModelSettings()" style="background: #10b981; color: white; border: none; padding: 1rem 2rem; border-radius: 6px; cursor: pointer; font-weight: 600; flex: 1;">
                                ✅ 설정 저장
                            </button>
                            <button onclick="previewModel()" style="background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 6px; cursor: pointer; flex: 1;">
                                👁️ 모델 미리보기
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * 탭 전환 함수
         */
        function switchModelTab(tabName) {
            console.log(`🏗️ 모델 탭 전환: ${tabName}`);
            
            // 모든 탭 버튼 스타일 초기화
            const tabButtons = ['criteria', 'alternatives', 'evaluation', 'hierarchy', 'settings'];
            tabButtons.forEach(tab => {
                const button = document.getElementById(`model-tab-${tab}`);
                if (button) {
                    button.style.color = '#6b7280';
                    button.style.borderBottom = '2px solid transparent';
                    button.style.fontWeight = 'normal';
                }
            });
            
            // 선택된 탭 버튼 활성화
            const activeButton = document.getElementById(`model-tab-${tabName}`);
            if (activeButton) {
                activeButton.style.color = '#3b82f6';
                activeButton.style.borderBottom = '2px solid #3b82f6';
                activeButton.style.fontWeight = '600';
            }
            
            // 탭 콘텐츠 변경
            const contentContainer = document.getElementById('model-tab-content');
            if (contentContainer) {
                switch(tabName) {
                    case 'criteria':
                        contentContainer.innerHTML = generateCriteriaTabContent();
                        break;
                    case 'alternatives':
                        contentContainer.innerHTML = generateAlternativesTabContent();
                        break;
                    case 'evaluation':
                        contentContainer.innerHTML = generateEvaluationTabContent();
                        initializeEvaluationTab();
                        break;
                    case 'hierarchy':
                        contentContainer.innerHTML = generateHierarchyTabContent();
                        updateHierarchyVisualization();
                        break;
                    case 'settings':
                        contentContainer.innerHTML = generateSettingsTabContent();
                        loadModelSettings();
                        break;
                }
            }
        }

        /**
         * 모델 데이터 관리 함수들
         */
        let currentModelData = {
            criteria: [],
            alternatives: [],
            settings: {
                name: '새 AHP 모델',
                objective: '',
                consistencyThreshold: 0.1,
                weightMethod: 'geometric'
            }
        };

        function loadModelData() {
            console.log('📊 모델 데이터 로드');
            // 실제 구현에서는 API에서 데이터를 가져옴
            updateModelStatus();
        }

        function updateModelStatus() {
            const criteriaCount = currentModelData.criteria.length;
            const alternativesCount = currentModelData.alternatives.length;
            const completion = calculateModelCompletion();
            const isValid = criteriaCount >= 2 && alternativesCount >= 2;
            
            // UI 업데이트
            const criteriaCountEl = document.getElementById('criteria-count');
            const alternativesCountEl = document.getElementById('alternatives-count');
            const completionEl = document.getElementById('model-completion');
            const statusEl = document.getElementById('model-status');
            
            if (criteriaCountEl) criteriaCountEl.textContent = criteriaCount;
            if (alternativesCountEl) alternativesCountEl.textContent = alternativesCount;
            if (completionEl) completionEl.textContent = completion + '%';
            if (statusEl) statusEl.textContent = isValid ? '✅' : '❌';
        }

        function calculateModelCompletion() {
            const hasBasicData = currentModelData.criteria.length >= 2 && currentModelData.alternatives.length >= 2;
            const hasSettings = currentModelData.settings.name && currentModelData.settings.objective;
            
            let completion = 0;
            if (currentModelData.criteria.length > 0) completion += 25;
            if (currentModelData.alternatives.length > 0) completion += 25;
            if (hasBasicData) completion += 25;
            if (hasSettings) completion += 25;
            
            return completion;
        }

        /**
         * 기준 관리 함수들
         */
        function addRootCriterion() {
            console.log('📊 주기준 추가 폼 표시');
            const form = document.getElementById('criterion-form');
            if (form) {
                form.style.display = 'block';
                document.getElementById('criterion-name').focus();
            }
        }

        function saveCriterion() {
            const name = document.getElementById('criterion-name').value.trim();
            const description = document.getElementById('criterion-description').value.trim();
            
            if (!name) {
                alert('기준명을 입력해주세요.');
                return;
            }
            
            // 새 기준 추가
            const newCriterion = {
                id: `criterion_${Date.now()}`,
                name: name,
                description: description,
                level: 1,
                children: []
            };
            
            currentModelData.criteria.push(newCriterion);
            
            // 폼 초기화 및 숨김
            document.getElementById('criterion-name').value = '';
            document.getElementById('criterion-description').value = '';
            document.getElementById('criterion-form').style.display = 'none';
            
            // UI 업데이트
            renderCriteriaList();
            updateModelStatus();
            
            console.log('✅ 기준 추가됨:', newCriterion);
        }

        function cancelCriterionForm() {
            document.getElementById('criterion-name').value = '';
            document.getElementById('criterion-description').value = '';
            document.getElementById('criterion-form').style.display = 'none';
        }

        function renderCriteriaList() {
            const container = document.getElementById('criteria-hierarchy-container');
            if (!container) return;
            
            if (currentModelData.criteria.length === 0) {
                container.innerHTML = `
                    <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center; border: 2px dashed #d1d5db;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                        <h4 style="color: #374151; margin-bottom: 1rem;">평가 기준이 없습니다</h4>
                        <p style="color: #6b7280; margin-bottom: 2rem;">
                            AHP 분석을 위한 평가 기준을 추가해주세요.<br>
                            최소 2개 이상의 기준이 필요합니다.
                        </p>
                        <button onclick="addRootCriterion()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            첫 번째 기준 추가하기
                        </button>
                    </div>
                `;
            } else {
                const criteriaHtml = currentModelData.criteria.map((criterion, index) => `
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="background: #3b82f6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 600;">
                                        기준 ${index + 1}
                                    </span>
                                    <h4 style="color: #1f2937; margin: 0; font-size: 1.1rem;">${criterion.name}</h4>
                                </div>
                                ${criterion.description ? `<p style="color: #6b7280; margin: 0; font-size: 0.9rem;">${criterion.description}</p>` : ''}
                            </div>
                            <div style="display: flex; gap: 0.5rem; margin-left: 1rem;">
                                <button onclick="editCriterion('${criterion.id}')" style="background: #f59e0b; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    ✏️
                                </button>
                                <button onclick="deleteCriterion('${criterion.id}')" style="background: #ef4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = criteriaHtml;
            }
        }

        /**
         * 대안 관리 함수들
         */
        function addAlternative() {
            console.log('🎯 대안 추가 폼 표시');
            const form = document.getElementById('alternative-form');
            if (form) {
                form.style.display = 'block';
                document.getElementById('alternative-name').focus();
            }
        }

        function saveAlternative() {
            const name = document.getElementById('alternative-name').value.trim();
            const description = document.getElementById('alternative-description').value.trim();
            
            if (!name) {
                alert('대안명을 입력해주세요.');
                return;
            }
            
            // 새 대안 추가
            const newAlternative = {
                id: `alternative_${Date.now()}`,
                name: name,
                description: description
            };
            
            currentModelData.alternatives.push(newAlternative);
            
            // 폼 초기화 및 숨김
            document.getElementById('alternative-name').value = '';
            document.getElementById('alternative-description').value = '';
            document.getElementById('alternative-form').style.display = 'none';
            
            // UI 업데이트
            renderAlternativesList();
            updateModelStatus();
            
            console.log('✅ 대안 추가됨:', newAlternative);
        }

        function cancelAlternativeForm() {
            document.getElementById('alternative-name').value = '';
            document.getElementById('alternative-description').value = '';
            document.getElementById('alternative-form').style.display = 'none';
        }

        function renderAlternativesList() {
            const container = document.getElementById('alternatives-container');
            if (!container) return;
            
            if (currentModelData.alternatives.length === 0) {
                container.innerHTML = `
                    <div style="background: #f8fafc; padding: 2rem; border-radius: 8px; text-align: center; border: 2px dashed #d1d5db;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🎯</div>
                        <h4 style="color: #374151; margin-bottom: 1rem;">대안이 없습니다</h4>
                        <p style="color: #6b7280; margin-bottom: 2rem;">
                            비교 평가할 대안들을 추가해주세요.<br>
                            최소 2개 이상의 대안이 필요합니다.
                        </p>
                        <button onclick="addAlternative()" style="background: #C8A968; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            첫 번째 대안 추가하기
                        </button>
                    </div>
                `;
            } else {
                const alternativesHtml = currentModelData.alternatives.map((alternative, index) => `
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="background: #10b981; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 600;">
                                        대안 ${index + 1}
                                    </span>
                                    <h4 style="color: #1f2937; margin: 0; font-size: 1.1rem;">${alternative.name}</h4>
                                </div>
                                ${alternative.description ? `<p style="color: #6b7280; margin: 0; font-size: 0.9rem;">${alternative.description}</p>` : ''}
                            </div>
                            <div style="display: flex; gap: 0.5rem; margin-left: 1rem;">
                                <button onclick="editAlternative('${alternative.id}')" style="background: #f59e0b; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    ✏️
                                </button>
                                <button onclick="deleteAlternative('${alternative.id}')" style="background: #ef4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = alternativesHtml;
            }
        }

        /**
         * 기타 모델 관리 함수들
         */
        function createNewModel() {
            console.log('🆕 새 모델 생성');
            if (confirm('현재 작업 중인 모델을 초기화하고 새 모델을 생성하시겠습니까?')) {
                currentModelData = {
                    criteria: [],
                    alternatives: [],
                    settings: {
                        name: '새 AHP 모델',
                        objective: '',
                        consistencyThreshold: 0.1,
                        weightMethod: 'geometric'
                    }
                };
                updateModelStatus();
                alert('새 모델이 생성되었습니다.');
            }
        }

        function loadModelTemplate() {
            console.log('📋 모델 템플릿 선택');
            alert('모델 템플릿 기능은 준비 중입니다.');
        }

        function validateModel() {
            console.log('✅ 모델 검증 실행');
            const criteriaCount = currentModelData.criteria.length;
            const alternativesCount = currentModelData.alternatives.length;
            
            if (criteriaCount < 2) {
                alert('최소 2개 이상의 평가 기준이 필요합니다.');
                return;
            }
            
            if (alternativesCount < 2) {
                alert('최소 2개 이상의 대안이 필요합니다.');
                return;
            }
            
            alert('✅ 모델 검증이 완료되었습니다!\nAHP 분석을 시작할 수 있습니다.');
        }

        function updateHierarchyVisualization() {
            console.log('🏗️ 계층구조 시각화 업데이트');
            // 실제 구현에서는 계층구조 시각화 라이브러리 사용
        }

        function loadModelSettings() {
            console.log('⚙️ 모델 설정 로드');
            // 설정값들을 폼에 로드
        }

        function saveModelSettings() {
            console.log('💾 모델 설정 저장');
            alert('모델 설정이 저장되었습니다.');
        }

        function previewModel() {
            console.log('👁️ 모델 미리보기');
            alert('모델 미리보기 기능은 준비 중입니다.');
        }

        // 편집 및 삭제 함수들 (스텁)
        function editCriterion(id) { alert('기준 편집 기능은 준비 중입니다.'); }
        function deleteCriterion(id) { 
            if (confirm('이 기준을 삭제하시겠습니까?')) {
                currentModelData.criteria = currentModelData.criteria.filter(c => c.id !== id);
                renderCriteriaList();
                updateModelStatus();
            }
        }
        function editAlternative(id) { alert('대안 편집 기능은 준비 중입니다.'); }
        function deleteAlternative(id) { 
            if (confirm('이 대안을 삭제하시겠습니까?')) {
                currentModelData.alternatives = currentModelData.alternatives.filter(a => a.id !== id);
                renderAlternativesList();
                updateModelStatus();
            }
        }
        function autoLayoutHierarchy() { alert('자동 정렬 기능은 준비 중입니다.'); }
        function exportHierarchy() { alert('내보내기 기능은 준비 중입니다.'); }
        function resetModelSettings() { 
            if (confirm('모델 설정을 초기화하시겠습니까?')) {
                alert('설정이 초기화되었습니다.'); 
            }
        }

        // =========================
        // 평가 관련 함수들
        // =========================

        // 전역 평가 설정
        let currentEvaluationMethod = 'pairwise';
        let currentPairwiseMode = 'practical';
        let evaluationData = {
            pairwiseComparisons: {},
            directInputValues: {},
            consistencyRatios: {}
        };

        /**
         * 평가 방법 선택
         */
        function selectEvaluationMethod(method) {
            currentEvaluationMethod = method;
            console.log(`🎯 평가 방법 선택: ${method}`);
            
            // UI 업데이트 (null 체크 추가)
            const pairwiseCard = document.getElementById('eval-method-pairwise');
            const directCard = document.getElementById('eval-method-direct');
            
            if (!pairwiseCard || !directCard) {
                console.warn('⚠️ Evaluation method cards not found');
                return;
            }
            
            if (method === 'pairwise') {
                pairwiseCard.style.border = '2px solid #3b82f6';
                pairwiseCard.style.background = '#eff6ff';
                directCard.style.border = '2px solid #e5e7eb';
                directCard.style.background = 'white';
            } else {
                directCard.style.border = '2px solid #10b981';
                directCard.style.background = '#f0fdf4';
                pairwiseCard.style.border = '2px solid #e5e7eb';
                pairwiseCard.style.background = 'white';
            }
            
            // 평가 탭이 활성화되어 있으면 콘텐츠 새로고침
            const evaluationTab = document.getElementById('model-tab-evaluation');
            if (evaluationTab && evaluationTab.style.color === 'rgb(59, 130, 246)') {
                switchModelTab('evaluation');
            }
        }

        /**
         * 쌍대비교 모드 선택
         */
        function selectPairwiseMode(mode) {
            currentPairwiseMode = mode;
            console.log(`⚖️ 쌍대비교 모드: ${mode}`);
            selectEvaluationMethod('pairwise');
        }

        /**
         * 평가 실행 탭 콘텐츠 생성
         */
        function generateEvaluationTabContent() {
            if (currentModelData.criteria.length < 2) {
                return `
                    <div style="text-align: center; padding: 3rem; background: #fef3cd; border: 2px dashed #f59e0b; border-radius: 8px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
                        <h3 style="color: #92400e; margin-bottom: 1rem;">평가를 시작할 수 없습니다</h3>
                        <p style="color: #92400e; margin-bottom: 2rem;">
                            평가를 수행하려면 최소 2개 이상의 기준이 필요합니다.<br>
                            먼저 "평가 기준" 탭에서 기준을 추가해주세요.
                        </p>
                        <button onclick="switchModelTab('criteria')" style="background: #f59e0b; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            기준 설정하기
                        </button>
                    </div>
                `;
            }

            if (currentModelData.alternatives.length < 2) {
                return `
                    <div style="text-align: center; padding: 3rem; background: #fef3cd; border: 2px dashed #f59e0b; border-radius: 8px;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
                        <h3 style="color: #92400e; margin-bottom: 1rem;">평가를 시작할 수 없습니다</h3>
                        <p style="color: #92400e; margin-bottom: 2rem;">
                            평가를 수행하려면 최소 2개 이상의 대안이 필요합니다.<br>
                            먼저 "대안" 탭에서 대안을 추가해주세요.
                        </p>
                        <button onclick="switchModelTab('alternatives')" style="background: #f59e0b; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            대안 설정하기
                        </button>
                    </div>
                `;
            }

            return `
                <div id="evaluation-content">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem;">
                        <h3 style="color: #1f2937; margin: 0;">⚖️ 평가 실행</h3>
                        <div style="display: flex; gap: 1rem;">
                            <span style="background: #eff6ff; color: #1e40af; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem;">
                                선택된 방법: ${currentEvaluationMethod === 'pairwise' ? `쌍대비교 (${currentPairwiseMode === 'practical' ? '실용형' : '이론형'})` : '직접입력'}
                            </span>
                        </div>
                    </div>

                    ${currentEvaluationMethod === 'pairwise' ? generatePairwiseEvaluationContent() : generateDirectInputEvaluationContent()}
                </div>
            `;
        }

        /**
         * 쌍대비교 평가 콘텐츠 생성
         */
        function generatePairwiseEvaluationContent() {
            return `
                <div id="pairwise-evaluation">
                    <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #3b82f6;">
                        <h4 style="color: #1e40af; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>⚖️</span>
                            쌍대비교 평가 (${currentPairwiseMode === 'practical' ? '실용형' : '이론형'})
                        </h4>
                        <p style="color: #1e40af; margin-bottom: 1rem; font-size: 0.9rem;">
                            ${currentPairwiseMode === 'practical' 
                                ? '실무에 최적화된 최소한의 쌍대비교를 통해 효율적으로 중요도를 도출합니다.'
                                : '이론적으로 완전한 모든 쌍대비교를 실시하여 정확한 중요도를 도출합니다.'
                            }
                        </p>
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="startCriteriaComparison()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                📊 기준 간 비교 시작
                            </button>
                            <button onclick="startAlternativesComparison()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;" ${currentModelData.criteria.length === 0 ? 'disabled' : ''}>
                                🎯 대안 비교 시작
                            </button>
                        </div>
                    </div>

                    <!-- 쌍대비교 진행 상황 -->
                    <div id="pairwise-progress" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                        <h5 style="color: #1f2937; margin-bottom: 1rem;">📈 평가 진행 상황</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 6px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #3b82f6;" id="criteria-comparison-progress">0%</div>
                                <div style="font-size: 0.8rem; color: #6b7280;">기준 비교 진행률</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 6px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #10b981;" id="alternatives-comparison-progress">0%</div>
                                <div style="font-size: 0.8rem; color: #6b7280;">대안 비교 진행률</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 6px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;" id="consistency-ratio">-</div>
                                <div style="font-size: 0.8rem; color: #6b7280;">일관성 비율 (CR)</div>
                            </div>
                        </div>
                    </div>

                    <!-- 쌍대비교 매트릭스 영역 -->
                    <div id="pairwise-matrix-container" style="margin-top: 2rem;">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
            `;
        }

        /**
         * 직접입력 평가 콘텐츠 생성
         */
        function generateDirectInputEvaluationContent() {
            return `
                <div id="direct-input-evaluation">
                    <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #10b981;">
                        <h4 style="color: #065f46; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>📊</span>
                            직접입력 평가
                        </h4>
                        <p style="color: #065f46; margin-bottom: 1rem; font-size: 0.9rem;">
                            기존 데이터나 전문가 판단을 직접 입력하여 중요도를 설정합니다. 시스템이 자동으로 가중치를 계산합니다.
                        </p>
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="startDirectInputForCriteria()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                                📊 기준 가중치 입력
                            </button>
                            <button onclick="startDirectInputForAlternatives()" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;" ${currentModelData.criteria.length === 0 ? 'disabled' : ''}>
                                🎯 대안별 점수 입력
                            </button>
                        </div>
                    </div>

                    <!-- 직접입력 진행 상황 -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                        <h5 style="color: #1f2937; margin-bottom: 1rem;">📈 입력 진행 상황</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 6px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #10b981;" id="criteria-weights-progress">0%</div>
                                <div style="font-size: 0.8rem; color: #6b7280;">기준 가중치 입력률</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 6px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #059669;" id="alternatives-scores-progress">0%</div>
                                <div style="font-size: 0.8rem; color: #6b7280;">대안 점수 입력률</div>
                            </div>
                        </div>
                    </div>

                    <!-- 직접입력 폼 영역 -->
                    <div id="direct-input-form-container" style="margin-top: 2rem;">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
            `;
        }

        /**
         * 평가 탭 초기화
         */
        function initializeEvaluationTab() {
            console.log('⚖️ 평가 탭 초기화');
            updateEvaluationProgress();
        }

        /**
         * 평가 진행 상황 업데이트
         */
        function updateEvaluationProgress() {
            // 진행률 계산 및 UI 업데이트 로직
            console.log('📊 평가 진행 상황 업데이트');
        }

        /**
         * 기준 간 쌍대비교 시작
         */
        function startCriteriaComparison() {
            console.log('📊 기준 간 쌍대비교 시작');
            
            const container = document.getElementById('pairwise-matrix-container');
            if (container) {
                container.innerHTML = generatePairwiseMatrix(currentModelData.criteria, 'criteria');
            }
        }

        /**
         * 대안 비교 시작
         */
        function startAlternativesComparison() {
            console.log('🎯 대안 비교 시작');
            
            // 각 기준에 대해 대안 간 비교 수행
            const container = document.getElementById('pairwise-matrix-container');
            if (container) {
                container.innerHTML = generateAlternativesComparisonInterface();
            }
        }

        /**
         * 쌍대비교 매트릭스 생성
         */
        function generatePairwiseMatrix(elements, type) {
            if (elements.length < 2) {
                return `
                    <div style="text-align: center; padding: 2rem; background: #fef3cd; border: 2px dashed #f59e0b; border-radius: 8px;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">⚠️</div>
                        <p style="color: #92400e;">비교할 ${type === 'criteria' ? '기준' : '대안'}이 부족합니다. 최소 2개 이상 필요합니다.</p>
                    </div>
                `;
            }

            const matrixSize = elements.length;
            const totalComparisons = (matrixSize * (matrixSize - 1)) / 2;

            return `
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                    <div style="display: flex; justify-between; align-items: center; margin-bottom: 1.5rem;">
                        <h4 style="color: #1f2937; margin: 0;">${type === 'criteria' ? '기준' : '대안'} 쌍대비교 (${matrixSize}×${matrixSize})</h4>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 0.9rem; color: #6b7280;">진행률: 0/${totalComparisons}</span>
                            <div style="width: 100px; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                                <div style="width: 0%; height: 100%; background: #3b82f6; transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Saaty 9점 척도 가이드 -->
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                        <h5 style="color: #374151; margin-bottom: 0.5rem; font-size: 0.9rem;">📋 Saaty 9점 척도 가이드</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; font-size: 0.8rem; color: #6b7280;">
                            <div><strong>1:</strong> 동등</div>
                            <div><strong>3:</strong> 약간 중요</div>
                            <div><strong>5:</strong> 중요</div>
                            <div><strong>7:</strong> 매우 중요</div>
                            <div><strong>9:</strong> 절대 중요</div>
                            <div><strong>2,4,6,8:</strong> 중간값</div>
                        </div>
                    </div>

                    <!-- 비교 매트릭스 테이블 -->
                    <div style="overflow-x: auto;">
                        ${generateMatrixTable(elements, type)}
                    </div>

                    <!-- 일관성 검사 결과 -->
                    <div id="consistency-result" style="margin-top: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 6px; display: none;">
                        <h5 style="color: #374151; margin-bottom: 0.5rem;">🎯 일관성 검사 결과</h5>
                        <div id="consistency-details"></div>
                    </div>
                </div>
            `;
        }

        /**
         * 매트릭스 테이블 생성
         */
        function generateMatrixTable(elements, type) {
            let tableHtml = `
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                    <thead>
                        <tr style="background: #f9fafb;">
                            <th style="padding: 0.75rem; border: 1px solid #e5e7eb; text-align: center; min-width: 100px;">${type === 'criteria' ? '기준' : '대안'}</th>
            `;

            // 헤더 생성
            elements.forEach((element, index) => {
                tableHtml += `<th style="padding: 0.75rem; border: 1px solid #e5e7eb; text-align: center; min-width: 80px; font-size: 0.8rem;">${element.name}<br><span style="color: #6b7280;">#${index + 1}</span></th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            // 매트릭스 행 생성
            elements.forEach((rowElement, i) => {
                tableHtml += `<tr><td style="padding: 0.75rem; border: 1px solid #e5e7eb; background: #f9fafb; font-weight: 600; font-size: 0.8rem;">${rowElement.name}<br><span style="color: #6b7280; font-weight: normal;">#${i + 1}</span></td>`;
                
                elements.forEach((colElement, j) => {
                    if (i === j) {
                        // 대각선 (자기 자신)
                        tableHtml += `<td style="padding: 0.75rem; border: 1px solid #e5e7eb; text-align: center; background: #f3f4f6; color: #6b7280; font-weight: bold;">1</td>`;
                    } else if (i < j) {
                        // 상삼각 (입력 영역)
                        tableHtml += `
                            <td style="padding: 0.5rem; border: 1px solid #e5e7eb; text-align: center;">
                                <select onchange="updateComparison('${type}', ${i}, ${j}, this.value)" 
                                        style="width: 100%; padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.8rem;">
                                    <option value="1">1 (동등)</option>
                                    <option value="2">2</option>
                                    <option value="3">3 (약간 중요)</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (중요)</option>
                                    <option value="6">6</option>
                                    <option value="7">7 (매우 중요)</option>
                                    <option value="8">8</option>
                                    <option value="9">9 (절대 중요)</option>
                                    <option value="0.5">1/2</option>
                                    <option value="0.33">1/3</option>
                                    <option value="0.25">1/4</option>
                                    <option value="0.2">1/5</option>
                                    <option value="0.17">1/6</option>
                                    <option value="0.14">1/7</option>
                                    <option value="0.13">1/8</option>
                                    <option value="0.11">1/9</option>
                                </select>
                            </td>
                        `;
                    } else {
                        // 하삼각 (자동 계산된 역수)
                        tableHtml += `<td id="matrix-${type}-${i}-${j}" style="padding: 0.75rem; border: 1px solid #e5e7eb; text-align: center; background: #f9fafb; color: #6b7280; font-size: 0.8rem;">1</td>`;
                    }
                });
                tableHtml += '</tr>';
            });

            return tableHtml + '</tbody></table>';
        }

        /**
         * 비교값 업데이트
         */
        function updateComparison(type, i, j, value) {
            const numValue = parseFloat(value);
            const reciprocal = numValue > 0 ? (1 / numValue) : 1;
            
            // 역수 셀 업데이트
            const reciprocalCell = document.getElementById(`matrix-${type}-${j}-${i}`);
            if (reciprocalCell) {
                reciprocalCell.textContent = reciprocal < 1 ? reciprocal.toFixed(2) : Math.round(reciprocal);
            }

            // 평가 데이터 저장
            if (!evaluationData.pairwiseComparisons[type]) {
                evaluationData.pairwiseComparisons[type] = {};
            }
            evaluationData.pairwiseComparisons[type][`${i}-${j}`] = numValue;

            console.log(`🔄 비교 업데이트: ${type} [${i},${j}] = ${numValue}`);
            
            // 일관성 검사 수행
            checkConsistency(type);
        }

        /**
         * 일관성 검사
         */
        function checkConsistency(type) {
            console.log(`🎯 일관성 검사: ${type}`);
            // 실제 AHP 일관성 계산 로직 구현 필요
            // 여기서는 간단한 시뮬레이션
            
            const consistencyResult = document.getElementById('consistency-result');
            if (consistencyResult) {
                consistencyResult.style.display = 'block';
                const details = document.getElementById('consistency-details');
                if (details) {
                    const cr = Math.random() * 0.2; // 시뮬레이션된 CR 값
                    const isConsistent = cr <= 0.1;
                    
                    details.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="width: 12px; height: 12px; border-radius: 50%; background: ${isConsistent ? '#10b981' : '#ef4444'};"></span>
                                <span style="font-weight: 600; color: ${isConsistent ? '#065f46' : '#991b1b'};">
                                    CR = ${cr.toFixed(3)} ${isConsistent ? '(일관성 양호)' : '(일관성 불량)'}
                                </span>
                            </div>
                            ${!isConsistent ? '<span style="color: #991b1b; font-size: 0.8rem;">※ CR > 0.1이므로 비교를 재검토해주세요.</span>' : ''}
                        </div>
                    `;
                }
            }
        }

        /**
         * 대안 비교 인터페이스 생성
         */
        function generateAlternativesComparisonInterface() {
            return `
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                    <h4 style="color: #1f2937; margin-bottom: 1.5rem;">🎯 기준별 대안 비교</h4>
                    
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                        <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">
                            각 기준에 대해 대안들을 쌍대비교합니다. 기준을 선택하여 해당 기준 하에서의 대안 중요도를 평가하세요.
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        ${currentModelData.criteria.map((criterion, index) => `
                            <div style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 1rem; cursor: pointer; transition: all 0.2s;" 
                                 onclick="startAlternativeComparisonForCriterion('${criterion.id}')">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="background: #3b82f6; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">기준 ${index + 1}</span>
                                    <h5 style="margin: 0; color: #1f2937;">${criterion.name}</h5>
                                </div>
                                <p style="color: #6b7280; margin: 0; font-size: 0.8rem;">${criterion.description || '설명 없음'}</p>
                                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #059669;">
                                    📊 ${currentModelData.alternatives.length}개 대안 비교
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        /**
         * 특정 기준에 대한 대안 비교 시작
         */
        function startAlternativeComparisonForCriterion(criterionId) {
            console.log(`🎯 기준 ${criterionId}에 대한 대안 비교 시작`);
            
            const criterion = currentModelData.criteria.find(c => c.id === criterionId);
            if (!criterion) return;

            const container = document.getElementById('pairwise-matrix-container');
            if (container) {
                container.innerHTML = `
                    <div style="background: #eff6ff; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <h4 style="color: #1e40af; margin: 0;">기준: ${criterion.name}</h4>
                        <p style="color: #1e40af; margin: 0.5rem 0 0 0; font-size: 0.9rem;">${criterion.description || ''}</p>
                    </div>
                    ${generatePairwiseMatrix(currentModelData.alternatives, `alternatives-${criterionId}`)}
                `;
            }
        }

        /**
         * 기준에 대한 직접입력 시작
         */
        function startDirectInputForCriteria() {
            console.log('📊 기준 가중치 직접입력 시작');
            
            const container = document.getElementById('direct-input-form-container');
            if (container) {
                container.innerHTML = generateDirectInputForm(currentModelData.criteria, 'criteria');
            }
        }

        /**
         * 대안에 대한 직접입력 시작
         */
        function startDirectInputForAlternatives() {
            console.log('🎯 대안 점수 직접입력 시작');
            
            const container = document.getElementById('direct-input-form-container');
            if (container) {
                container.innerHTML = generateAlternativesDirectInputInterface();
            }
        }

        /**
         * 직접입력 폼 생성
         */
        function generateDirectInputForm(elements, type) {
            return `
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                    <h4 style="color: #1f2937; margin-bottom: 1rem;">📊 ${type === 'criteria' ? '기준 가중치' : '대안 점수'} 직접입력</h4>
                    
                    <div style="background: #f0fdf4; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                        <div style="display: flex; gap: 2rem; margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="inputType" value="benefit" checked onchange="updateInputType(this.value)">
                                <span style="color: #065f46;">편익형 (값이 클수록 좋음)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="inputType" value="cost" onchange="updateInputType(this.value)">
                                <span style="color: #991b1b;">비용형 (값이 작을수록 좋음)</span>
                            </label>
                        </div>
                        <p style="color: #065f46; margin: 0; font-size: 0.8rem;">
                            💡 시스템이 자동으로 상대적 중요도를 계산하여 가중치로 변환합니다.
                        </p>
                    </div>

                    <div style="display: grid; gap: 1rem;">
                        ${elements.map((element, index) => `
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f8fafc; border-radius: 6px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #1f2937;">${element.name}</div>
                                    ${element.description ? `<div style="font-size: 0.8rem; color: #6b7280;">${element.description}</div>` : ''}
                                </div>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <input type="number" 
                                           id="direct-input-${element.id}" 
                                           min="0.001" 
                                           step="0.001" 
                                           placeholder="값 입력"
                                           onchange="updateDirectInputValue('${element.id}', this.value)"
                                           style="width: 120px; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; text-align: right;">
                                    <div style="width: 80px; text-align: right;">
                                        <div id="weight-${element.id}" style="font-weight: 600; color: #10b981;">0.0%</div>
                                        <div style="font-size: 0.7rem; color: #6b7280;">가중치</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                        <button onclick="calculateDirectInputWeights('${type}')" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            🔄 가중치 계산
                        </button>
                        <button onclick="saveDirectInputResults('${type}')" style="background: #059669; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                            💾 결과 저장
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * 직접입력 값 업데이트
         */
        function updateDirectInputValue(elementId, value) {
            console.log(`📊 직접입력 값 업데이트: ${elementId} = ${value}`);
            
            if (!evaluationData.directInputValues) {
                evaluationData.directInputValues = {};
            }
            evaluationData.directInputValues[elementId] = parseFloat(value) || 0;
        }

        /**
         * 직접입력 가중치 계산
         */
        function calculateDirectInputWeights(type) {
            console.log(`🔄 직접입력 가중치 계산: ${type}`);
            
            const values = evaluationData.directInputValues || {};
            const elements = type === 'criteria' ? currentModelData.criteria : currentModelData.alternatives;
            
            // 입력값 수집
            const inputValues = elements.map(element => {
                const value = values[element.id] || 0;
                return { id: element.id, value: value };
            });
            
            // 가중치 계산 (정규화)
            const sum = inputValues.reduce((total, item) => total + item.value, 0);
            
            if (sum > 0) {
                inputValues.forEach(item => {
                    const weight = (item.value / sum) * 100;
                    const weightElement = document.getElementById(`weight-${item.id}`);
                    if (weightElement) {
                        weightElement.textContent = `${weight.toFixed(1)}%`;
                    }
                });
            }
        }

        /**
         * 직접입력 결과 저장
         */
        function saveDirectInputResults(type) {
            console.log(`💾 직접입력 결과 저장: ${type}`);
            alert(`${type === 'criteria' ? '기준 가중치' : '대안 점수'} 결과가 저장되었습니다.`);
        }

        /**
         * 입력 타입 업데이트
         */
        function updateInputType(type) {
            console.log(`🔄 입력 타입 변경: ${type}`);
            // 편익형/비용형에 따른 처리 로직
        }

        /**
         * 모델 저장
         */
        function saveCurrentModel() {
            console.log('💾 현재 모델 저장');
            
            // 모델 저장 성공 메시지
            showMessage('✅ 모델이 성공적으로 저장되었습니다!\n🔄 인구통계학적 설문조사 단계로 이동합니다...', 'success');
            
            // 2초 후 설문조사 단계로 자동 이동
            setTimeout(() => {
                console.log('🚀 모델 구축 완료 - 설문조사 단계로 이동');
                handleMenuClick('demographic-survey', null);
            }, 2000);
        }
    </script>
</body>
</html>