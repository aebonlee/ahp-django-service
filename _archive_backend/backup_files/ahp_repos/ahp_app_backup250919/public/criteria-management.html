<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP System - 기준 설정</title>
    <link rel="stylesheet" href="styles/layout.css">
    <style>
        :root {
            --accent-primary: #C8A968;
            --accent-secondary: #A98C4B;
            --accent-light: #E5D5AA;
            --accent-hover: #B59A4D;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-bar {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(200, 169, 104, 0.1);
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 169, 104, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .criteria-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .criteria-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .criteria-item:hover {
            border-color: var(--accent-light);
            background: var(--bg-primary);
        }

        .criteria-info {
            flex: 1;
        }

        .criteria-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .criteria-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .criteria-weight {
            font-size: 0.85rem;
            color: var(--accent-primary);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .criteria-actions {
            display: flex;
            gap: 0.5rem;
        }

        .drag-handle {
            background: var(--accent-light);
            color: var(--accent-primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            margin-right: 1rem;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .criteria-hierarchy {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed var(--accent-light);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .hierarchy-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .hierarchy-level {
            background: var(--accent-light);
            color: var(--accent-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        .hierarchy-arrow {
            color: var(--accent-primary);
            font-size: 1.5rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .error {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .progress-bar {
            background: var(--border-light);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .criteria-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .criteria-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- 상단 헤더 -->
    <header class="header">
        <div class="header-left">
            <a href="./personal-service-enhanced.html" class="logo">
                <div class="logo-icon">A</div>
                <span>AHP System</span>
            </a>
            <nav class="header-nav">
                <a href="./personal-service-enhanced.html" class="header-nav-item" data-page="dashboard">대시보드</a>
                <a href="./project-management.html" class="header-nav-item" data-page="projects">프로젝트</a>
                <a href="./results-analysis.html" class="header-nav-item" data-page="analysis">분석</a>
                <a href="#" class="header-nav-item" data-page="reports">보고서</a>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">김</div>
                <div>
                    <div class="user-name">김철수</div>
                    <div class="user-role" id="userRole">로딩 중...</div>
                </div>
            </div>
            <button onclick="handleLogout()" class="logout-btn">로그아웃</button>
        </div>
    </header>

    <!-- 왼쪽 사이드바 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">프로젝트 관리</div>
            <div class="sidebar-menu">
                <a href="./project-management.html" class="sidebar-item" data-menu="my-projects">
                    <span class="sidebar-icon">📋</span>
                    <span>내 프로젝트</span>
                    <span class="sidebar-badge">3</span>
                </a>
                <a href="./project-management.html" class="sidebar-item" data-menu="new-project">
                    <span class="sidebar-icon">➕</span>
                    <span>새 프로젝트</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="trash">
                    <span class="sidebar-icon">🗑️</span>
                    <span>휴지통</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">모델 구축</div>
            <div class="sidebar-menu">
                <a href="./criteria-management.html" class="sidebar-item active" data-menu="criteria">
                    <span class="sidebar-icon">⚖️</span>
                    <span>기준 설정</span>
                </a>
                <a href="./alternatives-management.html" class="sidebar-item" data-menu="alternatives">
                    <span class="sidebar-icon">🔄</span>
                    <span>대안 관리</span>
                </a>
                <a href="./pairwise-comparison.html" class="sidebar-item" data-menu="comparison">
                    <span class="sidebar-icon">⚡</span>
                    <span>쌍대비교</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="evaluators">
                    <span class="sidebar-icon">👥</span>
                    <span>평가자 관리</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">분석 및 결과</div>
            <div class="sidebar-menu">
                <a href="./results-analysis.html" class="sidebar-item" data-menu="results">
                    <span class="sidebar-icon">📈</span>
                    <span>결과 분석</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="monitoring">
                    <span class="sidebar-icon">📊</span>
                    <span>진행률 모니터링</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="reports">
                    <span class="sidebar-icon">📄</span>
                    <span>보고서 생성</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="sensitivity">
                    <span class="sidebar-icon">🔍</span>
                    <span>민감도 분석</span>
                </a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">설정</div>
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item" data-menu="settings">
                    <span class="sidebar-icon">⚙️</span>
                    <span>개인 설정</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="billing">
                    <span class="sidebar-icon">💳</span>
                    <span>요금제 관리</span>
                </a>
                <a href="#" class="sidebar-item" data-menu="guide">
                    <span class="sidebar-icon">📚</span>
                    <span>사용 가이드</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- 사이드바 토글 버튼 -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <span id="toggle-icon">◀</span>
    </button>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <div class="status-bar">
            <div>
                <strong>Django 백엔드:</strong> <span id="backend-status">연결 확인중...</span>
            </div>
            <div>
                <strong>현재 프로젝트:</strong> <span id="current-project">프로젝트를 선택해주세요</span>
            </div>
            <div>
                <strong>단계:</strong> <span style="color: var(--accent-primary);">2단계 - 기준 설정</span>
            </div>
        </div>

        <!-- AHP 진행 상황 -->
        <div class="section">
            <h2 class="section-title">📊 AHP 진행 상황</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="ahp-progress" style="width: 25%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                <span>프로젝트 생성</span>
                <span style="color: var(--accent-primary); font-weight: 600;">기준 설정</span>
                <span>대안 입력</span>
                <span>쌍대비교</span>
                <span>결과 분석</span>
            </div>
        </div>

        <!-- 기준 설정 가이드 -->
        <div class="section">
            <h2 class="section-title">📋 기준 설정 가이드</h2>
            <div style="background: var(--accent-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">💡 좋은 기준 설정을 위한 팁</h3>
                <ul style="color: var(--text-primary); line-height: 1.6; margin-left: 1.5rem;">
                    <li><strong>구체적으로:</strong> 모호하지 않고 명확한 기준을 설정하세요</li>
                    <li><strong>측정 가능:</strong> 정량적 또는 정성적으로 평가 가능한 기준</li>
                    <li><strong>독립적:</strong> 서로 겹치지 않는 독립적인 기준들</li>
                    <li><strong>완전성:</strong> 의사결정에 중요한 모든 측면을 포함</li>
                    <li><strong>적정 수준:</strong> 보통 3-7개 기준이 적당합니다</li>
                </ul>
            </div>
        </div>

        <!-- 새 기준 추가 -->
        <div class="section">
            <h2 class="section-title">➕ 새 기준 추가</h2>
            <div id="add-error" class="error" style="display:none;"></div>
            <div id="add-success" class="success" style="display:none;"></div>
            
            <form id="add-criteria-form">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; align-items: start;">
                    <div class="form-group">
                        <label for="criteria-name" class="form-label">기준 이름 *</label>
                        <input type="text" id="criteria-name" class="form-input" required 
                               placeholder="예: 품질">
                    </div>

                    <div class="form-group">
                        <label for="criteria-description" class="form-label">기준 설명</label>
                        <textarea id="criteria-description" class="form-textarea" rows="3" 
                                  placeholder="이 기준이 무엇을 평가하는지 설명해주세요..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn" id="add-btn">
                    ➕ 기준 추가
                </button>
            </form>
        </div>

        <!-- 기준 목록 -->
        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="section-title" style="margin-bottom: 0;">📝 설정된 기준들</h2>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary btn-small" onclick="loadCriteria()">
                        🔄 새로고침
                    </button>
                    <button class="btn btn-small" onclick="proceedToAlternatives()" id="proceed-btn" style="display: none;">
                        다음 단계 → 대안 입력
                    </button>
                </div>
            </div>
            
            <div id="criteria-loading" class="loading">
                기준 목록을 불러오는 중...
            </div>
            
            <div id="criteria-error" class="error" style="display:none;"></div>
            
            <div id="criteria-container" style="display:none;">
                <div class="criteria-list" id="criteria-list">
                    <!-- 기준들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>

        <!-- AHP 계층구조 미리보기 -->
        <div class="section" id="hierarchy-preview" style="display: none;">
            <h2 class="section-title">🏗️ AHP 계층구조 미리보기</h2>
            <div class="criteria-hierarchy">
                <div class="hierarchy-visual">
                    <div class="hierarchy-level">의사결정 목표</div>
                    <div class="hierarchy-arrow">↓</div>
                    <div id="criteria-hierarchy" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;">
                        <!-- 기준들이 여기에 표시됩니다 -->
                    </div>
                    <div class="hierarchy-arrow">↓</div>
                    <div class="hierarchy-level">대안들 (다음 단계에서 설정)</div>
                </div>
                <p style="color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                    위 구조로 AHP 분석이 수행됩니다. 기준이 설정되면 다음 단계로 진행할 수 있습니다.
                </p>
            </div>
        </div>
    </main>

    <script src="scripts/layout.js"></script>
    <script>
        // 전역 변수
        let currentCriteria = [];
        let currentProject = null;
        const API_BASE_URL = 'https://ahp-django-backend.onrender.com';

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 기준 설정 페이지 로드됨');
            
            // 레이아웃 초기화
            if (window.layoutUtils) {
                window.layoutUtils.initializePage({
                    menuId: 'criteria',
                    pageId: 'projects',
                    title: '기준 설정'
                });
            }
            
            checkBackendStatus();
            loadProject();
            loadCriteria();

            // 폼 이벤트 리스너
            document.getElementById('add-criteria-form').addEventListener('submit', handleAddCriteria);
        });

        // 백엔드 상태 확인
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/service/status/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--success);">✅ 정상 연결</span>';
                } else {
                    document.getElementById('backend-status').innerHTML = 
                        '<span style="color: var(--warning);">⚠️ 응답 오류</span>';
                }
            } catch (error) {
                document.getElementById('backend-status').innerHTML = 
                    '<span style="color: var(--error);">❌ 연결 실패</span>';
                console.error('백엔드 연결 오류:', error);
            }
        }

        // 현재 프로젝트 정보 로드
        function loadProject() {
            // 세션 스토리지에서 프로젝트 정보 가져오기
            const savedProject = sessionStorage.getItem('currentProject');
            if (savedProject) {
                try {
                    currentProject = JSON.parse(savedProject);
                    document.getElementById('current-project').textContent = currentProject.title;
                    return;
                } catch (e) {
                    console.error('프로젝트 정보 파싱 오류:', e);
                }
            }
            
            // 기본값으로 데모 프로젝트 설정
            currentProject = {
                id: 'demo-project',
                title: '샘플 의사결정 프로젝트'
            };
            document.getElementById('current-project').textContent = currentProject.title;
        }

        // 기준 추가 처리
        async function handleAddCriteria(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('add-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '추가 중...';
            submitBtn.disabled = true;

            // 에러/성공 메시지 초기화
            document.getElementById('add-error').style.display = 'none';
            document.getElementById('add-success').style.display = 'none';

            try {
                const criteriaData = {
                    name: document.getElementById('criteria-name').value,
                    description: document.getElementById('criteria-description').value || '',
                    project_id: currentProject?.id || 'default',
                    weight: 0, // 초기 가중치는 0, 쌍대비교 후 계산됨
                    created_date: new Date().toISOString()
                };

                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(criteriaData)
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // 성공 메시지 표시
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `✅ 기준 "${criteriaData.name}"이 성공적으로 추가되었습니다!`;
                    successDiv.style.display = 'block';
                    
                    // 폼 초기화
                    document.getElementById('add-criteria-form').reset();
                    
                    // 기준 목록 새로고침
                    setTimeout(() => {
                        loadCriteria();
                        successDiv.style.display = 'none';
                    }, 2000);

                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '기준 추가에 실패했습니다.');
                }

            } catch (error) {
                console.error('기준 추가 오류:', error);
                const errorDiv = document.getElementById('add-error');
                errorDiv.textContent = `❌ 오류: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // 기준 목록 로드
        async function loadCriteria() {
            const loadingDiv = document.getElementById('criteria-loading');
            const errorDiv = document.getElementById('criteria-error');
            const containerDiv = document.getElementById('criteria-container');

            // UI 초기화
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            containerDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/api/service/criteria/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentCriteria = Array.isArray(data) ? data : (data.criteria || []);
                    renderCriteria();
                    updateHierarchyPreview();
                } else {
                    throw new Error('기준 목록을 불러올 수 없습니다.');
                }

            } catch (error) {
                console.error('기준 로드 오류:', error);
                errorDiv.textContent = `❌ ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        // 기준 목록 렌더링
        function renderCriteria() {
            const container = document.getElementById('criteria-container');
            const listElement = document.getElementById('criteria-list');
            
            if (currentCriteria.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚖️</div>
                        <h3>아직 설정된 기준이 없습니다</h3>
                        <p>위에서 새 기준을 추가해보세요!</p>
                    </div>
                `;
            } else {
                listElement.innerHTML = currentCriteria.map((criteria, index) => `
                    <div class="criteria-item" data-id="${criteria.id || index}">
                        <div class="drag-handle">≡</div>
                        <div class="criteria-info">
                            <div class="criteria-name">${criteria.name}</div>
                            <div class="criteria-description">${criteria.description || '설명 없음'}</div>
                            <div class="criteria-weight">가중치: ${criteria.weight ? (criteria.weight * 100).toFixed(1) + '%' : '미설정'}</div>
                        </div>
                        <div class="criteria-actions">
                            <button class="btn btn-secondary btn-small" onclick="editCriteria('${criteria.id || index}')">
                                ✏️ 수정
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteCriteria('${criteria.id || index}')">
                                🗑️ 삭제
                            </button>
                        </div>
                    </div>
                `).join('');

                // 다음 단계 버튼 표시 (3개 이상의 기준이 있을 때)
                if (currentCriteria.length >= 3) {
                    document.getElementById('proceed-btn').style.display = 'block';
                }
            }
            
            container.style.display = 'block';
        }

        // 계층구조 미리보기 업데이트
        function updateHierarchyPreview() {
            if (currentCriteria.length > 0) {
                const hierarchyDiv = document.getElementById('criteria-hierarchy');
                hierarchyDiv.innerHTML = currentCriteria.map(criteria => `
                    <div class="hierarchy-level" style="font-size: 0.9rem; min-width: 120px;">
                        ${criteria.name}
                    </div>
                `).join('');
                
                document.getElementById('hierarchy-preview').style.display = 'block';
            } else {
                document.getElementById('hierarchy-preview').style.display = 'none';
            }
        }

        // 기준 수정
        function editCriteria(criteriaId) {
            const criteria = currentCriteria.find(c => (c.id || currentCriteria.indexOf(c)) == criteriaId);
            if (criteria) {
                document.getElementById('criteria-name').value = criteria.name;
                document.getElementById('criteria-description').value = criteria.description || '';
                
                // 폼을 수정 모드로 변경 (실제 구현에서는 별도 모달이나 인라인 편집 사용)
                alert(`"${criteria.name}" 기준 수정 기능은 다음 버전에서 구현됩니다.`);
            }
        }

        // 기준 삭제
        async function deleteCriteria(criteriaId) {
            const criteria = currentCriteria.find(c => (c.id || currentCriteria.indexOf(c)) == criteriaId);
            if (!criteria) return;

            if (confirm(`"${criteria.name}" 기준을 삭제하시겠습니까?`)) {
                try {
                    // 실제 API 호출 (현재는 시뮬레이션)
                    console.log(`기준 삭제: ${criteriaId}`);
                    
                    // 로컬에서 제거 (실제로는 API 호출 후 목록 새로고침)
                    currentCriteria = currentCriteria.filter(c => (c.id || currentCriteria.indexOf(c)) != criteriaId);
                    renderCriteria();
                    updateHierarchyPreview();
                    
                    // 성공 메시지
                    const successDiv = document.getElementById('add-success');
                    successDiv.textContent = `✅ "${criteria.name}" 기준이 삭제되었습니다.`;
                    successDiv.style.display = 'block';
                    setTimeout(() => successDiv.style.display = 'none', 3000);

                } catch (error) {
                    console.error('기준 삭제 오류:', error);
                    alert('기준 삭제 중 오류가 발생했습니다.');
                }
            }
        }

        // 다음 단계로 진행
        function proceedToAlternatives() {
            if (currentCriteria.length < 3) {
                alert('AHP 분석을 위해 최소 3개 이상의 기준이 필요합니다.');
                return;
            }

            const confirmed = confirm(
                `현재 ${currentCriteria.length}개의 기준이 설정되었습니다:\n\n` +
                currentCriteria.map(c => `• ${c.name}`).join('\n') +
                `\n\n다음 단계(대안 입력)로 진행하시겠습니까?`
            );

            if (confirmed) {
                // 프로젝트와 기준 정보를 세션에 저장
                sessionStorage.setItem('currentProject', JSON.stringify(currentProject));
                sessionStorage.setItem('currentCriteria', JSON.stringify(currentCriteria));
                
                // 대안 관리 페이지로 이동
                window.location.href = '/ahp_app/alternatives-management.html';
            }
        }

        // 데모 기준 자동 추가 (개발/테스트용)
        function addDemoCriteria() {
            const demoCriteria = [
                {
                    id: 'demo-1',
                    name: '품질',
                    description: '제품이나 서비스의 전반적인 품질 수준',
                    weight: 0.35
                },
                {
                    id: 'demo-2', 
                    name: '비용',
                    description: '구매, 유지보수 등 총 비용',
                    weight: 0.25
                },
                {
                    id: 'demo-3',
                    name: '신뢰성',
                    description: '장기적인 안정성과 신뢰도',
                    weight: 0.20
                },
                {
                    id: 'demo-4',
                    name: '사용성',
                    description: '사용자 친화성과 편의성',
                    weight: 0.20
                }
            ];

            currentCriteria = demoCriteria;
            renderCriteria();
            updateHierarchyPreview();
        }

        // 개발용: Ctrl+D로 데모 데이터 추가
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                addDemoCriteria();
            }
        });
    </script>
</body>
</html>